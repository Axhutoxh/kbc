{"ast":null,"code":"require(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.unshift.js\");\nrequire(\"core-js/modules/web.immediate.js\");\nrequire(\"core-js/modules/web.dom-exception.stack.js\");\nrequire(\"core-js/modules/esnext.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/esnext.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/esnext.typed-array.with.js\");\n/*! hellojs v1.18.0 | (c) 2012-2019 Andrew Dodson | MIT https://adodson.com/hello.js/LICENSE */\n// ES5 Object.create\nif (!Object.create) {\n  // Shim, Object create\n  // A shim for Object.create(), it adds a prototype to a new object\n  Object.create = function () {\n    function F() {}\n    return function (o) {\n      if (arguments.length != 1) {\n        throw new Error('Object.create implementation only accepts one parameter.');\n      }\n      F.prototype = o;\n      return new F();\n    };\n  }();\n}\n\n// ES5 Object.keys\nif (!Object.keys) {\n  Object.keys = function (o, k, r) {\n    r = [];\n    for (k in o) {\n      if (r.hasOwnProperty.call(o, k)) r.push(k);\n    }\n    return r;\n  };\n}\n\n// ES5 [].indexOf\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function (s) {\n    for (var j = 0; j < this.length; j++) {\n      if (this[j] === s) {\n        return j;\n      }\n    }\n    return -1;\n  };\n}\n\n// ES5 [].forEach\nif (!Array.prototype.forEach) {\n  Array.prototype.forEach = function (fun /*, thisArg*/) {\n    if (this === void 0 || this === null) {\n      throw new TypeError();\n    }\n    var t = Object(this);\n    var len = t.length >>> 0;\n    if (typeof fun !== 'function') {\n      throw new TypeError();\n    }\n    var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n    for (var i = 0; i < len; i++) {\n      if (i in t) {\n        fun.call(thisArg, t[i], i, t);\n      }\n    }\n    return this;\n  };\n}\n\n// ES5 [].filter\nif (!Array.prototype.filter) {\n  Array.prototype.filter = function (fun, thisArg) {\n    var a = [];\n    this.forEach(function (val, i, t) {\n      if (fun.call(thisArg || void 0, val, i, t)) {\n        a.push(val);\n      }\n    });\n    return a;\n  };\n}\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.19\n// Reference: http://es5.github.io/#x15.4.4.19\nif (!Array.prototype.map) {\n  Array.prototype.map = function (fun, thisArg) {\n    var a = [];\n    this.forEach(function (val, i, t) {\n      a.push(fun.call(thisArg || void 0, val, i, t));\n    });\n    return a;\n  };\n}\n\n// ES5 isArray\nif (!Array.isArray) {\n  // Function Array.isArray\n  Array.isArray = function (o) {\n    return Object.prototype.toString.call(o) === '[object Array]';\n  };\n}\n\n// Test for location.assign\nif (typeof window === 'object' && typeof window.location === 'object' && !window.location.assign) {\n  window.location.assign = function (url) {\n    window.location = url;\n  };\n}\n\n// Test for Function.bind\nif (!Function.prototype.bind) {\n  // MDN\n  // Polyfill IE8, does not support native Function.bind\n  Function.prototype.bind = function (b) {\n    if (typeof this !== 'function') {\n      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n    }\n    function C() {}\n    var a = [].slice;\n    var f = a.call(arguments, 1);\n    var _this = this;\n    var D = function () {\n      return _this.apply(this instanceof C ? this : b || window, f.concat(a.call(arguments)));\n    };\n    C.prototype = this.prototype;\n    D.prototype = new C();\n    return D;\n  };\n}\n\n/**\n * @hello.js\n *\n * HelloJS is a client side Javascript SDK for making OAuth2 logins and subsequent REST calls.\n *\n * @author Andrew Dodson\n * @website https://adodson.com/hello.js/\n *\n * @copyright Andrew Dodson, 2012 - 2015\n * @license MIT: You are free to use and modify this code for any use, on the condition that this copyright notice remains.\n */\n\nvar hello = function (name) {\n  return hello.use(name);\n};\nhello.utils = {\n  // Extend the first object with the properties and methods of the second\n  extend: function (r /*, a[, b[, ...]] */) {\n    // Get the arguments as an array but ommit the initial item\n    Array.prototype.slice.call(arguments, 1).forEach(function (a) {\n      if (Array.isArray(r) && Array.isArray(a)) {\n        Array.prototype.push.apply(r, a);\n      } else if (r && (r instanceof Object || typeof r === 'object') && a && (a instanceof Object || typeof a === 'object') && r !== a) {\n        for (var x in a) {\n          r[x] = hello.utils.extend(r[x], a[x]);\n        }\n      } else {\n        if (Array.isArray(a)) {\n          // Clone it\n          a = a.slice(0);\n        }\n        r = a;\n      }\n    });\n    return r;\n  }\n};\n\n// Core library\nhello.utils.extend(hello, {\n  settings: {\n    // OAuth2 authentication defaults\n    redirect_uri: window.location.href.split('#')[0],\n    response_type: 'token',\n    display: 'popup',\n    state: '',\n    // OAuth1 shim\n    // The path to the OAuth1 server for signing user requests\n    // Want to recreate your own? Checkout https://github.com/MrSwitch/node-oauth-shim\n    oauth_proxy: 'https://auth-server.herokuapp.com/proxy',\n    // API timeout in milliseconds\n    timeout: 20000,\n    // Popup Options\n    popup: {\n      resizable: 1,\n      scrollbars: 1,\n      width: 500,\n      height: 550\n    },\n    // Default scope\n    // Many services require atleast a profile scope,\n    // HelloJS automatially includes the value of provider.scope_map.basic\n    // If that's not required it can be removed via hello.settings.scope.length = 0;\n    scope: ['basic'],\n    // Scope Maps\n    // This is the default module scope, these are the defaults which each service is mapped too.\n    // By including them here it prevents the scope from being applied accidentally\n    scope_map: {\n      basic: ''\n    },\n    // Default service / network\n    default_service: null,\n    // Force authentication\n    // When hello.login is fired.\n    // (null): ignore current session expiry and continue with login\n    // (true): ignore current session expiry and continue with login, ask for user to reauthenticate\n    // (false): if the current session looks good for the request scopes return the current session.\n    force: null,\n    // Page URL\n    // When 'display=page' this property defines where the users page should end up after redirect_uri\n    // Ths could be problematic if the redirect_uri is indeed the final place,\n    // Typically this circumvents the problem of the redirect_url being a dumb relay page.\n    page_uri: window.location.href\n  },\n  // Service configuration objects\n  services: {},\n  // Use\n  // Define a new instance of the HelloJS library with a default service\n  use: function (service) {\n    // Create self, which inherits from its parent\n    var self = Object.create(this);\n\n    // Inherit the prototype from its parent\n    self.settings = Object.create(this.settings);\n\n    // Define the default service\n    if (service) {\n      self.settings.default_service = service;\n    }\n\n    // Create an instance of Events\n    self.utils.Event.call(self);\n    return self;\n  },\n  // Initialize\n  // Define the client_ids for the endpoint services\n  // @param object o, contains a key value pair, service => clientId\n  // @param object opts, contains a key value pair of options used for defining the authentication defaults\n  // @param number timeout, timeout in seconds\n  init: function (services, options) {\n    var utils = this.utils;\n    if (!services) {\n      return this.services;\n    }\n\n    // Define provider credentials\n    // Reformat the ID field\n    for (var x in services) {\n      if (services.hasOwnProperty(x)) {\n        if (typeof services[x] !== 'object') {\n          services[x] = {\n            id: services[x]\n          };\n        }\n      }\n    }\n\n    // Merge services if there already exists some\n    utils.extend(this.services, services);\n\n    // Update the default settings with this one.\n    if (options) {\n      utils.extend(this.settings, options);\n\n      // Do this immediatly incase the browser changes the current path.\n      if ('redirect_uri' in options) {\n        this.settings.redirect_uri = utils.url(options.redirect_uri).href;\n      }\n    }\n    return this;\n  },\n  // Login\n  // Using the endpoint\n  // @param network stringify       name to connect to\n  // @param options object    (optional)  {display mode, is either none|popup(default)|page, scope: email,birthday,publish, .. }\n  // @param callback  function  (optional)  fired on signin\n  login: function () {\n    // Create an object which inherits its parent as the prototype and constructs a new event chain.\n    var _this = this;\n    var utils = _this.utils;\n    var error = utils.error;\n    var promise = utils.Promise();\n\n    // Get parameters\n    var p = utils.args({\n      network: 's',\n      options: 'o',\n      callback: 'f'\n    }, arguments);\n\n    // Local vars\n    var url;\n\n    // Get all the custom options and store to be appended to the querystring\n    var qs = utils.diffKey(p.options, _this.settings);\n\n    // Merge/override options with app defaults\n    var opts = p.options = utils.merge(_this.settings, p.options || {});\n\n    // Merge/override options with app defaults\n    opts.popup = utils.merge(_this.settings.popup, p.options.popup || {});\n\n    // Network\n    p.network = p.network || _this.settings.default_service;\n\n    // Bind callback to both reject and fulfill states\n    promise.proxy.then(p.callback, p.callback);\n\n    // Trigger an event on the global listener\n    function emit(s, value) {\n      hello.emit(s, value);\n    }\n    promise.proxy.then(emit.bind(this, 'auth.login auth'), emit.bind(this, 'auth.failed auth'));\n\n    // Is our service valid?\n    if (typeof p.network !== 'string' || !(p.network in _this.services)) {\n      // Trigger the default login.\n      // Ahh we dont have one.\n      return promise.reject(error('invalid_network', 'The provided network was not recognized'));\n    }\n    var provider = _this.services[p.network];\n\n    // Create a global listener to capture events triggered out of scope\n    var callbackId = utils.globalEvent(function (obj) {\n      // The responseHandler returns a string, lets save this locally\n      if (obj) {\n        if (typeof obj == 'string') {\n          obj = JSON.parse(obj);\n        }\n      } else {\n        obj = error('cancelled', 'The authentication was not completed');\n      }\n\n      // Handle these response using the local\n      // Trigger on the parent\n      if (!obj.error) {\n        // Save on the parent window the new credentials\n        // This fixes an IE10 bug i think... atleast it does for me.\n        utils.store(obj.network, obj);\n\n        // Fulfill a successful login\n        promise.fulfill({\n          network: obj.network,\n          authResponse: obj\n        });\n      } else {\n        // Reject a successful login\n        promise.reject(obj);\n      }\n    });\n    var redirectUri = utils.url(opts.redirect_uri).href;\n\n    // May be a space-delimited list of multiple, complementary types\n    var responseType = provider.oauth.response_type || opts.response_type;\n\n    // Fallback to token if the module hasn't defined a grant url\n    if (/\\bcode\\b/.test(responseType) && !provider.oauth.grant) {\n      responseType = responseType.replace(/\\bcode\\b/, 'token');\n    }\n\n    // Query string parameters, we may pass our own arguments to form the querystring\n    p.qs = utils.merge(qs, {\n      client_id: encodeURIComponent(provider.id),\n      response_type: encodeURIComponent(responseType),\n      redirect_uri: encodeURIComponent(redirectUri),\n      state: {\n        client_id: provider.id,\n        network: p.network,\n        display: opts.display,\n        callback: callbackId,\n        state: opts.state,\n        redirect_uri: redirectUri\n      }\n    });\n\n    // Get current session for merging scopes, and for quick auth response\n    var session = utils.store(p.network);\n\n    // Scopes (authentication permisions)\n    // Ensure this is a string - IE has a problem moving Arrays between windows\n    // Append the setup scope\n    var SCOPE_SPLIT = /[,\\s]+/;\n\n    // Include default scope settings (cloned).\n    var scope = _this.settings.scope ? [_this.settings.scope.toString()] : [];\n\n    // Extend the providers scope list with the default\n    var scopeMap = utils.merge(_this.settings.scope_map, provider.scope || {});\n\n    // Add user defined scopes...\n    if (opts.scope) {\n      scope.push(opts.scope.toString());\n    }\n\n    // Append scopes from a previous session.\n    // This helps keep app credentials constant,\n    // Avoiding having to keep tabs on what scopes are authorized\n    if (session && 'scope' in session && session.scope instanceof String) {\n      scope.push(session.scope);\n    }\n\n    // Join and Split again\n    scope = scope.join(',').split(SCOPE_SPLIT);\n\n    // Format remove duplicates and empty values\n    scope = utils.unique(scope).filter(filterEmpty);\n\n    // Save the the scopes to the state with the names that they were requested with.\n    p.qs.state.scope = scope.join(',');\n\n    // Map scopes to the providers naming convention\n    scope = scope.map(function (item) {\n      // Does this have a mapping?\n      return item in scopeMap ? scopeMap[item] : item;\n    });\n\n    // Stringify and Arrayify so that double mapped scopes are given the chance to be formatted\n    scope = scope.join(',').split(SCOPE_SPLIT);\n\n    // Again...\n    // Format remove duplicates and empty values\n    scope = utils.unique(scope).filter(filterEmpty);\n\n    // Join with the expected scope delimiter into a string\n    p.qs.scope = scope.join(provider.scope_delim || ',');\n\n    // Is the user already signed in with the appropriate scopes, valid access_token?\n    if (opts.force === false) {\n      if (session && 'access_token' in session && session.access_token && 'expires' in session && session.expires > new Date().getTime() / 1e3) {\n        // What is different about the scopes in the session vs the scopes in the new login?\n        var diff = utils.diff((session.scope || '').split(SCOPE_SPLIT), (p.qs.state.scope || '').split(SCOPE_SPLIT));\n        if (diff.length === 0) {\n          // OK trigger the callback\n          promise.fulfill({\n            unchanged: true,\n            network: p.network,\n            authResponse: session\n          });\n\n          // Nothing has changed\n          return promise;\n        }\n      }\n    }\n\n    // Page URL\n    if (opts.display === 'page' && opts.page_uri) {\n      // Add a page location, place to endup after session has authenticated\n      p.qs.state.page_uri = utils.url(opts.page_uri).href;\n    }\n\n    // Bespoke\n    // Override login querystrings from auth_options\n    if ('login' in provider && typeof provider.login === 'function') {\n      // Format the paramaters according to the providers formatting function\n      provider.login(p);\n    }\n\n    // Add OAuth to state\n    // Where the service is going to take advantage of the oauth_proxy\n    if (!/\\btoken\\b/.test(responseType) || parseInt(provider.oauth.version, 10) < 2 || opts.display === 'none' && provider.oauth.grant && session && session.refresh_token) {\n      // Add the oauth endpoints\n      p.qs.state.oauth = provider.oauth;\n\n      // Add the proxy url\n      p.qs.state.oauth_proxy = opts.oauth_proxy;\n    }\n\n    // Convert state to a string\n    p.qs.state = encodeURIComponent(JSON.stringify(p.qs.state));\n\n    // URL\n    if (parseInt(provider.oauth.version, 10) === 1) {\n      // Turn the request to the OAuth Proxy for 3-legged auth\n      url = utils.qs(opts.oauth_proxy, p.qs, encodeFunction);\n    }\n\n    // Refresh token\n    else if (opts.display === 'none' && provider.oauth.grant && session && session.refresh_token) {\n      // Add the refresh_token to the request\n      p.qs.refresh_token = session.refresh_token;\n\n      // Define the request path\n      url = utils.qs(opts.oauth_proxy, p.qs, encodeFunction);\n    } else {\n      url = utils.qs(provider.oauth.auth, p.qs, encodeFunction);\n    }\n\n    // Broadcast this event as an auth:init\n    emit('auth.init', p);\n\n    // Execute\n    // Trigger how we want self displayed\n    if (opts.display === 'none') {\n      // Sign-in in the background, iframe\n      utils.iframe(url, redirectUri);\n    }\n\n    // Triggering popup?\n    else if (opts.display === 'popup') {\n      var popup = utils.popup(url, redirectUri, opts.popup);\n      var timer = setInterval(function () {\n        if (!popup || popup.closed) {\n          clearInterval(timer);\n          if (!promise.state) {\n            var response = error('cancelled', 'Login has been cancelled');\n            if (!popup) {\n              response = error('blocked', 'Popup was blocked');\n            }\n            response.network = p.network;\n            promise.reject(response);\n          }\n        }\n      }, 100);\n    } else {\n      window.location = url;\n    }\n    return promise.proxy;\n    function encodeFunction(s) {\n      return s;\n    }\n    function filterEmpty(s) {\n      return !!s;\n    }\n  },\n  // Remove any data associated with a given service\n  // @param string name of the service\n  // @param function callback\n  logout: function () {\n    var _this = this;\n    var utils = _this.utils;\n    var error = utils.error;\n\n    // Create a new promise\n    var promise = utils.Promise();\n    var p = utils.args({\n      name: 's',\n      options: 'o',\n      callback: 'f'\n    }, arguments);\n    p.options = p.options || {};\n\n    // Add callback to events\n    promise.proxy.then(p.callback, p.callback);\n\n    // Trigger an event on the global listener\n    function emit(s, value) {\n      hello.emit(s, value);\n    }\n    promise.proxy.then(emit.bind(this, 'auth.logout auth'), emit.bind(this, 'error'));\n\n    // Network\n    p.name = p.name || this.settings.default_service;\n    p.authResponse = utils.store(p.name);\n    if (p.name && !(p.name in _this.services)) {\n      promise.reject(error('invalid_network', 'The network was unrecognized'));\n    } else if (p.name && p.authResponse) {\n      // Define the callback\n      var callback = function (opts) {\n        // Remove from the store\n        utils.store(p.name, null);\n\n        // Emit events by default\n        promise.fulfill(hello.utils.merge({\n          network: p.name\n        }, opts || {}));\n      };\n\n      // Run an async operation to remove the users session\n      var _opts = {};\n      if (p.options.force) {\n        var logout = _this.services[p.name].logout;\n        if (logout) {\n          // Convert logout to URL string,\n          // If no string is returned, then this function will handle the logout async style\n          if (typeof logout === 'function') {\n            logout = logout(callback, p);\n          }\n\n          // If logout is a string then assume URL and open in iframe.\n          if (typeof logout === 'string') {\n            utils.iframe(logout);\n            _opts.force = null;\n            _opts.message = 'Logout success on providers site was indeterminate';\n          } else if (logout === undefined) {\n            // The callback function will handle the response.\n            return promise.proxy;\n          }\n        }\n      }\n\n      // Remove local credentials\n      callback(_opts);\n    } else {\n      promise.reject(error('invalid_session', 'There was no session to remove'));\n    }\n    return promise.proxy;\n  },\n  // Returns all the sessions that are subscribed too\n  // @param string optional, name of the service to get information about.\n  getAuthResponse: function (service) {\n    // If the service doesn't exist\n    service = service || this.settings.default_service;\n    if (!service || !(service in this.services)) {\n      return null;\n    }\n    return this.utils.store(service) || null;\n  },\n  // Events: placeholder for the events\n  events: {}\n});\n\n// Core utilities\nhello.utils.extend(hello.utils, {\n  // Error\n  error: function (code, message) {\n    return {\n      error: {\n        code: code,\n        message: message\n      }\n    };\n  },\n  // Append the querystring to a url\n  // @param string url\n  // @param object parameters\n  qs: function (url, params, formatFunction) {\n    if (params) {\n      // Set default formatting function\n      formatFunction = formatFunction || encodeURIComponent;\n\n      // Override the items in the URL which already exist\n      for (var x in params) {\n        var str = '([\\\\?\\\\&])' + x + '=[^\\\\&]*';\n        var reg = new RegExp(str);\n        if (url.match(reg)) {\n          url = url.replace(reg, '$1' + x + '=' + formatFunction(params[x]));\n          delete params[x];\n        }\n      }\n    }\n    if (!this.isEmpty(params)) {\n      return url + (url.indexOf('?') > -1 ? '&' : '?') + this.param(params, formatFunction);\n    }\n    return url;\n  },\n  // Param\n  // Explode/encode the parameters of an URL string/object\n  // @param string s, string to decode\n  param: function (s, formatFunction) {\n    var b;\n    var a = {};\n    var m;\n    if (typeof s === 'string') {\n      formatFunction = formatFunction || decodeURIComponent;\n      m = s.replace(/^[\\#\\?]/, '').match(/([^=\\/\\&]+)=([^\\&]+)/g);\n      if (m) {\n        for (var i = 0; i < m.length; i++) {\n          b = m[i].match(/([^=]+)=(.*)/);\n          a[b[1]] = formatFunction(b[2]);\n        }\n      }\n      return a;\n    } else {\n      formatFunction = formatFunction || encodeURIComponent;\n      var o = s;\n      a = [];\n      for (var x in o) {\n        if (o.hasOwnProperty(x)) {\n          if (o.hasOwnProperty(x)) {\n            a.push([x, o[x] === '?' ? '?' : formatFunction(o[x])].join('='));\n          }\n        }\n      }\n      return a.join('&');\n    }\n  },\n  // Local storage facade\n  store: function () {\n    var a = ['localStorage', 'sessionStorage'];\n    var i = -1;\n    var prefix = 'test';\n\n    // Set LocalStorage\n    var localStorage;\n    while (a[++i]) {\n      try {\n        // In Chrome with cookies blocked, calling localStorage throws an error\n        localStorage = window[a[i]];\n        localStorage.setItem(prefix + i, i);\n        localStorage.removeItem(prefix + i);\n        break;\n      } catch (e) {\n        localStorage = null;\n      }\n    }\n    if (!localStorage) {\n      var cache = null;\n      localStorage = {\n        getItem: function (prop) {\n          prop = prop + '=';\n          var m = document.cookie.split(';');\n          for (var i = 0; i < m.length; i++) {\n            var _m = m[i].replace(/(^\\s+|\\s+$)/, '');\n            if (_m && _m.indexOf(prop) === 0) {\n              return _m.substr(prop.length);\n            }\n          }\n          return cache;\n        },\n        setItem: function (prop, value) {\n          cache = value;\n          document.cookie = prop + '=' + value;\n        }\n      };\n\n      // Fill the cache up\n      cache = localStorage.getItem('hello');\n    }\n    function get() {\n      var json = {};\n      try {\n        json = JSON.parse(localStorage.getItem('hello')) || {};\n      } catch (e) {}\n      return json;\n    }\n    function set(json) {\n      localStorage.setItem('hello', JSON.stringify(json));\n    }\n\n    // Check if the browser support local storage\n    return function (name, value, days) {\n      // Local storage\n      var json = get();\n      if (name && value === undefined) {\n        return json[name] || null;\n      } else if (name && value === null) {\n        try {\n          delete json[name];\n        } catch (e) {\n          json[name] = null;\n        }\n      } else if (name) {\n        json[name] = value;\n      } else {\n        return json;\n      }\n      set(json);\n      return json || null;\n    };\n  }(),\n  // Create and Append new DOM elements\n  // @param node string\n  // @param attr object literal\n  // @param dom/string\n  append: function (node, attr, target) {\n    var n = typeof node === 'string' ? document.createElement(node) : node;\n    if (typeof attr === 'object') {\n      if ('tagName' in attr) {\n        target = attr;\n      } else {\n        for (var x in attr) {\n          if (attr.hasOwnProperty(x)) {\n            if (typeof attr[x] === 'object') {\n              for (var y in attr[x]) {\n                if (attr[x].hasOwnProperty(y)) {\n                  n[x][y] = attr[x][y];\n                }\n              }\n            } else if (x === 'html') {\n              n.innerHTML = attr[x];\n            }\n\n            // IE doesn't like us setting methods with setAttribute\n            else if (!/^on/.test(x)) {\n              n.setAttribute(x, attr[x]);\n            } else {\n              n[x] = attr[x];\n            }\n          }\n        }\n      }\n    }\n    if (target === 'body') {\n      (function self() {\n        if (document.body) {\n          document.body.appendChild(n);\n        } else {\n          setTimeout(self, 16);\n        }\n      })();\n    } else if (typeof target === 'object') {\n      target.appendChild(n);\n    } else if (typeof target === 'string') {\n      document.getElementsByTagName(target)[0].appendChild(n);\n    }\n    return n;\n  },\n  // An easy way to create a hidden iframe\n  // @param string src\n  iframe: function (src) {\n    this.append('iframe', {\n      src: src,\n      style: {\n        position: 'absolute',\n        left: '-1000px',\n        bottom: 0,\n        height: '1px',\n        width: '1px'\n      }\n    }, 'body');\n  },\n  // Recursive merge two objects into one, second parameter overides the first\n  // @param a array\n  merge: function /* Args: a, b, c, .. n */\n  () {\n    var args = Array.prototype.slice.call(arguments);\n    args.unshift({});\n    return this.extend.apply(null, args);\n  },\n  // Makes it easier to assign parameters, where some are optional\n  // @param o object\n  // @param a arguments\n  args: function (o, args) {\n    var p = {};\n    var i = 0;\n    var t = null;\n    var x = null;\n\n    // 'x' is the first key in the list of object parameters\n    for (x in o) {\n      if (o.hasOwnProperty(x)) {\n        break;\n      }\n    }\n\n    // Passing in hash object of arguments?\n    // Where the first argument can't be an object\n    if (args.length === 1 && typeof args[0] === 'object' && o[x] != 'o!') {\n      // Could this object still belong to a property?\n      // Check the object keys if they match any of the property keys\n      for (x in args[0]) {\n        if (o.hasOwnProperty(x)) {\n          // Does this key exist in the property list?\n          if (x in o) {\n            // Yes this key does exist so its most likely this function has been invoked with an object parameter\n            // Return first argument as the hash of all arguments\n            return args[0];\n          }\n        }\n      }\n    }\n\n    // Else loop through and account for the missing ones.\n    for (x in o) {\n      if (o.hasOwnProperty(x)) {\n        t = typeof args[i];\n        if (typeof o[x] === 'function' && o[x].test(args[i]) || typeof o[x] === 'string' && (o[x].indexOf('s') > -1 && t === 'string' || o[x].indexOf('o') > -1 && t === 'object' || o[x].indexOf('i') > -1 && t === 'number' || o[x].indexOf('a') > -1 && t === 'object' || o[x].indexOf('f') > -1 && t === 'function')) {\n          p[x] = args[i++];\n        } else if (typeof o[x] === 'string' && o[x].indexOf('!') > -1) {\n          return false;\n        }\n      }\n    }\n    return p;\n  },\n  // Returns a URL instance\n  url: function (path) {\n    // If the path is empty\n    if (!path) {\n      return window.location;\n    }\n\n    // Chrome and FireFox support new URL() to extract URL objects\n    else if (window.URL && URL instanceof Function && URL.length !== 0) {\n      return new URL(path, window.location);\n    }\n\n    // Ugly shim, it works!\n    else {\n      var a = document.createElement('a');\n      a.href = path;\n      return a.cloneNode(false);\n    }\n  },\n  diff: function (a, b) {\n    return b.filter(function (item) {\n      return a.indexOf(item) === -1;\n    });\n  },\n  // Get the different hash of properties unique to `a`, and not in `b`\n  diffKey: function (a, b) {\n    if (a || !b) {\n      var r = {};\n      for (var x in a) {\n        // Does the property not exist?\n        if (!(x in b)) {\n          r[x] = a[x];\n        }\n      }\n      return r;\n    }\n    return a;\n  },\n  // Unique\n  // Remove duplicate and null values from an array\n  // @param a array\n  unique: function (a) {\n    if (!Array.isArray(a)) {\n      return [];\n    }\n    return a.filter(function (item, index) {\n      // Is this the first location of item\n      return a.indexOf(item) === index;\n    });\n  },\n  isEmpty: function (obj) {\n    // Scalar\n    if (!obj) return true;\n\n    // Array\n    if (Array.isArray(obj)) {\n      return !obj.length;\n    } else if (typeof obj === 'object') {\n      // Object\n      for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          return false;\n        }\n      }\n    }\n    return true;\n  },\n  //jscs:disable\n\n  /*!\n   **  Thenable -- Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable\n   **  Copyright (c) 2013-2014 Ralf S. Engelschall <http://engelschall.com>\n   **  Licensed under The MIT License <http://opensource.org/licenses/MIT>\n   **  Source-Code distributed on <http://github.com/rse/thenable>\n   */\n  Promise: function () {\n    /*  promise states [Promises/A+ 2.1]  */\n    var STATE_PENDING = 0; /*  [Promises/A+ 2.1.1]  */\n    var STATE_FULFILLED = 1; /*  [Promises/A+ 2.1.2]  */\n    var STATE_REJECTED = 2; /*  [Promises/A+ 2.1.3]  */\n\n    /*  promise object constructor  */\n    var api = function (executor) {\n      /*  optionally support non-constructor/plain-function call  */\n      if (!(this instanceof api)) return new api(executor);\n\n      /*  initialize object  */\n      this.id = \"Thenable/1.0.6\";\n      this.state = STATE_PENDING; /*  initial state  */\n      this.fulfillValue = undefined; /*  initial value  */ /*  [Promises/A+ 1.3, 2.1.2.2]  */\n      this.rejectReason = undefined; /*  initial reason */ /*  [Promises/A+ 1.5, 2.1.3.2]  */\n      this.onFulfilled = []; /*  initial handlers  */\n      this.onRejected = []; /*  initial handlers  */\n\n      /*  provide optional information-hiding proxy  */\n      this.proxy = {\n        then: this.then.bind(this)\n      };\n\n      /*  support optional executor function  */\n      if (typeof executor === \"function\") executor.call(this, this.fulfill.bind(this), this.reject.bind(this));\n    };\n\n    /*  promise API methods  */\n    api.prototype = {\n      /*  promise resolving methods  */\n      fulfill: function (value) {\n        return deliver(this, STATE_FULFILLED, \"fulfillValue\", value);\n      },\n      reject: function (value) {\n        return deliver(this, STATE_REJECTED, \"rejectReason\", value);\n      },\n      /*  \"The then Method\" [Promises/A+ 1.1, 1.2, 2.2]  */\n      then: function (onFulfilled, onRejected) {\n        var curr = this;\n        var next = new api(); /*  [Promises/A+ 2.2.7]  */\n        curr.onFulfilled.push(resolver(onFulfilled, next, \"fulfill\")); /*  [Promises/A+ 2.2.2/2.2.6]  */\n        curr.onRejected.push(resolver(onRejected, next, \"reject\")); /*  [Promises/A+ 2.2.3/2.2.6]  */\n        execute(curr);\n        return next.proxy; /*  [Promises/A+ 2.2.7, 3.3]  */\n      }\n    };\n\n    /*  deliver an action  */\n    var deliver = function (curr, state, name, value) {\n      if (curr.state === STATE_PENDING) {\n        curr.state = state; /*  [Promises/A+ 2.1.2.1, 2.1.3.1]  */\n        curr[name] = value; /*  [Promises/A+ 2.1.2.2, 2.1.3.2]  */\n        execute(curr);\n      }\n      return curr;\n    };\n\n    /*  execute all handlers  */\n    var execute = function (curr) {\n      if (curr.state === STATE_FULFILLED) execute_handlers(curr, \"onFulfilled\", curr.fulfillValue);else if (curr.state === STATE_REJECTED) execute_handlers(curr, \"onRejected\", curr.rejectReason);\n    };\n\n    /*  execute particular set of handlers  */\n    var execute_handlers = function (curr, name, value) {\n      /* global process: true */\n      /* global setImmediate: true */\n      /* global setTimeout: true */\n\n      /*  short-circuit processing  */\n      if (curr[name].length === 0) return;\n\n      /*  iterate over all handlers, exactly once  */\n      var handlers = curr[name];\n      curr[name] = []; /*  [Promises/A+ 2.2.2.3, 2.2.3.3]  */\n      var func = function () {\n        for (var i = 0; i < handlers.length; i++) handlers[i](value); /*  [Promises/A+ 2.2.5]  */\n      };\n\n      /*  execute procedure asynchronously  */ /*  [Promises/A+ 2.2.4, 3.1]  */\n      if (typeof process === \"object\" && typeof process.nextTick === \"function\") process.nextTick(func);else if (typeof setImmediate === \"function\") setImmediate(func);else setTimeout(func, 0);\n    };\n\n    /*  generate a resolver function  */\n    var resolver = function (cb, next, method) {\n      return function (value) {\n        if (typeof cb !== \"function\") /*  [Promises/A+ 2.2.1, 2.2.7.3, 2.2.7.4]  */\n          next[method].call(next, value); /*  [Promises/A+ 2.2.7.3, 2.2.7.4]  */else {\n          var result;\n          try {\n            result = cb(value);\n          } /*  [Promises/A+ 2.2.2.1, 2.2.3.1, 2.2.5, 3.2]  */ catch (e) {\n            next.reject(e); /*  [Promises/A+ 2.2.7.2]  */\n            return;\n          }\n          resolve(next, result); /*  [Promises/A+ 2.2.7.1]  */\n        }\n      };\n    };\n\n    /*  \"Promise Resolution Procedure\"  */ /*  [Promises/A+ 2.3]  */\n    var resolve = function (promise, x) {\n      /*  sanity check arguments  */ /*  [Promises/A+ 2.3.1]  */\n      if (promise === x || promise.proxy === x) {\n        promise.reject(new TypeError(\"cannot resolve promise with itself\"));\n        return;\n      }\n\n      /*  surgically check for a \"then\" method\n      \t(mainly to just call the \"getter\" of \"then\" only once)  */\n      var then;\n      if (typeof x === \"object\" && x !== null || typeof x === \"function\") {\n        try {\n          then = x.then;\n        } /*  [Promises/A+ 2.3.3.1, 3.5]  */ catch (e) {\n          promise.reject(e); /*  [Promises/A+ 2.3.3.2]  */\n          return;\n        }\n      }\n\n      /*  handle own Thenables    [Promises/A+ 2.3.2]\n      \tand similar \"thenables\" [Promises/A+ 2.3.3]  */\n      if (typeof then === \"function\") {\n        var resolved = false;\n        try {\n          /*  call retrieved \"then\" method */ /*  [Promises/A+ 2.3.3.3]  */\n          then.call(x, /*  resolvePromise  */ /*  [Promises/A+ 2.3.3.3.1]  */\n          function (y) {\n            if (resolved) return;\n            resolved = true; /*  [Promises/A+ 2.3.3.3.3]  */\n            if (y === x) /*  [Promises/A+ 3.6]  */\n              promise.reject(new TypeError(\"circular thenable chain\"));else resolve(promise, y);\n          }, /*  rejectPromise  */ /*  [Promises/A+ 2.3.3.3.2]  */\n          function (r) {\n            if (resolved) return;\n            resolved = true; /*  [Promises/A+ 2.3.3.3.3]  */\n            promise.reject(r);\n          });\n        } catch (e) {\n          if (!resolved) /*  [Promises/A+ 2.3.3.3.3]  */\n            promise.reject(e); /*  [Promises/A+ 2.3.3.3.4]  */\n        }\n\n        return;\n      }\n\n      /*  handle other values  */\n      promise.fulfill(x); /*  [Promises/A+ 2.3.4, 2.3.3.4]  */\n    };\n\n    /*  export API  */\n    return api;\n  }(),\n  //jscs:enable\n\n  // Event\n  // A contructor superclass for adding event menthods, on, off, emit.\n  Event: function () {\n    var separator = /[\\s\\,]+/;\n\n    // If this doesn't support getPrototype then we can't get prototype.events of the parent\n    // So lets get the current instance events, and add those to a parent property\n    this.parent = {\n      events: this.events,\n      findEvents: this.findEvents,\n      parent: this.parent,\n      utils: this.utils\n    };\n    this.events = {};\n\n    // On, subscribe to events\n    // @param evt   string\n    // @param callback  function\n    this.on = function (evt, callback) {\n      if (callback && typeof callback === 'function') {\n        var a = evt.split(separator);\n        for (var i = 0; i < a.length; i++) {\n          // Has this event already been fired on this instance?\n          this.events[a[i]] = [callback].concat(this.events[a[i]] || []);\n        }\n      }\n      return this;\n    };\n\n    // Off, unsubscribe to events\n    // @param evt   string\n    // @param callback  function\n    this.off = function (evt, callback) {\n      this.findEvents(evt, function (name, index) {\n        if (!callback || this.events[name][index] === callback) {\n          this.events[name][index] = null;\n        }\n      });\n      return this;\n    };\n\n    // Emit\n    // Triggers any subscribed events\n    this.emit = function (evt /*, data, ... */) {\n      // Get arguments as an Array, knock off the first one\n      var args = Array.prototype.slice.call(arguments, 1);\n      args.push(evt);\n\n      // Handler\n      var handler = function (name, index) {\n        // Replace the last property with the event name\n        args[args.length - 1] = name === '*' ? evt : name;\n\n        // Trigger\n        this.events[name][index].apply(this, args);\n      };\n\n      // Find the callbacks which match the condition and call\n      var _this = this;\n      while (_this && _this.findEvents) {\n        // Find events which match\n        _this.findEvents(evt + ',*', handler);\n        _this = _this.parent;\n      }\n      return this;\n    };\n\n    //\n    // Easy functions\n    this.emitAfter = function () {\n      var _this = this;\n      var args = arguments;\n      setTimeout(function () {\n        _this.emit.apply(_this, args);\n      }, 0);\n      return this;\n    };\n    this.findEvents = function (evt, callback) {\n      var a = evt.split(separator);\n      for (var name in this.events) {\n        if (this.events.hasOwnProperty(name)) {\n          if (a.indexOf(name) > -1) {\n            for (var i = 0; i < this.events[name].length; i++) {\n              // Does the event handler exist?\n              if (this.events[name][i]) {\n                // Emit on the local instance of this\n                callback.call(this, name, i);\n              }\n            }\n          }\n        }\n      }\n    };\n    return this;\n  },\n  // Global Events\n  // Attach the callback to the window object\n  // Return its unique reference\n  globalEvent: function (callback, guid) {\n    // If the guid has not been supplied then create a new one.\n    guid = guid || '_hellojs_' + parseInt(Math.random() * 1e12, 10).toString(36);\n\n    // Define the callback function\n    window[guid] = function () {\n      // Trigger the callback\n      try {\n        if (callback.apply(this, arguments)) {\n          delete window[guid];\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    };\n    return guid;\n  },\n  // Trigger a clientside popup\n  // This has been augmented to support PhoneGap\n  popup: function (url, redirectUri, options) {\n    var documentElement = document.documentElement;\n\n    // Multi Screen Popup Positioning (http://stackoverflow.com/a/16861050)\n    // Credit: http://www.xtf.dk/2011/08/center-new-popup-window-even-on.html\n    // Fixes dual-screen position                         Most browsers      Firefox\n\n    if (options.height && options.top === undefined) {\n      var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n      var height = screen.height || window.innerHeight || documentElement.clientHeight;\n      options.top = parseInt((height - options.height) / 2, 10) + dualScreenTop;\n    }\n    if (options.width && options.left === undefined) {\n      var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n      var width = screen.width || window.innerWidth || documentElement.clientWidth;\n      options.left = parseInt((width - options.width) / 2, 10) + dualScreenLeft;\n    }\n\n    // Convert options into an array\n    var optionsArray = [];\n    Object.keys(options).forEach(function (name) {\n      var value = options[name];\n      optionsArray.push(name + (value !== null ? '=' + value : ''));\n    });\n\n    // Call the open() function with the initial path\n    //\n    // OAuth redirect, fixes URI fragments from being lost in Safari\n    // (URI Fragments within 302 Location URI are lost over HTTPS)\n    // Loading the redirect.html before triggering the OAuth Flow seems to fix it.\n    //\n    // Firefox  decodes URL fragments when calling location.hash.\n    //  - This is bad if the value contains break points which are escaped\n    //  - Hence the url must be encoded twice as it contains breakpoints.\n    if (navigator.userAgent.indexOf('Safari') !== -1 && navigator.userAgent.indexOf('Chrome') === -1) {\n      url = redirectUri + '#oauth_redirect=' + encodeURIComponent(encodeURIComponent(url));\n    }\n    var popup = window.open(url, '_blank', optionsArray.join(','));\n    if (popup && popup.focus) {\n      popup.focus();\n    }\n    return popup;\n  },\n  // OAuth and API response handler\n  responseHandler: function (window, parent) {\n    var _this = this;\n    var p;\n    var location = window.location;\n\n    // Is this an auth relay message which needs to call the proxy?\n    p = _this.param(location.search);\n\n    // OAuth2 or OAuth1 server response?\n    if (p && p.state && (p.code || p.oauth_token)) {\n      var state = JSON.parse(p.state);\n\n      // Add this path as the redirect_uri\n      p.redirect_uri = state.redirect_uri || location.href.replace(/[\\?\\#].*$/, '');\n\n      // Redirect to the host\n      var path = _this.qs(state.oauth_proxy, p);\n      location.assign(path);\n      return;\n    }\n\n    // Save session, from redirected authentication\n    // #access_token has come in?\n    //\n    // FACEBOOK is returning auth errors within as a query_string... thats a stickler for consistency.\n    // SoundCloud is the state in the querystring and the token in the hashtag, so we'll mix the two together\n\n    p = _this.merge(_this.param(location.search || ''), _this.param(location.hash || ''));\n\n    // If p.state\n    if (p && 'state' in p) {\n      // Remove any addition information\n      // E.g. p.state = 'facebook.page';\n      try {\n        var a = JSON.parse(p.state);\n        _this.extend(p, a);\n      } catch (e) {\n        var stateDecoded = decodeURIComponent(p.state);\n        try {\n          var b = JSON.parse(stateDecoded);\n          _this.extend(p, b);\n        } catch (e) {\n          console.error('Could not decode state parameter');\n        }\n      }\n\n      // Access_token?\n      if ('access_token' in p && p.access_token && p.network) {\n        if (!p.expires_in || parseInt(p.expires_in, 10) === 0) {\n          // If p.expires_in is unset, set to 0\n          p.expires_in = 0;\n        }\n        p.expires_in = parseInt(p.expires_in, 10);\n        p.expires = new Date().getTime() / 1e3 + (p.expires_in || 60 * 60 * 24 * 365);\n\n        // Lets use the \"state\" to assign it to one of our networks\n        authCallback(p, window, parent);\n      }\n\n      // Error=?\n      // &error_description=?\n      // &state=?\n      else if ('error' in p && p.error && p.network) {\n        p.error = {\n          code: p.error,\n          message: p.error_message || p.error_description\n        };\n\n        // Let the state handler handle it\n        authCallback(p, window, parent);\n      }\n\n      // API call, or a cancelled login\n      // Result is serialized JSON string\n      else if (p.callback && p.callback in parent) {\n        // Trigger a function in the parent\n        var res = 'result' in p && p.result ? JSON.parse(p.result) : false;\n\n        // Trigger the callback on the parent\n        callback(parent, p.callback)(res);\n        closeWindow();\n      }\n\n      // If this page is still open\n      if (p.page_uri) {\n        location.assign(p.page_uri);\n      }\n    }\n\n    // OAuth redirect, fixes URI fragments from being lost in Safari\n    // (URI Fragments within 302 Location URI are lost over HTTPS)\n    // Loading the redirect.html before triggering the OAuth Flow seems to fix it.\n    else if ('oauth_redirect' in p) {\n      location.assign(decodeURIComponent(p.oauth_redirect));\n      return;\n    }\n\n    // Trigger a callback to authenticate\n    function authCallback(obj, window, parent) {\n      var cb = obj.callback;\n      var network = obj.network;\n\n      // Trigger the callback on the parent\n      _this.store(network, obj);\n\n      // If this is a page request it has no parent or opener window to handle callbacks\n      if ('display' in obj && obj.display === 'page') {\n        return;\n      }\n\n      // Remove from session object\n      if (parent && cb && cb in parent) {\n        try {\n          delete obj.callback;\n        } catch (e) {}\n\n        // Update store\n        _this.store(network, obj);\n\n        // Call the globalEvent function on the parent\n        // It's safer to pass back a string to the parent,\n        // Rather than an object/array (better for IE8)\n        var str = JSON.stringify(obj);\n        try {\n          callback(parent, cb)(str);\n        } catch (e) {\n          // Error thrown whilst executing parent callback\n        }\n      }\n      closeWindow();\n    }\n    function callback(parent, callbackID) {\n      if (callbackID.indexOf('_hellojs_') !== 0) {\n        return function () {\n          throw 'Could not execute callback ' + callbackID;\n        };\n      }\n      return parent[callbackID];\n    }\n    function closeWindow() {\n      if (window.frameElement) {\n        // Inside an iframe, remove from parent\n        parent.document.body.removeChild(window.frameElement);\n      } else {\n        // Close this current window\n        try {\n          window.close();\n        } catch (e) {}\n\n        // IOS bug wont let us close a popup if still loading\n        if (window.addEventListener) {\n          window.addEventListener('load', function () {\n            window.close();\n          });\n        }\n      }\n    }\n  }\n});\n\n// Events\n// Extend the hello object with its own event instance\nhello.utils.Event.call(hello);\n\n///////////////////////////////////\n// Monitoring session state\n// Check for session changes\n///////////////////////////////////\n\n(function (hello) {\n  // Monitor for a change in state and fire\n  var oldSessions = {};\n\n  // Hash of expired tokens\n  var expired = {};\n\n  // Listen to other triggers to Auth events, use these to update this\n  hello.on('auth.login, auth.logout', function (auth) {\n    if (auth && typeof auth === 'object' && auth.network) {\n      oldSessions[auth.network] = hello.utils.store(auth.network) || {};\n    }\n  });\n  (function self() {\n    var CURRENT_TIME = new Date().getTime() / 1e3;\n    var emit = function (eventName) {\n      hello.emit('auth.' + eventName, {\n        network: name,\n        authResponse: session\n      });\n    };\n\n    // Loop through the services\n    for (var name in hello.services) {\n      if (hello.services.hasOwnProperty(name)) {\n        if (!hello.services[name].id) {\n          // We haven't attached an ID so dont listen.\n          continue;\n        }\n\n        // Get session\n        var session = hello.utils.store(name) || {};\n        var provider = hello.services[name];\n        var oldSess = oldSessions[name] || {};\n\n        // Listen for globalEvents that did not get triggered from the child\n        if (session && 'callback' in session) {\n          // To do remove from session object...\n          var cb = session.callback;\n          try {\n            delete session.callback;\n          } catch (e) {}\n\n          // Update store\n          // Removing the callback\n          hello.utils.store(name, session);\n\n          // Emit global events\n          try {\n            window[cb](session);\n          } catch (e) {}\n        }\n\n        // Refresh token\n        if (session && 'expires' in session && session.expires < CURRENT_TIME) {\n          // If auto refresh is possible\n          // Either the browser supports\n          var refresh = provider.refresh || session.refresh_token;\n\n          // Has the refresh been run recently?\n          if (refresh && (!(name in expired) || expired[name] < CURRENT_TIME)) {\n            // Try to resignin\n            hello.emit('notice', name + ' has expired trying to resignin');\n            hello.login(name, {\n              display: 'none',\n              force: false\n            });\n\n            // Update expired, every 10 minutes\n            expired[name] = CURRENT_TIME + 600;\n          }\n\n          // Does this provider not support refresh\n          else if (!refresh && !(name in expired)) {\n            // Label the event\n            emit('expired');\n            expired[name] = true;\n          }\n\n          // If session has expired then we dont want to store its value until it can be established that its been updated\n          continue;\n        }\n\n        // Has session changed?\n        else if (oldSess.access_token === session.access_token && oldSess.expires === session.expires) {\n          continue;\n        }\n\n        // Access_token has been removed\n        else if (!session.access_token && oldSess.access_token) {\n          emit('logout');\n        }\n\n        // Access_token has been created\n        else if (session.access_token && !oldSess.access_token) {\n          emit('login');\n        }\n\n        // Access_token has been updated\n        else if (session.expires !== oldSess.expires) {\n          emit('update');\n        }\n\n        // Updated stored session\n        oldSessions[name] = session;\n\n        // Remove the expired flags\n        if (name in expired) {\n          delete expired[name];\n        }\n      }\n    }\n\n    // Check error events\n    setTimeout(self, 1000);\n  })();\n})(hello);\n\n// EOF CORE lib\n//////////////////////////////////\n\n/////////////////////////////////////////\n// API\n// @param path    string\n// @param query   object (optional)\n// @param method  string (optional)\n// @param data    object (optional)\n// @param timeout integer (optional)\n// @param callback  function (optional)\n\nhello.api = function () {\n  // Shorthand\n  var _this = this;\n  var utils = _this.utils;\n  var error = utils.error;\n\n  // Construct a new Promise object\n  var promise = utils.Promise();\n\n  // Arguments\n  var p = utils.args({\n    path: 's!',\n    query: 'o',\n    method: 's',\n    data: 'o',\n    timeout: 'i',\n    callback: 'f'\n  }, arguments);\n\n  // Method\n  p.method = (p.method || 'get').toLowerCase();\n\n  // Headers\n  p.headers = p.headers || {};\n\n  // Query\n  p.query = p.query || {};\n\n  // If get, put all parameters into query\n  if (p.method === 'get' || p.method === 'delete') {\n    utils.extend(p.query, p.data);\n    p.data = {};\n  }\n  var data = p.data = p.data || {};\n\n  // Completed event callback\n  promise.then(p.callback, p.callback);\n\n  // Remove the network from path, e.g. facebook:/me/friends\n  // Results in { network : facebook, path : me/friends }\n  if (!p.path) {\n    return promise.reject(error('invalid_path', 'Missing the path parameter from the request'));\n  }\n  p.path = p.path.replace(/^\\/+/, '');\n  var a = (p.path.split(/[\\/\\:]/, 2) || [])[0].toLowerCase();\n  if (a in _this.services) {\n    p.network = a;\n    var reg = new RegExp('^' + a + ':?\\/?');\n    p.path = p.path.replace(reg, '');\n  }\n\n  // Network & Provider\n  // Define the network that this request is made for\n  p.network = _this.settings.default_service = p.network || _this.settings.default_service;\n  var o = _this.services[p.network];\n\n  // INVALID\n  // Is there no service by the given network name?\n  if (!o) {\n    return promise.reject(error('invalid_network', 'Could not match the service requested: ' + p.network));\n  }\n\n  // PATH\n  // As long as the path isn't flagged as unavaiable, e.g. path == false\n\n  if (!(!(p.method in o) || !(p.path in o[p.method]) || o[p.method][p.path] !== false)) {\n    return promise.reject(error('invalid_path', 'The provided path is not available on the selected network'));\n  }\n\n  // PROXY\n  // OAuth1 calls always need a proxy\n\n  if (!p.oauth_proxy) {\n    p.oauth_proxy = _this.settings.oauth_proxy;\n  }\n  if (!('proxy' in p)) {\n    p.proxy = p.oauth_proxy && o.oauth && parseInt(o.oauth.version, 10) === 1;\n  }\n\n  // TIMEOUT\n  // Adopt timeout from global settings by default\n\n  if (!('timeout' in p)) {\n    p.timeout = _this.settings.timeout;\n  }\n\n  // Format response\n  // Whether to run the raw response through post processing.\n  if (!('formatResponse' in p)) {\n    p.formatResponse = true;\n  }\n\n  // Get the current session\n  // Append the access_token to the query\n  p.authResponse = _this.getAuthResponse(p.network);\n  if (p.authResponse && p.authResponse.access_token) {\n    p.query.access_token = p.authResponse.access_token;\n  }\n  var url = p.path;\n  var m;\n\n  // Store the query as options\n  // This is used to populate the request object before the data is augmented by the prewrap handlers.\n  p.options = utils.clone(p.query);\n\n  // Clone the data object\n  // Prevent this script overwriting the data of the incoming object.\n  // Ensure that everytime we run an iteration the callbacks haven't removed some data\n  p.data = utils.clone(data);\n\n  // URL Mapping\n  // Is there a map for the given URL?\n  var actions = o[{\n    'delete': 'del'\n  }[p.method] || p.method] || {};\n\n  // Extrapolate the QueryString\n  // Provide a clean path\n  // Move the querystring into the data\n  if (p.method === 'get') {\n    var query = url.split(/[\\?#]/)[1];\n    if (query) {\n      utils.extend(p.query, utils.param(query));\n\n      // Remove the query part from the URL\n      url = url.replace(/\\?.*?(#|$)/, '$1');\n    }\n  }\n\n  // Is the hash fragment defined\n  if (m = url.match(/#(.+)/, '')) {\n    url = url.split('#')[0];\n    p.path = m[1];\n  } else if (url in actions) {\n    p.path = url;\n    url = actions[url];\n  } else if ('default' in actions) {\n    url = actions['default'];\n  }\n\n  // Redirect Handler\n  // This defines for the Form+Iframe+Hash hack where to return the results too.\n  p.redirect_uri = _this.settings.redirect_uri;\n\n  // Define FormatHandler\n  // The request can be procesed in a multitude of ways\n  // Here's the options - depending on the browser and endpoint\n  p.xhr = o.xhr;\n  p.jsonp = o.jsonp;\n  p.form = o.form;\n\n  // Make request\n  if (typeof url === 'function') {\n    // Does self have its own callback?\n    url(p, getPath);\n  } else {\n    // Else the URL is a string\n    getPath(url);\n  }\n  return promise.proxy;\n\n  // If url needs a base\n  // Wrap everything in\n  function getPath(url) {\n    // Format the string if it needs it\n    url = url.replace(/\\@\\{([a-z\\_\\-]+)(\\|.*?)?\\}/gi, function (m, key, defaults) {\n      var val = defaults ? defaults.replace(/^\\|/, '') : '';\n      if (key in p.query) {\n        val = p.query[key];\n        delete p.query[key];\n      } else if (p.data && key in p.data) {\n        val = p.data[key];\n        delete p.data[key];\n      } else if (!defaults) {\n        promise.reject(error('missing_attribute', 'The attribute ' + key + ' is missing from the request'));\n      }\n      return val;\n    });\n\n    // Add base\n    if (!url.match(/^https?:\\/\\//)) {\n      url = o.base + url;\n    }\n\n    // Define the request URL\n    p.url = url;\n\n    // Make the HTTP request with the curated request object\n    // CALLBACK HANDLER\n    // @ response object\n    // @ statusCode integer if available\n    utils.request(p, function (r, headers) {\n      // Is this a raw response?\n      if (!p.formatResponse) {\n        // Bad request? error statusCode or otherwise contains an error response vis JSONP?\n        if (typeof headers === 'object' ? headers.statusCode >= 400 : typeof r === 'object' && 'error' in r) {\n          promise.reject(r);\n        } else {\n          promise.fulfill(r);\n        }\n        return;\n      }\n\n      // Should this be an object\n      if (r === true) {\n        r = {\n          success: true\n        };\n      } else if (!r) {\n        r = {};\n      }\n\n      // The delete callback needs a better response\n      if (p.method === 'delete') {\n        r = !r || utils.isEmpty(r) ? {\n          success: true\n        } : r;\n      }\n\n      // FORMAT RESPONSE?\n      // Does self request have a corresponding formatter\n      if (o.wrap && (p.path in o.wrap || 'default' in o.wrap)) {\n        var wrap = p.path in o.wrap ? p.path : 'default';\n        var time = new Date().getTime();\n\n        // FORMAT RESPONSE\n        var b = o.wrap[wrap](r, headers, p);\n\n        // Has the response been utterly overwritten?\n        // Typically self augments the existing object.. but for those rare occassions\n        if (b) {\n          r = b;\n        }\n      }\n\n      // Is there a next_page defined in the response?\n      if (r && 'paging' in r && r.paging.next) {\n        // Add the relative path if it is missing from the paging/next path\n        if (r.paging.next[0] === '?') {\n          r.paging.next = p.path + r.paging.next;\n        }\n\n        // The relative path has been defined, lets markup the handler in the HashFragment\n        else {\n          r.paging.next += '#' + p.path;\n        }\n      }\n\n      // Dispatch to listeners\n      // Emit events which pertain to the formatted response\n      if (!r || 'error' in r) {\n        promise.reject(r);\n      } else {\n        promise.fulfill(r);\n      }\n    });\n  }\n};\n\n// API utilities\nhello.utils.extend(hello.utils, {\n  // Make an HTTP request\n  request: function (p, callback) {\n    var _this = this;\n    var error = _this.error;\n\n    // This has to go through a POST request\n    if (!_this.isEmpty(p.data) && !('FileList' in window) && _this.hasBinary(p.data)) {\n      // Disable XHR and JSONP\n      p.xhr = false;\n      p.jsonp = false;\n    }\n\n    // Check if the browser and service support CORS\n    var cors = this.request_cors(function () {\n      // If it does then run this...\n      return p.xhr === undefined || p.xhr && (typeof p.xhr !== 'function' || p.xhr(p, p.query));\n    });\n    if (cors) {\n      formatUrl(p, function (url) {\n        var x = _this.xhr(p.method, url, p.headers, p.data, callback);\n        x.onprogress = p.onprogress || null;\n\n        // Windows Phone does not support xhr.upload, see #74\n        // Feature detect\n        if (x.upload && p.onuploadprogress) {\n          x.upload.onprogress = p.onuploadprogress;\n        }\n      });\n      return;\n    }\n\n    // Clone the query object\n    // Each request modifies the query object and needs to be tared after each one.\n    var _query = p.query;\n    p.query = _this.clone(p.query);\n\n    // Assign a new callbackID\n    p.callbackID = _this.globalEvent();\n\n    // JSONP\n    if (p.jsonp !== false) {\n      // Clone the query object\n      p.query.callback = p.callbackID;\n\n      // If the JSONP is a function then run it\n      if (typeof p.jsonp === 'function') {\n        p.jsonp(p, p.query);\n      }\n\n      // Lets use JSONP if the method is 'get'\n      if (p.method === 'get') {\n        formatUrl(p, function (url) {\n          _this.jsonp(url, callback, p.callbackID, p.timeout);\n        });\n        return;\n      } else {\n        // It's not compatible reset query\n        p.query = _query;\n      }\n    }\n\n    // Otherwise we're on to the old school, iframe hacks and JSONP\n    if (p.form !== false) {\n      // Add some additional query parameters to the URL\n      // We're pretty stuffed if the endpoint doesn't like these\n      p.query.redirect_uri = p.redirect_uri;\n      p.query.state = JSON.stringify({\n        callback: p.callbackID\n      });\n      var opts;\n      if (typeof p.form === 'function') {\n        // Format the request\n        opts = p.form(p, p.query);\n      }\n      if (p.method === 'post' && opts !== false) {\n        formatUrl(p, function (url) {\n          _this.post(url, p.data, opts, callback, p.callbackID, p.timeout);\n        });\n        return;\n      }\n    }\n\n    // None of the methods were successful throw an error\n    callback(error('invalid_request', 'There was no mechanism for handling this request'));\n    return;\n\n    // Format URL\n    // Constructs the request URL, optionally wraps the URL through a call to a proxy server\n    // Returns the formatted URL\n    function formatUrl(p, callback) {\n      // Are we signing the request?\n      var sign;\n\n      // OAuth1\n      // Remove the token from the query before signing\n      if (p.authResponse && p.authResponse.oauth && parseInt(p.authResponse.oauth.version, 10) === 1) {\n        // OAUTH SIGNING PROXY\n        sign = p.query.access_token;\n\n        // Remove the access_token\n        delete p.query.access_token;\n\n        // Enfore use of Proxy\n        p.proxy = true;\n      }\n\n      // POST body to querystring\n      if (p.data && (p.method === 'get' || p.method === 'delete')) {\n        // Attach the p.data to the querystring.\n        _this.extend(p.query, p.data);\n        p.data = null;\n      }\n\n      // Construct the path\n      var path = _this.qs(p.url, p.query);\n\n      // Proxy the request through a server\n      // Used for signing OAuth1\n      // And circumventing services without Access-Control Headers\n      if (p.proxy) {\n        // Use the proxy as a path\n        path = _this.qs(p.oauth_proxy, {\n          path: path,\n          access_token: sign || '',\n          // This will prompt the request to be signed as though it is OAuth1\n          then: p.proxy_response_type || (p.method.toLowerCase() === 'get' ? 'redirect' : 'proxy'),\n          method: p.method.toLowerCase(),\n          suppress_response_codes: true\n        });\n      }\n      callback(path);\n    }\n  },\n  // Test whether the browser supports the CORS response\n  request_cors: function (callback) {\n    return 'withCredentials' in new XMLHttpRequest() && callback();\n  },\n  // Return the type of DOM object\n  domInstance: function (type, data) {\n    var test = 'HTML' + (type || '').replace(/^[a-z]/, function (m) {\n      return m.toUpperCase();\n    }) + 'Element';\n    if (!data) {\n      return false;\n    }\n    if (window[test]) {\n      return data instanceof window[test];\n    } else if (window.Element) {\n      return data instanceof window.Element && (!type || data.tagName && data.tagName.toLowerCase() === type);\n    } else {\n      return !(data instanceof Object || data instanceof Array || data instanceof String || data instanceof Number) && data.tagName && data.tagName.toLowerCase() === type;\n    }\n  },\n  // Create a clone of an object\n  clone: function (obj) {\n    // Does not clone DOM elements, nor Binary data, e.g. Blobs, Filelists\n    if (obj === null || typeof obj !== 'object' || obj instanceof Date || 'nodeName' in obj || this.isBinary(obj) || typeof FormData === 'function' && obj instanceof FormData) {\n      return obj;\n    }\n    if (Array.isArray(obj)) {\n      // Clone each item in the array\n      return obj.map(this.clone.bind(this));\n    }\n\n    // But does clone everything else.\n    var clone = {};\n    for (var x in obj) {\n      clone[x] = this.clone(obj[x]);\n    }\n    return clone;\n  },\n  // XHR: uses CORS to make requests\n  xhr: function (method, url, headers, data, callback) {\n    var r = new XMLHttpRequest();\n    var error = this.error;\n\n    // Binary?\n    var binary = false;\n    if (method === 'blob') {\n      binary = method;\n      method = 'GET';\n    }\n    method = method.toUpperCase();\n\n    // Xhr.responseType 'json' is not supported in any of the vendors yet.\n    r.onload = function (e) {\n      var json = r.response;\n      try {\n        json = JSON.parse(r.responseText);\n      } catch (_e) {\n        if (r.status === 401) {\n          json = error('access_denied', r.statusText);\n        }\n      }\n      var headers = headersToJSON(r.getAllResponseHeaders());\n      headers.statusCode = r.status;\n      callback(json || (method === 'GET' ? error('empty_response', 'Could not get resource') : {}), headers);\n    };\n    r.onerror = function (e) {\n      var json = r.responseText;\n      try {\n        json = JSON.parse(r.responseText);\n      } catch (_e) {}\n      callback(json || error('access_denied', 'Could not get resource'));\n    };\n    var x;\n\n    // Should we add the query to the URL?\n    if (method === 'GET' || method === 'DELETE') {\n      data = null;\n    } else if (data && typeof data !== 'string' && !(data instanceof FormData) && !(data instanceof File) && !(data instanceof Blob)) {\n      // Loop through and add formData\n      var f = new FormData();\n      for (x in data) if (data.hasOwnProperty(x)) {\n        if (data[x] instanceof HTMLInputElement) {\n          if ('files' in data[x] && data[x].files.length > 0) {\n            f.append(x, data[x].files[0]);\n          }\n        } else if (data[x] instanceof Blob) {\n          f.append(x, data[x], data.name);\n        } else {\n          f.append(x, data[x]);\n        }\n      }\n      data = f;\n    }\n\n    // Open the path, async\n    r.open(method, url, true);\n    if (binary) {\n      if ('responseType' in r) {\n        r.responseType = binary;\n      } else {\n        r.overrideMimeType('text/plain; charset=x-user-defined');\n      }\n    }\n\n    // Set any bespoke headers\n    if (headers) {\n      for (x in headers) {\n        r.setRequestHeader(x, headers[x]);\n      }\n    }\n    r.send(data);\n    return r;\n\n    // Headers are returned as a string\n    function headersToJSON(s) {\n      var r = {};\n      var reg = /([a-z\\-]+):\\s?(.*);?/gi;\n      var m;\n      while (m = reg.exec(s)) {\n        r[m[1]] = m[2];\n      }\n      return r;\n    }\n  },\n  // JSONP\n  // Injects a script tag into the DOM to be executed and appends a callback function to the window object\n  // @param string/function pathFunc either a string of the URL or a callback function pathFunc(querystringhash, continueFunc);\n  // @param function callback a function to call on completion;\n  jsonp: function (url, callback, callbackID, timeout) {\n    var _this = this;\n    var error = _this.error;\n\n    // Change the name of the callback\n    var bool = 0;\n    var head = document.getElementsByTagName('head')[0];\n    var operaFix;\n    var result = error('server_error', 'server_error');\n    var cb = function () {\n      if (!bool++) {\n        window.setTimeout(function () {\n          callback(result);\n          head.removeChild(script);\n        }, 0);\n      }\n    };\n\n    // Add callback to the window object\n    callbackID = _this.globalEvent(function (json) {\n      result = json;\n      return true;\n\n      // Mark callback as done\n    }, callbackID);\n\n    // The URL is a function for some cases and as such\n    // Determine its value with a callback containing the new parameters of this function.\n    url = url.replace(new RegExp('=\\\\?(&|$)'), '=' + callbackID + '$1');\n\n    // Build script tag\n    var script = _this.append('script', {\n      id: callbackID,\n      name: callbackID,\n      src: url,\n      async: true,\n      onload: cb,\n      onerror: cb,\n      onreadystatechange: function () {\n        if (/loaded|complete/i.test(this.readyState)) {\n          cb();\n        }\n      }\n    });\n\n    // Opera fix error\n    // Problem: If an error occurs with script loading Opera fails to trigger the script.onerror handler we specified\n    //\n    // Fix:\n    // By setting the request to synchronous we can trigger the error handler when all else fails.\n    // This action will be ignored if we've already called the callback handler \"cb\" with a successful onload event\n    if (window.navigator.userAgent.toLowerCase().indexOf('opera') > -1) {\n      operaFix = _this.append('script', {\n        text: 'document.getElementById(\\'' + callbackID + '\\').onerror();'\n      });\n      script.async = false;\n    }\n\n    // Add timeout\n    if (timeout) {\n      window.setTimeout(function () {\n        result = error('timeout', 'timeout');\n        cb();\n      }, timeout);\n    }\n\n    // TODO: add fix for IE,\n    // However: unable recreate the bug of firing off the onreadystatechange before the script content has been executed and the value of \"result\" has been defined.\n    // Inject script tag into the head element\n    head.appendChild(script);\n\n    // Append Opera Fix to run after our script\n    if (operaFix) {\n      head.appendChild(operaFix);\n    }\n  },\n  // Post\n  // Send information to a remote location using the post mechanism\n  // @param string uri path\n  // @param object data, key value data to send\n  // @param function callback, function to execute in response\n  post: function (url, data, options, callback, callbackID, timeout) {\n    var _this = this;\n    var error = _this.error;\n    var doc = document;\n\n    // This hack needs a form\n    var form = null;\n    var reenableAfterSubmit = [];\n    var newform;\n    var i = 0;\n    var x = null;\n    var bool = 0;\n    var cb = function (r) {\n      if (!bool++) {\n        callback(r);\n      }\n    };\n\n    // What is the name of the callback to contain\n    // We'll also use this to name the iframe\n    _this.globalEvent(cb, callbackID);\n\n    // Build the iframe window\n    var win;\n    try {\n      // IE7 hack, only lets us define the name here, not later.\n      win = doc.createElement('<iframe name=\"' + callbackID + '\">');\n    } catch (e) {\n      win = doc.createElement('iframe');\n    }\n    win.name = callbackID;\n    win.id = callbackID;\n    win.style.display = 'none';\n\n    // Override callback mechanism. Triggger a response onload/onerror\n    if (options && options.callbackonload) {\n      // Onload is being fired twice\n      win.onload = function () {\n        cb({\n          response: 'posted',\n          message: 'Content was posted'\n        });\n      };\n    }\n    if (timeout) {\n      setTimeout(function () {\n        cb(error('timeout', 'The post operation timed out'));\n      }, timeout);\n    }\n    doc.body.appendChild(win);\n\n    // If we are just posting a single item\n    if (_this.domInstance('form', data)) {\n      // Get the parent form\n      form = data.form;\n\n      // Loop through and disable all of its siblings\n      for (i = 0; i < form.elements.length; i++) {\n        if (form.elements[i] !== data) {\n          form.elements[i].setAttribute('disabled', true);\n        }\n      }\n\n      // Move the focus to the form\n      data = form;\n    }\n\n    // Posting a form\n    if (_this.domInstance('form', data)) {\n      // This is a form element\n      form = data;\n\n      // Does this form need to be a multipart form?\n      for (i = 0; i < form.elements.length; i++) {\n        if (!form.elements[i].disabled && form.elements[i].type === 'file') {\n          form.encoding = form.enctype = 'multipart/form-data';\n          form.elements[i].setAttribute('name', 'file');\n        }\n      }\n    } else {\n      // Its not a form element,\n      // Therefore it must be a JSON object of Key=>Value or Key=>Element\n      // If anyone of those values are a input type=file we shall shall insert its siblings into the form for which it belongs.\n      for (x in data) if (data.hasOwnProperty(x)) {\n        // Is this an input Element?\n        if (_this.domInstance('input', data[x]) && data[x].type === 'file') {\n          form = data[x].form;\n          form.encoding = form.enctype = 'multipart/form-data';\n        }\n      }\n\n      // Do If there is no defined form element, lets create one.\n      if (!form) {\n        // Build form\n        form = doc.createElement('form');\n        doc.body.appendChild(form);\n        newform = form;\n      }\n      var input;\n\n      // Add elements to the form if they dont exist\n      for (x in data) if (data.hasOwnProperty(x)) {\n        // Is this an element?\n        var el = _this.domInstance('input', data[x]) || _this.domInstance('textArea', data[x]) || _this.domInstance('select', data[x]);\n\n        // Is this not an input element, or one that exists outside the form.\n        if (!el || data[x].form !== form) {\n          // Does an element have the same name?\n          var inputs = form.elements[x];\n          if (input) {\n            // Remove it.\n            if (!(inputs instanceof NodeList)) {\n              inputs = [inputs];\n            }\n            for (i = 0; i < inputs.length; i++) {\n              inputs[i].parentNode.removeChild(inputs[i]);\n            }\n          }\n\n          // Create an input element\n          input = doc.createElement('input');\n          input.setAttribute('type', 'hidden');\n          input.setAttribute('name', x);\n\n          // Does it have a value attribute?\n          if (el) {\n            input.value = data[x].value;\n          } else if (_this.domInstance(null, data[x])) {\n            input.value = data[x].innerHTML || data[x].innerText;\n          } else {\n            input.value = data[x];\n          }\n          form.appendChild(input);\n        }\n\n        // It is an element, which exists within the form, but the name is wrong\n        else if (el && data[x].name !== x) {\n          data[x].setAttribute('name', x);\n          data[x].name = x;\n        }\n      }\n\n      // Disable elements from within the form if they weren't specified\n      for (i = 0; i < form.elements.length; i++) {\n        input = form.elements[i];\n\n        // Does the same name and value exist in the parent\n        if (!(input.name in data) && input.getAttribute('disabled') !== true) {\n          // Disable\n          input.setAttribute('disabled', true);\n\n          // Add re-enable to callback\n          reenableAfterSubmit.push(input);\n        }\n      }\n    }\n\n    // Set the target of the form\n    form.setAttribute('method', 'POST');\n    form.setAttribute('target', callbackID);\n    form.target = callbackID;\n\n    // Update the form URL\n    form.setAttribute('action', url);\n\n    // Submit the form\n    // Some reason this needs to be offset from the current window execution\n    setTimeout(function () {\n      form.submit();\n      setTimeout(function () {\n        try {\n          // Remove the iframe from the page.\n          //win.parentNode.removeChild(win);\n          // Remove the form\n          if (newform) {\n            newform.parentNode.removeChild(newform);\n          }\n        } catch (e) {\n          try {\n            console.error('HelloJS: could not remove iframe');\n          } catch (ee) {}\n        }\n\n        // Reenable the disabled form\n        for (var i = 0; i < reenableAfterSubmit.length; i++) {\n          if (reenableAfterSubmit[i]) {\n            reenableAfterSubmit[i].setAttribute('disabled', false);\n            reenableAfterSubmit[i].disabled = false;\n          }\n        }\n      }, 0);\n    }, 100);\n  },\n  // Some of the providers require that only multipart is used with non-binary forms.\n  // This function checks whether the form contains binary data\n  hasBinary: function (data) {\n    for (var x in data) if (data.hasOwnProperty(x)) {\n      if (this.isBinary(data[x])) {\n        return true;\n      }\n    }\n    return false;\n  },\n  // Determines if a variable Either Is or like a FormInput has the value of a Blob\n\n  isBinary: function (data) {\n    return data instanceof Object && (this.domInstance('input', data) && data.type === 'file' || 'FileList' in window && data instanceof window.FileList || 'File' in window && data instanceof window.File || 'Blob' in window && data instanceof window.Blob);\n  },\n  // Convert Data-URI to Blob string\n  toBlob: function (dataURI) {\n    var reg = /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i;\n    var m = dataURI.match(reg);\n    if (!m) {\n      return dataURI;\n    }\n    var binary = atob(dataURI.replace(reg, ''));\n    var array = [];\n    for (var i = 0; i < binary.length; i++) {\n      array.push(binary.charCodeAt(i));\n    }\n    return new Blob([new Uint8Array(array)], {\n      type: m[1]\n    });\n  }\n});\n\n// EXTRA: Convert FormElement to JSON for POSTing\n// Wrappers to add additional functionality to existing functions\n(function (hello) {\n  // Copy original function\n  var api = hello.api;\n  var utils = hello.utils;\n  utils.extend(utils, {\n    // DataToJSON\n    // This takes a FormElement|NodeList|InputElement|MixedObjects and convers the data object to JSON.\n    dataToJSON: function (p) {\n      var _this = this;\n      var w = window;\n      var data = p.data;\n\n      // Is data a form object\n      if (_this.domInstance('form', data)) {\n        data = _this.nodeListToJSON(data.elements);\n      } else if ('NodeList' in w && data instanceof NodeList) {\n        data = _this.nodeListToJSON(data);\n      } else if (_this.domInstance('input', data)) {\n        data = _this.nodeListToJSON([data]);\n      }\n\n      // Is data a blob, File, FileList?\n      if ('File' in w && data instanceof w.File || 'Blob' in w && data instanceof w.Blob || 'FileList' in w && data instanceof w.FileList) {\n        data = {\n          file: data\n        };\n      }\n\n      // Loop through data if it's not form data it must now be a JSON object\n      if (!('FormData' in w && data instanceof w.FormData)) {\n        for (var x in data) if (data.hasOwnProperty(x)) {\n          if ('FileList' in w && data[x] instanceof w.FileList) {\n            if (data[x].length === 1) {\n              data[x] = data[x][0];\n            }\n          } else if (_this.domInstance('input', data[x]) && data[x].type === 'file') {\n            continue;\n          } else if (_this.domInstance('input', data[x]) || _this.domInstance('select', data[x]) || _this.domInstance('textArea', data[x])) {\n            data[x] = data[x].value;\n          } else if (_this.domInstance(null, data[x])) {\n            data[x] = data[x].innerHTML || data[x].innerText;\n          }\n        }\n      }\n      p.data = data;\n      return data;\n    },\n    // NodeListToJSON\n    // Given a list of elements extrapolate their values and return as a json object\n    nodeListToJSON: function (nodelist) {\n      var json = {};\n\n      // Create a data string\n      for (var i = 0; i < nodelist.length; i++) {\n        var input = nodelist[i];\n\n        // If the name of the input is empty or diabled, dont add it.\n        if (input.disabled || !input.name) {\n          continue;\n        }\n\n        // Is this a file, does the browser not support 'files' and 'FormData'?\n        if (input.type === 'file') {\n          json[input.name] = input;\n        } else {\n          json[input.name] = input.value || input.innerHTML;\n        }\n      }\n      return json;\n    }\n  });\n\n  // Replace it\n  hello.api = function () {\n    // Get arguments\n    var p = utils.args({\n      path: 's!',\n      method: 's',\n      data: 'o',\n      timeout: 'i',\n      callback: 'f'\n    }, arguments);\n\n    // Change for into a data object\n    if (p.data) {\n      utils.dataToJSON(p);\n    }\n    return api.call(this, p);\n  };\n})(hello);\n\n/////////////////////////////////////\n//\n// Save any access token that is in the current page URL\n// Handle any response solicited through iframe hash tag following an API request\n//\n/////////////////////////////////////\n\nhello.utils.responseHandler(window, window.opener || window.parent);\n\n// Script to support ChromeApps\n// This overides the hello.utils.popup method to support chrome.identity.launchWebAuthFlow\n// See https://developer.chrome.com/apps/app_identity#non\n\n// Is this a chrome app?\n\nif (typeof chrome === 'object' && typeof chrome.identity === 'object' && chrome.identity.launchWebAuthFlow) {\n  (function () {\n    // Swap the popup method\n    hello.utils.popup = function (url) {\n      return _open(url, true);\n    };\n\n    // Swap the hidden iframe method\n    hello.utils.iframe = function (url) {\n      _open(url, false);\n    };\n\n    // Swap the request_cors method\n    hello.utils.request_cors = function (callback) {\n      callback();\n\n      // Always run as CORS\n\n      return true;\n    };\n\n    // Swap the storage method\n    var _cache = {};\n    chrome.storage.local.get('hello', function (r) {\n      // Update the cache\n      _cache = r.hello || {};\n    });\n    hello.utils.store = function (name, value) {\n      // Get all\n      if (arguments.length === 0) {\n        return _cache;\n      }\n\n      // Get\n      if (arguments.length === 1) {\n        return _cache[name] || null;\n      }\n\n      // Set\n      if (value) {\n        _cache[name] = value;\n        chrome.storage.local.set({\n          hello: _cache\n        });\n        return value;\n      }\n\n      // Delete\n      if (value === null) {\n        delete _cache[name];\n        chrome.storage.local.set({\n          hello: _cache\n        });\n        return null;\n      }\n    };\n\n    // Open function\n    function _open(url, interactive) {\n      // Launch\n      var ref = {\n        closed: false\n      };\n\n      // Launch the webAuthFlow\n      chrome.identity.launchWebAuthFlow({\n        url: url,\n        interactive: interactive\n      }, function (responseUrl) {\n        // Did the user cancel this prematurely\n        if (responseUrl === undefined) {\n          ref.closed = true;\n          return;\n        }\n\n        // Split appart the URL\n        var a = hello.utils.url(responseUrl);\n\n        // The location can be augmented in to a location object like so...\n        // We dont have window operations on the popup so lets create some\n        var _popup = {\n          location: {\n            // Change the location of the popup\n            assign: function (url) {\n              // If there is a secondary reassign\n              // In the case of OAuth1\n              // Trigger this in non-interactive mode.\n              _open(url, false);\n            },\n            search: a.search,\n            hash: a.hash,\n            href: a.href\n          },\n          close: function () {}\n        };\n\n        // Then this URL contains information which HelloJS must process\n        // URL string\n        // Window - any action such as window relocation goes here\n        // Opener - the parent window which opened this, aka this script\n\n        hello.utils.responseHandler(_popup, window);\n      });\n\n      // Return the reference\n      return ref;\n    }\n  })();\n}\n\n// Phonegap override for hello.phonegap.js\n(function () {\n  // Is this a phonegap implementation?\n  if (!(/^file:\\/{3}[^\\/]/.test(window.location.href) && window.cordova)) {\n    // Cordova is not included.\n    return;\n  }\n\n  // Augment the hidden iframe method\n  hello.utils.iframe = function (url, redirectUri) {\n    hello.utils.popup(url, redirectUri, {\n      hidden: 'yes'\n    });\n  };\n\n  // Augment the popup\n  var utilPopup = hello.utils.popup;\n\n  // Replace popup\n  hello.utils.popup = function (url, redirectUri, options) {\n    // Run the standard\n    var popup = utilPopup.call(this, url, redirectUri, options);\n\n    // Create a function for reopening the popup, and assigning events to the new popup object\n    // PhoneGap support\n    // Add an event listener to listen to the change in the popup windows URL\n    // This must appear before popup.focus();\n    try {\n      if (popup && popup.addEventListener) {\n        // Get the origin of the redirect URI\n\n        var a = hello.utils.url(redirectUri);\n        var redirectUriOrigin = a.origin || a.protocol + '//' + a.hostname;\n\n        // Listen to changes in the InAppBrowser window\n\n        popup.addEventListener('loadstart', function (e) {\n          var url = e.url;\n\n          // Is this the path, as given by the redirectUri?\n          // Check the new URL agains the redirectUriOrigin.\n          // According to #63 a user could click 'cancel' in some dialog boxes ....\n          // The popup redirects to another page with the same origin, yet we still wish it to close.\n\n          if (url.indexOf(redirectUriOrigin) !== 0) {\n            return;\n          }\n\n          // Split appart the URL\n          var a = hello.utils.url(url);\n\n          // We dont have window operations on the popup so lets create some\n          // The location can be augmented in to a location object like so...\n\n          var _popup = {\n            location: {\n              // Change the location of the popup\n              assign: function (location) {\n                // Unfourtunatly an app is may not change the location of a InAppBrowser window.\n                // So to shim this, just open a new one.\n                popup.executeScript({\n                  code: 'window.location.href = \"' + location + ';\"'\n                });\n              },\n              search: a.search,\n              hash: a.hash,\n              href: a.href\n            },\n            close: function () {\n              if (popup.close) {\n                popup.close();\n                try {\n                  popup.closed = true;\n                } catch (_e) {}\n              }\n            }\n          };\n\n          // Then this URL contains information which HelloJS must process\n          // URL string\n          // Window - any action such as window relocation goes here\n          // Opener - the parent window which opened this, aka this script\n\n          hello.utils.responseHandler(_popup, window);\n        });\n      }\n    } catch (e) {}\n    return popup;\n  };\n})();\n(function (hello) {\n  // OAuth1\n  var OAuth1Settings = {\n    version: '1.0',\n    auth: 'https://www.dropbox.com/1/oauth/authorize',\n    request: 'https://api.dropbox.com/1/oauth/request_token',\n    token: 'https://api.dropbox.com/1/oauth/access_token'\n  };\n\n  // OAuth2 Settings\n  var OAuth2Settings = {\n    version: 2,\n    auth: 'https://www.dropbox.com/1/oauth2/authorize',\n    grant: 'https://api.dropbox.com/1/oauth2/token'\n  };\n\n  // Initiate the Dropbox module\n  hello.init({\n    dropbox: {\n      name: 'Dropbox',\n      oauth: OAuth2Settings,\n      login: function (p) {\n        // OAuth2 non-standard adjustments\n        p.qs.scope = '';\n\n        // Should this be run as OAuth1?\n        // If the redirect_uri is is HTTP (non-secure) then its required to revert to the OAuth1 endpoints\n        var redirect = decodeURIComponent(p.qs.redirect_uri);\n        if (redirect.indexOf('http:') === 0 && redirect.indexOf('http://localhost/') !== 0) {\n          // Override the dropbox OAuth settings.\n          hello.services.dropbox.oauth = OAuth1Settings;\n        } else {\n          // Override the dropbox OAuth settings.\n          hello.services.dropbox.oauth = OAuth2Settings;\n        }\n\n        // The dropbox login window is a different size\n        p.options.popup.width = 1000;\n        p.options.popup.height = 1000;\n      },\n      /*\n      \tDropbox does not allow insecure HTTP URI's in the redirect_uri field\n      \t...otherwise I'd love to use OAuth2\n      \t\tFollow request https://forums.dropbox.com/topic.php?id=106505\n      \t\tp.qs.response_type = 'code';\n      \toauth: {\n      \t\tversion: 2,\n      \t\tauth: 'https://www.dropbox.com/1/oauth2/authorize',\n      \t\tgrant: 'https://api.dropbox.com/1/oauth2/token'\n      \t}\n      */\n\n      // API Base URL\n      base: 'https://api.dropbox.com/1/',\n      // Bespoke setting: this is states whether to use the custom environment of Dropbox or to use their own environment\n      // Because it's notoriously difficult for Dropbox too provide access from other webservices, this defaults to Sandbox\n      root: 'sandbox',\n      // Map GET requests\n      get: {\n        me: 'account/info',\n        // Https://www.dropbox.com/developers/core/docs#metadata\n        'me/files': req('metadata/auto/@{parent|}'),\n        'me/folder': req('metadata/auto/@{id}'),\n        'me/folders': req('metadata/auto/'),\n        'default': function (p, callback) {\n          if (p.path.match('https://api-content.dropbox.com/1/files/')) {\n            // This is a file, return binary data\n            p.method = 'blob';\n          }\n          callback(p.path);\n        }\n      },\n      post: {\n        'me/files': function (p, callback) {\n          var path = p.data.parent;\n          var fileName = p.data.name;\n          p.data = {\n            file: p.data.file\n          };\n\n          // Does this have a data-uri to upload as a file?\n          if (typeof p.data.file === 'string') {\n            p.data.file = hello.utils.toBlob(p.data.file);\n          }\n          callback('https://api-content.dropbox.com/1/files_put/auto/' + path + '/' + fileName);\n        },\n        'me/folders': function (p, callback) {\n          var name = p.data.name;\n          p.data = {};\n          callback('fileops/create_folder?root=@{root|sandbox}&' + hello.utils.param({\n            path: name\n          }));\n        }\n      },\n      // Map DELETE requests\n      del: {\n        'me/files': 'fileops/delete?root=@{root|sandbox}&path=@{id}',\n        'me/folder': 'fileops/delete?root=@{root|sandbox}&path=@{id}'\n      },\n      wrap: {\n        me: function (o) {\n          formatError(o);\n          if (!o.uid) {\n            return o;\n          }\n          o.name = o.display_name;\n          var m = o.name.split(' ');\n          o.first_name = m.shift();\n          o.last_name = m.join(' ');\n          o.id = o.uid;\n          delete o.uid;\n          delete o.display_name;\n          return o;\n        },\n        'default': function (o, headers, req) {\n          formatError(o);\n          if (o.is_dir && o.contents) {\n            o.data = o.contents;\n            delete o.contents;\n            o.data.forEach(function (item) {\n              item.root = o.root;\n              formatFile(item, headers, req);\n            });\n          }\n          formatFile(o, headers, req);\n          if (o.is_deleted) {\n            o.success = true;\n          }\n          return o;\n        }\n      },\n      // Doesn't return the CORS headers\n      xhr: function (p) {\n        // The proxy supports allow-cross-origin-resource\n        // Alas that's the only thing we're using.\n        if (p.data && p.data.file) {\n          var file = p.data.file;\n          if (file) {\n            if (file.files) {\n              p.data = file.files[0];\n            } else {\n              p.data = file;\n            }\n          }\n        }\n        if (p.method === 'delete') {\n          p.method = 'post';\n        }\n        return true;\n      },\n      form: function (p, qs) {\n        delete qs.state;\n        delete qs.redirect_uri;\n      }\n    }\n  });\n  function formatError(o) {\n    if (o && 'error' in o) {\n      o.error = {\n        code: 'server_error',\n        message: o.error.message || o.error\n      };\n    }\n  }\n  function formatFile(o, headers, req) {\n    if (typeof o !== 'object' || typeof Blob !== 'undefined' && o instanceof Blob || typeof ArrayBuffer !== 'undefined' && o instanceof ArrayBuffer) {\n      // This is a file, let it through unformatted\n      return;\n    }\n    if ('error' in o) {\n      return;\n    }\n    var path = (o.root !== 'app_folder' ? o.root : '') + o.path.replace(/\\&/g, '%26');\n    path = path.replace(/^\\//, '');\n    if (o.thumb_exists) {\n      o.thumbnail = req.oauth_proxy + '?path=' + encodeURIComponent('https://api-content.dropbox.com/1/thumbnails/auto/' + path + '?format=jpeg&size=m') + '&access_token=' + req.options.access_token;\n    }\n    o.type = o.is_dir ? 'folder' : o.mime_type;\n    o.name = o.path.replace(/.*\\//g, '');\n    if (o.is_dir) {\n      o.files = path.replace(/^\\//, '');\n    } else {\n      o.downloadLink = hello.settings.oauth_proxy + '?path=' + encodeURIComponent('https://api-content.dropbox.com/1/files/auto/' + path) + '&access_token=' + req.options.access_token;\n      o.file = 'https://api-content.dropbox.com/1/files/auto/' + path;\n    }\n    if (!o.id) {\n      o.id = o.path.replace(/^\\//, '');\n    }\n\n    // O.media = 'https://api-content.dropbox.com/1/files/' + path;\n  }\n\n  function req(str) {\n    return function (p, cb) {\n      delete p.query.limit;\n      cb(str);\n    };\n  }\n})(hello);\n(function (hello) {\n  // For APIs, once a version is no longer usable, any calls made to it will be defaulted to the next oldest usable version.\n  // So we explicitly state it.\n  var version = 'v2.9';\n  hello.init({\n    facebook: {\n      name: 'Facebook',\n      // SEE https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow\n      oauth: {\n        version: 2,\n        auth: 'https://www.facebook.com/' + version + '/dialog/oauth/',\n        grant: 'https://graph.facebook.com/oauth/access_token'\n      },\n      // Authorization scopes\n      scope: {\n        basic: 'public_profile',\n        email: 'email',\n        share: 'user_posts',\n        birthday: 'user_birthday',\n        events: 'user_events',\n        photos: 'user_photos',\n        videos: 'user_videos',\n        friends: 'user_friends',\n        files: 'user_photos,user_videos',\n        publish_files: 'user_photos,user_videos,publish_actions',\n        publish: 'publish_actions',\n        // Deprecated in v2.0\n        // Create_event\t: 'create_event',\n\n        offline_access: ''\n      },\n      // Refresh the access_token\n      refresh: false,\n      login: function (p) {\n        // Reauthenticate\n        // https://developers.facebook.com/docs/facebook-login/reauthentication\n        if (p.options.force) {\n          p.qs.auth_type = 'reauthenticate';\n        }\n\n        // Set the display value\n        p.qs.display = p.options.display || 'popup';\n      },\n      logout: function (callback, options) {\n        // Assign callback to a global handler\n        var callbackID = hello.utils.globalEvent(callback);\n        var redirect = encodeURIComponent(hello.settings.redirect_uri + '?' + hello.utils.param({\n          callback: callbackID,\n          result: JSON.stringify({\n            force: true\n          }),\n          state: '{}'\n        }));\n        var token = (options.authResponse || {}).access_token;\n        hello.utils.iframe('https://www.facebook.com/logout.php?next=' + redirect + '&access_token=' + token);\n\n        // Possible responses:\n        // String URL\t- hello.logout should handle the logout\n        // Undefined\t- this function will handle the callback\n        // True - throw a success, this callback isn't handling the callback\n        // False - throw a error\n        if (!token) {\n          // If there isn't a token, the above wont return a response, so lets trigger a response\n          return false;\n        }\n      },\n      // API Base URL\n      base: 'https://graph.facebook.com/' + version + '/',\n      // Map GET requests\n      get: {\n        me: 'me?fields=email,first_name,last_name,name,timezone,verified',\n        'me/friends': 'me/friends',\n        'me/following': 'me/friends',\n        'me/followers': 'me/friends',\n        'me/share': 'me/feed',\n        'me/like': 'me/likes',\n        'me/files': 'me/albums',\n        'me/albums': 'me/albums?fields=cover_photo,name',\n        'me/album': '@{id}/photos?fields=picture',\n        'me/photos': 'me/photos',\n        'me/photo': '@{id}',\n        'friend/albums': '@{id}/albums',\n        'friend/photos': '@{id}/photos'\n\n        // Pagination\n        // Https://developers.facebook.com/docs/reference/api/pagination/\n      },\n\n      // Map POST requests\n      post: {\n        'me/share': 'me/feed',\n        'me/photo': '@{id}'\n\n        // Https://developers.facebook.com/docs/graph-api/reference/v2.2/object/likes/\n      },\n\n      wrap: {\n        me: formatUser,\n        'me/friends': formatFriends,\n        'me/following': formatFriends,\n        'me/followers': formatFriends,\n        'me/albums': format,\n        'me/photos': format,\n        'me/files': format,\n        'default': format\n      },\n      // Special requirements for handling XHR\n      xhr: function (p, qs) {\n        if (p.method === 'get' || p.method === 'post') {\n          qs.suppress_response_codes = true;\n        }\n\n        // Is this a post with a data-uri?\n        if (p.method === 'post' && p.data && typeof p.data.file === 'string') {\n          // Convert the Data-URI to a Blob\n          p.data.file = hello.utils.toBlob(p.data.file);\n        }\n        return true;\n      },\n      // Special requirements for handling JSONP fallback\n      jsonp: function (p, qs) {\n        var m = p.method;\n        if (m !== 'get' && !hello.utils.hasBinary(p.data)) {\n          p.data.method = m;\n          p.method = 'get';\n        } else if (p.method === 'delete') {\n          qs.method = 'delete';\n          p.method = 'post';\n        }\n      },\n      // Special requirements for iframe form hack\n      form: function (p) {\n        return {\n          // Fire the callback onload\n          callbackonload: true\n        };\n      }\n    }\n  });\n  var base = 'https://graph.facebook.com/';\n  function formatUser(o) {\n    if (o.id) {\n      o.thumbnail = o.picture = 'https://graph.facebook.com/' + o.id + '/picture';\n    }\n    return o;\n  }\n  function formatFriends(o) {\n    if ('data' in o) {\n      o.data.forEach(formatUser);\n    }\n    return o;\n  }\n  function format(o, headers, req) {\n    if (typeof o === 'boolean') {\n      o = {\n        success: o\n      };\n    }\n    if (o && 'data' in o) {\n      var token = req.query.access_token;\n      if (!(o.data instanceof Array)) {\n        var data = o.data;\n        delete o.data;\n        o.data = [data];\n      }\n      o.data.forEach(function (d) {\n        if (d.picture) {\n          d.thumbnail = d.picture;\n        }\n        d.pictures = (d.images || []).sort(function (a, b) {\n          return a.width - b.width;\n        });\n        if (d.cover_photo && d.cover_photo.id) {\n          d.thumbnail = base + d.cover_photo.id + '/picture?access_token=' + token;\n        }\n        if (d.type === 'album') {\n          d.files = d.photos = base + d.id + '/photos';\n        }\n        if (d.can_upload) {\n          d.upload_location = base + d.id + '/photos';\n        }\n      });\n    }\n    return o;\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    flickr: {\n      name: 'Flickr',\n      // Ensure that you define an oauth_proxy\n      oauth: {\n        version: '1.0a',\n        auth: 'https://www.flickr.com/services/oauth/authorize?perms=read',\n        request: 'https://www.flickr.com/services/oauth/request_token',\n        token: 'https://www.flickr.com/services/oauth/access_token'\n      },\n      // API base URL\n      base: 'https://api.flickr.com/services/rest',\n      // Map GET resquests\n      get: {\n        me: sign('flickr.people.getInfo'),\n        'me/friends': sign('flickr.contacts.getList', {\n          per_page: '@{limit|50}'\n        }),\n        'me/following': sign('flickr.contacts.getList', {\n          per_page: '@{limit|50}'\n        }),\n        'me/followers': sign('flickr.contacts.getList', {\n          per_page: '@{limit|50}'\n        }),\n        'me/albums': sign('flickr.photosets.getList', {\n          per_page: '@{limit|50}'\n        }),\n        'me/album': sign('flickr.photosets.getPhotos', {\n          photoset_id: '@{id}'\n        }),\n        'me/photos': sign('flickr.people.getPhotos', {\n          per_page: '@{limit|50}'\n        })\n      },\n      wrap: {\n        me: function (o) {\n          formatError(o);\n          o = checkResponse(o, 'person');\n          if (o.id) {\n            if (o.realname) {\n              o.name = o.realname._content;\n              var m = o.name.split(' ');\n              o.first_name = m.shift();\n              o.last_name = m.join(' ');\n            }\n            o.thumbnail = getBuddyIcon(o, 'l');\n            o.picture = getBuddyIcon(o, 'l');\n          }\n          return o;\n        },\n        'me/friends': formatFriends,\n        'me/followers': formatFriends,\n        'me/following': formatFriends,\n        'me/albums': function (o) {\n          formatError(o);\n          o = checkResponse(o, 'photosets');\n          paging(o);\n          if (o.photoset) {\n            o.data = o.photoset;\n            o.data.forEach(function (item) {\n              item.name = item.title._content;\n              item.photos = 'https://api.flickr.com/services/rest' + getApiUrl('flickr.photosets.getPhotos', {\n                photoset_id: item.id\n              }, true);\n            });\n            delete o.photoset;\n          }\n          return o;\n        },\n        'me/photos': function (o) {\n          formatError(o);\n          return formatPhotos(o);\n        },\n        'default': function (o) {\n          formatError(o);\n          return formatPhotos(o);\n        }\n      },\n      xhr: false,\n      jsonp: function (p, qs) {\n        if (p.method == 'get') {\n          delete qs.callback;\n          qs.jsoncallback = p.callbackID;\n        }\n      }\n    }\n  });\n  function getApiUrl(method, extraParams, skipNetwork) {\n    var url = (skipNetwork ? '' : 'flickr:') + '?method=' + method + '&api_key=' + hello.services.flickr.id + '&format=json';\n    for (var param in extraParams) {\n      if (extraParams.hasOwnProperty(param)) {\n        url += '&' + param + '=' + extraParams[param];\n      }\n    }\n    return url;\n  }\n\n  // This is not exactly neat but avoid to call\n  // The method 'flickr.test.login' for each api call\n\n  function withUser(cb) {\n    var auth = hello.getAuthResponse('flickr');\n    cb(auth && auth.user_nsid ? auth.user_nsid : null);\n  }\n  function sign(url, params) {\n    if (!params) {\n      params = {};\n    }\n    return function (p, callback) {\n      withUser(function (userId) {\n        params.user_id = userId;\n        callback(getApiUrl(url, params, true));\n      });\n    };\n  }\n  function getBuddyIcon(profile, size) {\n    var url = 'https://www.flickr.com/images/buddyicon.gif';\n    if (profile.nsid && profile.iconserver && profile.iconfarm) {\n      url = 'https://farm' + profile.iconfarm + '.staticflickr.com/' + profile.iconserver + '/' + 'buddyicons/' + profile.nsid + (size ? '_' + size : '') + '.jpg';\n    }\n    return url;\n  }\n\n  // See: https://www.flickr.com/services/api/misc.urls.html\n  function createPhotoUrl(id, farm, server, secret, size) {\n    size = size ? '_' + size : '';\n    return 'https://farm' + farm + '.staticflickr.com/' + server + '/' + id + '_' + secret + size + '.jpg';\n  }\n  function formatUser(o) {}\n  function formatError(o) {\n    if (o && o.stat && o.stat.toLowerCase() != 'ok') {\n      o.error = {\n        code: 'invalid_request',\n        message: o.message\n      };\n    }\n  }\n  function formatPhotos(o) {\n    if (o.photoset || o.photos) {\n      var set = 'photoset' in o ? 'photoset' : 'photos';\n      o = checkResponse(o, set);\n      paging(o);\n      o.data = o.photo;\n      delete o.photo;\n      for (var i = 0; i < o.data.length; i++) {\n        var photo = o.data[i];\n        photo.name = photo.title;\n        photo.picture = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, '');\n        photo.pictures = createPictures(photo.id, photo.farm, photo.server, photo.secret);\n        photo.source = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, 'b');\n        photo.thumbnail = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, 'm');\n      }\n    }\n    return o;\n  }\n\n  // See: https://www.flickr.com/services/api/misc.urls.html\n  function createPictures(id, farm, server, secret) {\n    var NO_LIMIT = 2048;\n    var sizes = [{\n      id: 't',\n      max: 100\n    }, {\n      id: 'm',\n      max: 240\n    }, {\n      id: 'n',\n      max: 320\n    }, {\n      id: '',\n      max: 500\n    }, {\n      id: 'z',\n      max: 640\n    }, {\n      id: 'c',\n      max: 800\n    }, {\n      id: 'b',\n      max: 1024\n    }, {\n      id: 'h',\n      max: 1600\n    }, {\n      id: 'k',\n      max: 2048\n    }, {\n      id: 'o',\n      max: NO_LIMIT\n    }];\n    return sizes.map(function (size) {\n      return {\n        source: createPhotoUrl(id, farm, server, secret, size.id),\n        // Note: this is a guess that's almost certain to be wrong (unless square source)\n        width: size.max,\n        height: size.max\n      };\n    });\n  }\n  function checkResponse(o, key) {\n    if (key in o) {\n      o = o[key];\n    } else if (!('error' in o)) {\n      o.error = {\n        code: 'invalid_request',\n        message: o.message || 'Failed to get data from Flickr'\n      };\n    }\n    return o;\n  }\n  function formatFriends(o) {\n    formatError(o);\n    if (o.contacts) {\n      o = checkResponse(o, 'contacts');\n      paging(o);\n      o.data = o.contact;\n      delete o.contact;\n      for (var i = 0; i < o.data.length; i++) {\n        var item = o.data[i];\n        item.id = item.nsid;\n        item.name = item.realname || item.username;\n        item.thumbnail = getBuddyIcon(item, 'm');\n      }\n    }\n    return o;\n  }\n  function paging(res) {\n    if (res.page && res.pages && res.page !== res.pages) {\n      res.paging = {\n        next: '?page=' + ++res.page\n      };\n    }\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    foursquare: {\n      name: 'Foursquare',\n      oauth: {\n        // See: https://developer.foursquare.com/overview/auth\n        version: 2,\n        auth: 'https://foursquare.com/oauth2/authenticate',\n        grant: 'https://foursquare.com/oauth2/access_token'\n      },\n      // Refresh the access_token once expired\n      refresh: true,\n      base: 'https://api.foursquare.com/v2/',\n      get: {\n        me: 'users/self',\n        'me/friends': 'users/self/friends',\n        'me/followers': 'users/self/friends',\n        'me/following': 'users/self/friends'\n      },\n      wrap: {\n        me: function (o) {\n          formatError(o);\n          if (o && o.response) {\n            o = o.response.user;\n            formatUser(o);\n          }\n          return o;\n        },\n        'default': function (o) {\n          formatError(o);\n\n          // Format friends\n          if (o && 'response' in o && 'friends' in o.response && 'items' in o.response.friends) {\n            o.data = o.response.friends.items;\n            o.data.forEach(formatUser);\n            delete o.response;\n          }\n          return o;\n        }\n      },\n      xhr: formatRequest,\n      jsonp: formatRequest\n    }\n  });\n  function formatError(o) {\n    if (o.meta && (o.meta.code === 400 || o.meta.code === 401)) {\n      o.error = {\n        code: 'access_denied',\n        message: o.meta.errorDetail\n      };\n    }\n  }\n  function formatUser(o) {\n    if (o && o.id) {\n      o.thumbnail = o.photo.prefix + '100x100' + o.photo.suffix;\n      o.name = o.firstName + ' ' + o.lastName;\n      o.first_name = o.firstName;\n      o.last_name = o.lastName;\n      if (o.contact) {\n        if (o.contact.email) {\n          o.email = o.contact.email;\n        }\n      }\n    }\n  }\n  function formatRequest(p, qs) {\n    var token = qs.access_token;\n    delete qs.access_token;\n    qs.oauth_token = token;\n    qs.v = 20121125;\n    return true;\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    github: {\n      name: 'GitHub',\n      oauth: {\n        version: 2,\n        auth: 'https://github.com/login/oauth/authorize',\n        grant: 'https://github.com/login/oauth/access_token',\n        response_type: 'code'\n      },\n      scope: {\n        email: 'user:email'\n      },\n      base: 'https://api.github.com/',\n      get: {\n        me: 'user',\n        'me/friends': 'user/following?per_page=@{limit|100}',\n        'me/following': 'user/following?per_page=@{limit|100}',\n        'me/followers': 'user/followers?per_page=@{limit|100}',\n        'me/like': 'user/starred?per_page=@{limit|100}'\n      },\n      wrap: {\n        me: function (o, headers) {\n          formatError(o, headers);\n          formatUser(o);\n          return o;\n        },\n        'default': function (o, headers, req) {\n          formatError(o, headers);\n          if (Array.isArray(o)) {\n            o = {\n              data: o\n            };\n          }\n          if (o.data) {\n            paging(o, headers, req);\n            o.data.forEach(formatUser);\n          }\n          return o;\n        }\n      },\n      xhr: function (p) {\n        if (p.method !== 'get' && p.data) {\n          // Serialize payload as JSON\n          p.headers = p.headers || {};\n          p.headers['Content-Type'] = 'application/json';\n          if (typeof p.data === 'object') {\n            p.data = JSON.stringify(p.data);\n          }\n        }\n        return true;\n      }\n    }\n  });\n  function formatError(o, headers) {\n    var code = headers ? headers.statusCode : o && 'meta' in o && 'status' in o.meta && o.meta.status;\n    if (code === 401 || code === 403) {\n      o.error = {\n        code: 'access_denied',\n        message: o.message || (o.data ? o.data.message : 'Could not get response')\n      };\n      delete o.message;\n    }\n  }\n  function formatUser(o) {\n    if (o.id) {\n      o.thumbnail = o.picture = o.avatar_url;\n      o.name = o.login;\n    }\n  }\n  function paging(res, headers, req) {\n    if (res.data && res.data.length && headers && headers.Link) {\n      var next = headers.Link.match(/<(.*?)>;\\s*rel=\\\"next\\\"/);\n      if (next) {\n        res.paging = {\n          next: next[1]\n        };\n      }\n    }\n  }\n})(hello);\n(function (hello) {\n  var contactsUrl = 'https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json&max-results=@{limit|1000}&start-index=@{start|1}';\n  hello.init({\n    google: {\n      name: 'Google Sign-In',\n      // See: http://code.google.com/apis/accounts/docs/OAuth2UserAgent.html\n      oauth: {\n        version: 2,\n        auth: 'https://accounts.google.com/o/oauth2/v2/auth',\n        grant: 'https://www.googleapis.com/oauth2/v4/token'\n      },\n      // Authorization scopes\n      scope: {\n        basic: 'openid profile',\n        email: 'email',\n        birthday: '',\n        events: '',\n        photos: 'https://picasaweb.google.com/data/',\n        videos: 'http://gdata.youtube.com',\n        files: 'https://www.googleapis.com/auth/drive.readonly',\n        publish: '',\n        publish_files: 'https://www.googleapis.com/auth/drive',\n        share: '',\n        create_event: '',\n        offline_access: ''\n      },\n      scope_delim: ' ',\n      login: function (p) {\n        if (p.qs.response_type === 'code') {\n          // Let's set this to an offline access to return a refresh_token\n          p.qs.access_type = 'offline';\n        } else if (p.qs.response_type.indexOf('id_token') > -1) {\n          p.qs.nonce = parseInt(Math.random() * 1e12, 10).toString(36);\n        }\n\n        // Reauthenticate\n        // https://developers.google.com/identity/protocols/\n        if (p.options.force) {\n          p.qs.approval_prompt = 'force';\n        }\n      },\n      // API base URI\n      base: 'https://www.googleapis.com/',\n      // Map GET requests\n      get: {\n        me: 'oauth2/v3/userinfo?alt=json',\n        // Deprecated Sept 1, 2014\n        //'me': 'oauth2/v1/userinfo?alt=json',\n\n        // See: https://developers.google.com/+/api/latest/people/list\n        'me/following': contactsUrl,\n        'me/followers': contactsUrl,\n        'me/contacts': contactsUrl,\n        'me/albums': 'https://picasaweb.google.com/data/feed/api/user/default?alt=json&max-results=@{limit|100}&start-index=@{start|1}',\n        'me/album': function (p, callback) {\n          var key = p.query.id;\n          delete p.query.id;\n          callback(key.replace('/entry/', '/feed/'));\n        },\n        'me/photos': 'https://picasaweb.google.com/data/feed/api/user/default?alt=json&kind=photo&max-results=@{limit|100}&start-index=@{start|1}',\n        // See: https://developers.google.com/drive/v2/reference/files/list\n        'me/file': 'drive/v2/files/@{id}',\n        'me/files': 'drive/v2/files?q=%22@{parent|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}',\n        // See: https://developers.google.com/drive/v2/reference/files/list\n        'me/folders': 'drive/v2/files?q=%22@{id|root}%22+in+parents+and+mimeType+=+%22application/vnd.google-apps.folder%22+and+trashed=false&maxResults=@{limit|100}',\n        // See: https://developers.google.com/drive/v2/reference/files/list\n        'me/folder': 'drive/v2/files?q=%22@{id|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}'\n      },\n      // Map POST requests\n      post: {\n        // Google Drive\n        'me/files': uploadDrive,\n        'me/folders': function (p, callback) {\n          p.data = {\n            title: p.data.name,\n            parents: [{\n              id: p.data.parent || 'root'\n            }],\n            mimeType: 'application/vnd.google-apps.folder'\n          };\n          callback('drive/v2/files');\n        }\n      },\n      // Map PUT requests\n      put: {\n        'me/files': uploadDrive\n      },\n      // Map DELETE requests\n      del: {\n        'me/files': 'drive/v2/files/@{id}',\n        'me/folder': 'drive/v2/files/@{id}'\n      },\n      // Map PATCH requests\n      patch: {\n        'me/file': 'drive/v2/files/@{id}'\n      },\n      wrap: {\n        me: function (o) {\n          if (o.sub) {\n            o.id = o.sub;\n          }\n          if (o.id) {\n            o.last_name = o.family_name || (o.name ? o.name.familyName : null);\n            o.first_name = o.given_name || (o.name ? o.name.givenName : null);\n            if (o.emails && o.emails.length) {\n              o.email = o.emails[0].value;\n            }\n            formatPerson(o);\n          }\n          return o;\n        },\n        'me/friends': function (o) {\n          if (o.items) {\n            paging(o);\n            o.data = o.items;\n            o.data.forEach(formatPerson);\n            delete o.items;\n          }\n          return o;\n        },\n        'me/contacts': formatFriends,\n        'me/followers': formatFriends,\n        'me/following': formatFriends,\n        'me/share': formatFeed,\n        'me/feed': formatFeed,\n        'me/albums': gEntry,\n        'me/photos': formatPhotos,\n        'default': gEntry\n      },\n      xhr: function (p) {\n        if (p.method === 'post' || p.method === 'put') {\n          toJSON(p);\n        } else if (p.method === 'patch') {\n          hello.utils.extend(p.query, p.data);\n          p.data = null;\n        }\n        return true;\n      },\n      // Don't even try submitting via form.\n      // This means no POST operations in <=IE9\n      form: false\n    }\n  });\n  function toInt(s) {\n    return parseInt(s, 10);\n  }\n  function formatFeed(o) {\n    paging(o);\n    o.data = o.items;\n    delete o.items;\n    return o;\n  }\n\n  // Format: ensure each record contains a name, id etc.\n  function formatItem(o) {\n    if (o.error) {\n      return;\n    }\n    if (!o.name) {\n      o.name = o.title || o.message;\n    }\n    if (!o.picture) {\n      o.picture = o.thumbnailLink;\n    }\n    if (!o.thumbnail) {\n      o.thumbnail = o.thumbnailLink;\n    }\n    if (o.mimeType === 'application/vnd.google-apps.folder') {\n      o.type = 'folder';\n      o.files = 'https://www.googleapis.com/drive/v2/files?q=%22' + o.id + '%22+in+parents';\n    }\n    return o;\n  }\n  function formatImage(image) {\n    return {\n      source: image.url,\n      width: image.width,\n      height: image.height\n    };\n  }\n  function formatPhotos(o) {\n    if ('feed' in o) {\n      o.data = 'entry' in o.feed ? o.feed.entry.map(formatEntry) : [];\n      delete o.feed;\n    }\n    return o;\n  }\n\n  // Google has a horrible JSON API\n  function gEntry(o) {\n    paging(o);\n    if ('feed' in o && 'entry' in o.feed) {\n      o.data = o.feed.entry.map(formatEntry);\n      delete o.feed;\n    }\n\n    // Old style: Picasa, etc.\n    else if ('entry' in o) {\n      return formatEntry(o.entry);\n    }\n\n    // New style: Google Drive\n    else if ('items' in o) {\n      o.data = o.items.map(formatItem);\n      delete o.items;\n    } else {\n      formatItem(o);\n    }\n    return o;\n  }\n  function formatPerson(o) {\n    o.name = o.displayName || o.name;\n    o.picture = o.picture || (o.image ? o.image.url : null);\n    o.thumbnail = o.picture;\n  }\n  function formatFriends(o, headers, req) {\n    paging(o);\n    var r = [];\n    if ('feed' in o && 'entry' in o.feed) {\n      var token = req.query.access_token;\n      for (var i = 0; i < o.feed.entry.length; i++) {\n        var a = o.feed.entry[i];\n        a.id = a.id.$t;\n        a.name = a.title.$t;\n        delete a.title;\n        if (a.gd$email) {\n          a.email = a.gd$email && a.gd$email.length > 0 ? a.gd$email[0].address : null;\n          a.emails = a.gd$email;\n          delete a.gd$email;\n        }\n        if (a.updated) {\n          a.updated = a.updated.$t;\n        }\n        if (a.link) {\n          var pic = a.link.length > 0 ? a.link[0].href : null;\n          if (pic && a.link[0].gd$etag) {\n            pic += (pic.indexOf('?') > -1 ? '&' : '?') + 'access_token=' + token;\n            a.picture = pic;\n            a.thumbnail = pic;\n          }\n          delete a.link;\n        }\n        if (a.category) {\n          delete a.category;\n        }\n      }\n      o.data = o.feed.entry;\n      delete o.feed;\n    }\n    return o;\n  }\n  function formatEntry(a) {\n    var group = a.media$group;\n    var photo = group.media$content.length ? group.media$content[0] : {};\n    var mediaContent = group.media$content || [];\n    var mediaThumbnail = group.media$thumbnail || [];\n    var pictures = mediaContent.concat(mediaThumbnail).map(formatImage).sort(function (a, b) {\n      return a.width - b.width;\n    });\n    var i = 0;\n    var _a;\n    var p = {\n      id: a.id.$t,\n      name: a.title.$t,\n      description: a.summary.$t,\n      updated_time: a.updated.$t,\n      created_time: a.published.$t,\n      picture: photo ? photo.url : null,\n      pictures: pictures,\n      images: [],\n      thumbnail: photo ? photo.url : null,\n      width: photo.width,\n      height: photo.height\n    };\n\n    // Get feed/children\n    if ('link' in a) {\n      for (i = 0; i < a.link.length; i++) {\n        var d = a.link[i];\n        if (d.rel.match(/\\#feed$/)) {\n          p.upload_location = p.files = p.photos = d.href;\n          break;\n        }\n      }\n    }\n\n    // Get images of different scales\n    if ('category' in a && a.category.length) {\n      _a = a.category;\n      for (i = 0; i < _a.length; i++) {\n        if (_a[i].scheme && _a[i].scheme.match(/\\#kind$/)) {\n          p.type = _a[i].term.replace(/^.*?\\#/, '');\n        }\n      }\n    }\n\n    // Get images of different scales\n    if ('media$thumbnail' in group && group.media$thumbnail.length) {\n      _a = group.media$thumbnail;\n      p.thumbnail = _a[0].url;\n      p.images = _a.map(formatImage);\n    }\n    _a = group.media$content;\n    if (_a && _a.length) {\n      p.images.push(formatImage(_a[0]));\n    }\n    return p;\n  }\n  function paging(res) {\n    // Contacts V2\n    if ('feed' in res && res.feed.openSearch$itemsPerPage) {\n      var limit = toInt(res.feed.openSearch$itemsPerPage.$t);\n      var start = toInt(res.feed.openSearch$startIndex.$t);\n      var total = toInt(res.feed.openSearch$totalResults.$t);\n      if (start + limit < total) {\n        res.paging = {\n          next: '?start=' + (start + limit)\n        };\n      }\n    } else if ('nextPageToken' in res) {\n      res.paging = {\n        next: '?pageToken=' + res.nextPageToken\n      };\n    }\n  }\n\n  // Construct a multipart message\n  function Multipart() {\n    // Internal body\n    var body = [];\n    var boundary = (Math.random() * 1e10).toString(32);\n    var counter = 0;\n    var lineBreak = '\\r\\n';\n    var delim = lineBreak + '--' + boundary;\n    var ready = function () {};\n    var dataUri = /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i;\n\n    // Add file\n    function addFile(item) {\n      var fr = new FileReader();\n      fr.onload = function (e) {\n        addContent(btoa(e.target.result), item.type + lineBreak + 'Content-Transfer-Encoding: base64');\n      };\n      fr.readAsBinaryString(item);\n    }\n\n    // Add content\n    function addContent(content, type) {\n      body.push(lineBreak + 'Content-Type: ' + type + lineBreak + lineBreak + content);\n      counter--;\n      ready();\n    }\n\n    // Add new things to the object\n    this.append = function (content, type) {\n      // Does the content have an array\n      if (typeof content === 'string' || !('length' in Object(content))) {\n        // Converti to multiples\n        content = [content];\n      }\n      for (var i = 0; i < content.length; i++) {\n        counter++;\n        var item = content[i];\n\n        // Is this a file?\n        // Files can be either Blobs or File types\n        if (typeof File !== 'undefined' && item instanceof File || typeof Blob !== 'undefined' && item instanceof Blob) {\n          // Read the file in\n          addFile(item);\n        }\n\n        // Data-URI?\n        // Data:[<mime type>][;charset=<charset>][;base64],<encoded data>\n        // /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i\n        else if (typeof item === 'string' && item.match(dataUri)) {\n          var m = item.match(dataUri);\n          addContent(item.replace(dataUri, ''), m[1] + lineBreak + 'Content-Transfer-Encoding: base64');\n        }\n\n        // Regular string\n        else {\n          addContent(item, type);\n        }\n      }\n    };\n    this.onready = function (fn) {\n      ready = function () {\n        if (counter === 0) {\n          // Trigger ready\n          body.unshift('');\n          body.push('--');\n          fn(body.join(delim), boundary);\n          body = [];\n        }\n      };\n      ready();\n    };\n  }\n\n  // Upload to Drive\n  // If this is PUT then only augment the file uploaded\n  // PUT https://developers.google.com/drive/v2/reference/files/update\n  // POST https://developers.google.com/drive/manage-uploads\n  function uploadDrive(p, callback) {\n    var data = {};\n\n    // Test for DOM element\n    if (p.data && typeof HTMLInputElement !== 'undefined' && p.data instanceof HTMLInputElement) {\n      p.data = {\n        file: p.data\n      };\n    }\n    if (!p.data.name && Object(Object(p.data.file).files).length && p.method === 'post') {\n      p.data.name = p.data.file.files[0].name;\n    }\n    if (p.method === 'post') {\n      p.data = {\n        title: p.data.name,\n        parents: [{\n          id: p.data.parent || 'root'\n        }],\n        file: p.data.file\n      };\n    } else {\n      // Make a reference\n      data = p.data;\n      p.data = {};\n\n      // Add the parts to change as required\n      if (data.parent) {\n        p.data.parents = [{\n          id: p.data.parent || 'root'\n        }];\n      }\n      if (data.file) {\n        p.data.file = data.file;\n      }\n      if (data.name) {\n        p.data.title = data.name;\n      }\n    }\n\n    // Extract the file, if it exists from the data object\n    // If the File is an INPUT element lets just concern ourselves with the NodeList\n    var file;\n    if ('file' in p.data) {\n      file = p.data.file;\n      delete p.data.file;\n      if (typeof file === 'object' && 'files' in file) {\n        // Assign the NodeList\n        file = file.files;\n      }\n      if (!file || !file.length) {\n        callback({\n          error: {\n            code: 'request_invalid',\n            message: 'There were no files attached with this request to upload'\n          }\n        });\n        return;\n      }\n    }\n\n    // Set type p.data.mimeType = Object(file[0]).type || 'application/octet-stream';\n\n    // Construct a multipart message\n    var parts = new Multipart();\n    parts.append(JSON.stringify(p.data), 'application/json');\n\n    // Read the file into a  base64 string... yep a hassle, i know\n    // FormData doesn't let us assign our own Multipart headers and HTTP Content-Type\n    // Alas GoogleApi need these in a particular format\n    if (file) {\n      parts.append(file);\n    }\n    parts.onready(function (body, boundary) {\n      p.headers['content-type'] = 'multipart/related; boundary=\"' + boundary + '\"';\n      p.data = body;\n      callback('upload/drive/v2/files' + (data.id ? '/' + data.id : '') + '?uploadType=multipart');\n    });\n  }\n  function toJSON(p) {\n    if (typeof p.data === 'object') {\n      // Convert the POST into a javascript object\n      try {\n        p.data = JSON.stringify(p.data);\n        p.headers['content-type'] = 'application/json';\n      } catch (e) {}\n    }\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    instagram: {\n      name: 'Instagram',\n      oauth: {\n        // See: http://instagram.com/developer/authentication/\n        version: 2,\n        auth: 'https://instagram.com/oauth/authorize/',\n        grant: 'https://api.instagram.com/oauth/access_token'\n      },\n      // Refresh the access_token once expired\n      refresh: true,\n      scope: {\n        basic: 'basic',\n        photos: '',\n        friends: 'relationships',\n        publish: 'likes comments',\n        email: '',\n        share: '',\n        publish_files: '',\n        files: '',\n        videos: '',\n        offline_access: ''\n      },\n      scope_delim: ' ',\n      base: 'https://api.instagram.com/v1/',\n      get: {\n        me: 'users/self',\n        'me/feed': 'users/self/feed?count=@{limit|100}',\n        'me/photos': 'users/self/media/recent?min_id=0&count=@{limit|100}',\n        'me/friends': 'users/self/follows?count=@{limit|100}',\n        'me/following': 'users/self/follows?count=@{limit|100}',\n        'me/followers': 'users/self/followed-by?count=@{limit|100}',\n        'friend/photos': 'users/@{id}/media/recent?min_id=0&count=@{limit|100}'\n      },\n      post: {\n        'me/like': function (p, callback) {\n          var id = p.data.id;\n          p.data = {};\n          callback('media/' + id + '/likes');\n        }\n      },\n      del: {\n        'me/like': 'media/@{id}/likes'\n      },\n      wrap: {\n        me: function (o) {\n          formatError(o);\n          if ('data' in o) {\n            o.id = o.data.id;\n            o.thumbnail = o.data.profile_picture;\n            o.name = o.data.full_name || o.data.username;\n          }\n          return o;\n        },\n        'me/friends': formatFriends,\n        'me/following': formatFriends,\n        'me/followers': formatFriends,\n        'me/photos': function (o) {\n          formatError(o);\n          paging(o);\n          if ('data' in o) {\n            o.data = o.data.filter(function (d) {\n              return d.type === 'image';\n            });\n            o.data.forEach(function (d) {\n              d.name = d.caption ? d.caption.text : null;\n              d.thumbnail = d.images.thumbnail.url;\n              d.picture = d.images.standard_resolution.url;\n              d.pictures = Object.keys(d.images).map(function (key) {\n                var image = d.images[key];\n                return formatImage(image);\n              }).sort(function (a, b) {\n                return a.width - b.width;\n              });\n            });\n          }\n          return o;\n        },\n        'default': function (o) {\n          o = formatError(o);\n          paging(o);\n          return o;\n        }\n      },\n      // Instagram does not return any CORS Headers\n      // So besides JSONP we're stuck with proxy\n      xhr: function (p, qs) {\n        var method = p.method;\n        var proxy = method !== 'get';\n        if (proxy) {\n          if ((method === 'post' || method === 'put') && p.query.access_token) {\n            p.data.access_token = p.query.access_token;\n            delete p.query.access_token;\n          }\n\n          // No access control headers\n          // Use the proxy instead\n          p.proxy = proxy;\n        }\n        return proxy;\n      },\n      // No form\n      form: false\n    }\n  });\n  function formatImage(image) {\n    return {\n      source: image.url,\n      width: image.width,\n      height: image.height\n    };\n  }\n  function formatError(o) {\n    if (typeof o === 'string') {\n      return {\n        error: {\n          code: 'invalid_request',\n          message: o\n        }\n      };\n    }\n    if (o && 'meta' in o && 'error_type' in o.meta) {\n      o.error = {\n        code: o.meta.error_type,\n        message: o.meta.error_message\n      };\n    }\n    return o;\n  }\n  function formatFriends(o) {\n    paging(o);\n    if (o && 'data' in o) {\n      o.data.forEach(formatFriend);\n    }\n    return o;\n  }\n  function formatFriend(o) {\n    if (o.id) {\n      o.thumbnail = o.profile_picture;\n      o.name = o.full_name || o.username;\n    }\n  }\n\n  // See: http://instagram.com/developer/endpoints/\n  function paging(res) {\n    if ('pagination' in res) {\n      res.paging = {\n        next: res.pagination.next_url\n      };\n      delete res.pagination;\n    }\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    joinme: {\n      name: 'join.me',\n      oauth: {\n        version: 2,\n        auth: 'https://secure.join.me/api/public/v1/auth/oauth2',\n        grant: 'https://secure.join.me/api/public/v1/auth/oauth2'\n      },\n      refresh: false,\n      scope: {\n        basic: 'user_info',\n        user: 'user_info',\n        scheduler: 'scheduler',\n        start: 'start_meeting',\n        email: '',\n        friends: '',\n        share: '',\n        publish: '',\n        photos: '',\n        publish_files: '',\n        files: '',\n        videos: '',\n        offline_access: ''\n      },\n      scope_delim: ' ',\n      login: function (p) {\n        p.options.popup.width = 400;\n        p.options.popup.height = 700;\n      },\n      base: 'https://api.join.me/v1/',\n      get: {\n        me: 'user',\n        meetings: 'meetings',\n        'meetings/info': 'meetings/@{id}'\n      },\n      post: {\n        'meetings/start/adhoc': function (p, callback) {\n          callback('meetings/start');\n        },\n        'meetings/start/scheduled': function (p, callback) {\n          var meetingId = p.data.meetingId;\n          p.data = {};\n          callback('meetings/' + meetingId + '/start');\n        },\n        'meetings/schedule': function (p, callback) {\n          callback('meetings');\n        }\n      },\n      patch: {\n        'meetings/update': function (p, callback) {\n          callback('meetings/' + p.data.meetingId);\n        }\n      },\n      del: {\n        'meetings/delete': 'meetings/@{id}'\n      },\n      wrap: {\n        me: function (o, headers) {\n          formatError(o, headers);\n          if (!o.email) {\n            return o;\n          }\n          o.name = o.fullName;\n          o.first_name = o.name.split(' ')[0];\n          o.last_name = o.name.split(' ')[1];\n          o.id = o.email;\n          return o;\n        },\n        'default': function (o, headers) {\n          formatError(o, headers);\n          return o;\n        }\n      },\n      xhr: formatRequest\n    }\n  });\n  function formatError(o, headers) {\n    var errorCode;\n    var message;\n    var details;\n    if (o && 'Message' in o) {\n      message = o.Message;\n      delete o.Message;\n      if ('ErrorCode' in o) {\n        errorCode = o.ErrorCode;\n        delete o.ErrorCode;\n      } else {\n        errorCode = getErrorCode(headers);\n      }\n      o.error = {\n        code: errorCode,\n        message: message,\n        details: o\n      };\n    }\n    return o;\n  }\n  function formatRequest(p, qs) {\n    // Move the access token from the request body to the request header\n    var token = qs.access_token;\n    delete qs.access_token;\n    p.headers.Authorization = 'Bearer ' + token;\n\n    // Format non-get requests to indicate json body\n    if (p.method !== 'get' && p.data) {\n      p.headers['Content-Type'] = 'application/json';\n      if (typeof p.data === 'object') {\n        p.data = JSON.stringify(p.data);\n      }\n    }\n    if (p.method === 'put') {\n      p.method = 'patch';\n    }\n    return true;\n  }\n  function getErrorCode(headers) {\n    switch (headers.statusCode) {\n      case 400:\n        return 'invalid_request';\n      case 403:\n        return 'stale_token';\n      case 401:\n        return 'invalid_token';\n      case 500:\n        return 'server_error';\n      default:\n        return 'server_error';\n    }\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    linkedin: {\n      oauth: {\n        version: 2,\n        response_type: 'code',\n        auth: 'https://www.linkedin.com/uas/oauth2/authorization',\n        grant: 'https://www.linkedin.com/uas/oauth2/accessToken'\n      },\n      // Refresh the access_token once expired\n      refresh: true,\n      scope: {\n        basic: 'r_basicprofile',\n        email: 'r_emailaddress',\n        files: '',\n        friends: '',\n        photos: '',\n        publish: 'w_share',\n        publish_files: 'w_share',\n        share: '',\n        videos: '',\n        offline_access: ''\n      },\n      scope_delim: ' ',\n      base: 'https://api.linkedin.com/v1/',\n      get: {\n        me: 'people/~:(picture-url,first-name,last-name,id,formatted-name,email-address)',\n        // See: http://developer.linkedin.com/documents/get-network-updates-and-statistics-api\n        'me/share': 'people/~/network/updates?count=@{limit|250}'\n      },\n      post: {\n        // See: https://developer.linkedin.com/documents/api-requests-json\n        'me/share': function (p, callback) {\n          var data = {\n            visibility: {\n              code: 'anyone'\n            }\n          };\n          if (p.data.id) {\n            data.attribution = {\n              share: {\n                id: p.data.id\n              }\n            };\n          } else {\n            data.comment = p.data.message;\n            if (p.data.picture && p.data.link) {\n              data.content = {\n                'submitted-url': p.data.link,\n                'submitted-image-url': p.data.picture\n              };\n            }\n          }\n          p.data = JSON.stringify(data);\n          callback('people/~/shares?format=json');\n        },\n        'me/like': like\n      },\n      del: {\n        'me/like': like\n      },\n      wrap: {\n        me: function (o) {\n          formatError(o);\n          formatUser(o);\n          return o;\n        },\n        'me/friends': formatFriends,\n        'me/following': formatFriends,\n        'me/followers': formatFriends,\n        'me/share': function (o) {\n          formatError(o);\n          paging(o);\n          if (o.values) {\n            o.data = o.values.map(formatUser);\n            o.data.forEach(function (item) {\n              item.message = item.headline;\n            });\n            delete o.values;\n          }\n          return o;\n        },\n        'default': function (o, headers) {\n          formatError(o);\n          empty(o, headers);\n          paging(o);\n        }\n      },\n      jsonp: function (p, qs) {\n        formatQuery(qs);\n        if (p.method === 'get') {\n          qs.format = 'jsonp';\n          qs['error-callback'] = p.callbackID;\n        }\n      },\n      xhr: function (p, qs) {\n        if (p.method !== 'get') {\n          formatQuery(qs);\n          p.headers['Content-Type'] = 'application/json';\n\n          // Note: x-li-format ensures error responses are not returned in XML\n          p.headers['x-li-format'] = 'json';\n          p.proxy = true;\n          return true;\n        }\n        return false;\n      }\n    }\n  });\n  function formatError(o) {\n    if (o && 'errorCode' in o) {\n      o.error = {\n        code: o.status,\n        message: o.message\n      };\n    }\n  }\n  function formatUser(o) {\n    if (o.error) {\n      return;\n    }\n    o.first_name = o.firstName;\n    o.last_name = o.lastName;\n    o.name = o.formattedName || o.first_name + ' ' + o.last_name;\n    o.thumbnail = o.pictureUrl;\n    o.email = o.emailAddress;\n    return o;\n  }\n  function formatFriends(o) {\n    formatError(o);\n    paging(o);\n    if (o.values) {\n      o.data = o.values.map(formatUser);\n      delete o.values;\n    }\n    return o;\n  }\n  function paging(res) {\n    if ('_count' in res && '_start' in res && res._count + res._start < res._total) {\n      res.paging = {\n        next: '?start=' + (res._start + res._count) + '&count=' + res._count\n      };\n    }\n  }\n  function empty(o, headers) {\n    if (JSON.stringify(o) === '{}' && headers.statusCode === 200) {\n      o.success = true;\n    }\n  }\n  function formatQuery(qs) {\n    // LinkedIn signs requests with the parameter 'oauth2_access_token'\n    // ... yeah another one who thinks they should be different!\n    if (qs.access_token) {\n      qs.oauth2_access_token = qs.access_token;\n      delete qs.access_token;\n    }\n  }\n  function like(p, callback) {\n    p.headers['x-li-format'] = 'json';\n    var id = p.data.id;\n    p.data = (p.method !== 'delete').toString();\n    p.method = 'put';\n    callback('people/~/network/updates/key=' + id + '/is-liked');\n  }\n})(hello);\n\n// See: https://developers.soundcloud.com/docs/api/reference\n(function (hello) {\n  hello.init({\n    soundcloud: {\n      name: 'SoundCloud',\n      oauth: {\n        version: 2,\n        auth: 'https://soundcloud.com/connect',\n        grant: 'https://soundcloud.com/oauth2/token'\n      },\n      // Request path translated\n      base: 'https://api.soundcloud.com/',\n      get: {\n        me: 'me.json',\n        // Http://developers.soundcloud.com/docs/api/reference#me\n        'me/friends': 'me/followings.json',\n        'me/followers': 'me/followers.json',\n        'me/following': 'me/followings.json',\n        // See: http://developers.soundcloud.com/docs/api/reference#activities\n        'default': function (p, callback) {\n          // Include '.json at the end of each request'\n          callback(p.path + '.json');\n        }\n      },\n      // Response handlers\n      wrap: {\n        me: function (o) {\n          formatUser(o);\n          return o;\n        },\n        'default': function (o) {\n          if (Array.isArray(o)) {\n            o = {\n              data: o.map(formatUser)\n            };\n          }\n          paging(o);\n          return o;\n        }\n      },\n      xhr: formatRequest,\n      jsonp: formatRequest\n    }\n  });\n  function formatRequest(p, qs) {\n    // Alter the querystring\n    var token = qs.access_token;\n    delete qs.access_token;\n    qs.oauth_token = token;\n    qs['_status_code_map[302]'] = 200;\n    return true;\n  }\n  function formatUser(o) {\n    if (o.id) {\n      o.picture = o.avatar_url;\n      o.thumbnail = o.avatar_url;\n      o.name = o.username || o.full_name;\n    }\n    return o;\n  }\n\n  // See: http://developers.soundcloud.com/docs/api/reference#activities\n  function paging(res) {\n    if ('next_href' in res) {\n      res.paging = {\n        next: res.next_href\n      };\n    }\n  }\n})(hello);\n\n// See: https://developer.spotify.com/web-api/\n(function (hello) {\n  hello.init({\n    spotify: {\n      name: 'Spotify',\n      oauth: {\n        version: 2,\n        auth: 'https://accounts.spotify.com/authorize',\n        grant: 'https://accounts.spotify.com/api/token'\n      },\n      // See: https://developer.spotify.com/web-api/using-scopes/\n      scope_delim: ' ',\n      scope: {\n        basic: '',\n        photos: '',\n        friends: 'user-follow-read',\n        publish: 'user-library-read',\n        email: 'user-read-email',\n        share: '',\n        publish_files: '',\n        files: '',\n        videos: '',\n        offline_access: ''\n      },\n      // Request path translated\n      base: 'https://api.spotify.com',\n      // See: https://developer.spotify.com/web-api/endpoint-reference/\n      get: {\n        me: '/v1/me',\n        'me/following': '/v1/me/following?type=artist',\n        // Only 'artist' is supported\n\n        // Because tracks, albums and playlist exist on spotify, the tracks are considered\n        // the resource for the 'me/likes' endpoint\n        'me/like': '/v1/me/tracks'\n      },\n      // Response handlers\n      wrap: {\n        me: formatUser,\n        'me/following': formatFollowees,\n        'me/like': formatTracks\n      },\n      xhr: formatRequest,\n      jsonp: false\n    }\n  });\n\n  // Move the access token from the request body to the request header\n  function formatRequest(p, qs) {\n    var token = qs.access_token;\n    delete qs.access_token;\n    p.headers.Authorization = 'Bearer ' + token;\n    return true;\n  }\n  function formatUser(o) {\n    if (o.id) {\n      o.name = o.display_name;\n      o.thumbnail = o.images.length ? o.images[0].url : null;\n      o.picture = o.thumbnail;\n    }\n    return o;\n  }\n  function formatFollowees(o) {\n    paging(o);\n    if (o && 'artists' in o) {\n      o.data = o.artists.items.forEach(formatUser);\n    }\n    return o;\n  }\n  function formatTracks(o) {\n    paging(o);\n    o.data = o.items;\n    return o;\n  }\n  function paging(res) {\n    if (res && 'next' in res) {\n      res.paging = {\n        next: res.next\n      };\n      delete res.next;\n    }\n  }\n})(hello);\n(function (hello) {\n  var base = 'https://api.twitter.com/';\n  hello.init({\n    twitter: {\n      // Ensure that you define an oauth_proxy\n      oauth: {\n        version: '1.0a',\n        auth: base + 'oauth/authenticate',\n        request: base + 'oauth/request_token',\n        token: base + 'oauth/access_token'\n      },\n      login: function (p) {\n        // Reauthenticate\n        // https://dev.twitter.com/oauth/reference/get/oauth/authenticate\n        var prefix = '?force_login=true';\n        this.oauth.auth = this.oauth.auth.replace(prefix, '') + (p.options.force ? prefix : '');\n      },\n      base: base + '1.1/',\n      get: {\n        me: 'account/verify_credentials.json',\n        'me/friends': 'friends/list.json?count=@{limit|200}',\n        'me/following': 'friends/list.json?count=@{limit|200}',\n        'me/followers': 'followers/list.json?count=@{limit|200}',\n        // Https://dev.twitter.com/docs/api/1.1/get/statuses/user_timeline\n        'me/share': 'statuses/user_timeline.json?count=@{limit|200}',\n        // Https://dev.twitter.com/rest/reference/get/favorites/list\n        'me/like': 'favorites/list.json?count=@{limit|200}'\n      },\n      post: {\n        'me/share': function (p, callback) {\n          var data = p.data;\n          p.data = null;\n          var status = [];\n\n          // Change message to status\n          if (data.message) {\n            status.push(data.message);\n            delete data.message;\n          }\n\n          // If link is given\n          if (data.link) {\n            status.push(data.link);\n            delete data.link;\n          }\n          if (data.picture) {\n            status.push(data.picture);\n            delete data.picture;\n          }\n\n          // Compound all the components\n          if (status.length) {\n            data.status = status.join(' ');\n          }\n\n          // Tweet media\n          if (data.file) {\n            data['media[]'] = data.file;\n            delete data.file;\n            p.data = data;\n            callback('statuses/update_with_media.json');\n          }\n\n          // Retweet?\n          else if ('id' in data) {\n            callback('statuses/retweet/' + data.id + '.json');\n          }\n\n          // Tweet\n          else {\n            // Assign the post body to the query parameters\n            hello.utils.extend(p.query, data);\n            callback('statuses/update.json?include_entities=1');\n          }\n        },\n        // See: https://dev.twitter.com/rest/reference/post/favorites/create\n        'me/like': function (p, callback) {\n          var id = p.data.id;\n          p.data = null;\n          callback('favorites/create.json?id=' + id);\n        }\n      },\n      del: {\n        // See: https://dev.twitter.com/rest/reference/post/favorites/destroy\n        'me/like': function () {\n          p.method = 'post';\n          var id = p.data.id;\n          p.data = null;\n          callback('favorites/destroy.json?id=' + id);\n        }\n      },\n      wrap: {\n        me: function (res) {\n          formatError(res);\n          formatUser(res);\n          return res;\n        },\n        'me/friends': formatFriends,\n        'me/followers': formatFriends,\n        'me/following': formatFriends,\n        'me/share': function (res) {\n          formatError(res);\n          paging(res);\n          if (!res.error && 'length' in res) {\n            return {\n              data: res\n            };\n          }\n          return res;\n        },\n        'default': function (res) {\n          res = arrayToDataResponse(res);\n          paging(res);\n          return res;\n        }\n      },\n      xhr: function (p) {\n        // Rely on the proxy for non-GET requests.\n        return p.method !== 'get';\n      }\n    }\n  });\n  function formatUser(o) {\n    if (o.id) {\n      if (o.name) {\n        var m = o.name.split(' ');\n        o.first_name = m.shift();\n        o.last_name = m.join(' ');\n      }\n\n      // See: https://dev.twitter.com/overview/general/user-profile-images-and-banners\n      o.thumbnail = o.profile_image_url_https || o.profile_image_url;\n    }\n    return o;\n  }\n  function formatFriends(o) {\n    formatError(o);\n    paging(o);\n    if (o.users) {\n      o.data = o.users.map(formatUser);\n      delete o.users;\n    }\n    return o;\n  }\n  function formatError(o) {\n    if (o.errors) {\n      var e = o.errors[0];\n      o.error = {\n        code: 'request_failed',\n        message: e.message\n      };\n    }\n  }\n\n  // Take a cursor and add it to the path\n  function paging(res) {\n    // Does the response include a 'next_cursor_string'\n    if ('next_cursor_str' in res) {\n      // See: https://dev.twitter.com/docs/misc/cursoring\n      res.paging = {\n        next: '?cursor=' + res.next_cursor_str\n      };\n    }\n  }\n  function arrayToDataResponse(res) {\n    return Array.isArray(res) ? {\n      data: res\n    } : res;\n  }\n\n  /**\n  // The documentation says to define user in the request\n  // Although its not actually required.\n  \tvar user_id;\n  \tfunction withUserId(callback){\n  \tif(user_id){\n  \t\tcallback(user_id);\n  \t}\n  \telse{\n  \t\thello.api('twitter:/me', function(o){\n  \t\t\tuser_id = o.id;\n  \t\t\tcallback(o.id);\n  \t\t});\n  \t}\n  }\n  \tfunction sign(url){\n  \treturn function(p, callback){\n  \t\twithUserId(function(user_id){\n  \t\t\tcallback(url+'?user_id='+user_id);\n  \t\t});\n  \t};\n  }\n  */\n})(hello);\n\n// Vkontakte (vk.com)\n(function (hello) {\n  hello.init({\n    vk: {\n      name: 'Vk',\n      // See https://vk.com/dev/oauth_dialog\n      oauth: {\n        version: 2,\n        auth: 'https://oauth.vk.com/authorize',\n        grant: 'https://oauth.vk.com/access_token'\n      },\n      // Authorization scopes\n      // See https://vk.com/dev/permissions\n      scope: {\n        email: 'email',\n        friends: 'friends',\n        photos: 'photos',\n        videos: 'video',\n        share: 'share',\n        offline_access: 'offline'\n      },\n      // Refresh the access_token\n      refresh: true,\n      login: function (p) {\n        p.qs.display = window.navigator && window.navigator.userAgent && /ipad|phone|phone|android/.test(window.navigator.userAgent.toLowerCase()) ? 'mobile' : 'popup';\n      },\n      // API Base URL\n      base: 'https://api.vk.com/method/',\n      // Map GET requests\n      get: {\n        me: function (p, callback) {\n          p.query.fields = 'id,first_name,last_name,photo_max';\n          callback('users.get');\n        }\n      },\n      wrap: {\n        me: function (res, headers, req) {\n          formatError(res);\n          return formatUser(res, req);\n        }\n      },\n      // No XHR\n      xhr: false,\n      // All requests should be JSONP as of missing CORS headers in https://api.vk.com/method/*\n      jsonp: true,\n      // No form\n      form: false\n    }\n  });\n  function formatUser(o, req) {\n    if (o !== null && 'response' in o && o.response !== null && o.response.length) {\n      o = o.response[0];\n      o.id = o.uid;\n      o.thumbnail = o.picture = o.photo_max;\n      o.name = o.first_name + ' ' + o.last_name;\n      if (req.authResponse && req.authResponse.email !== null) o.email = req.authResponse.email;\n    }\n    return o;\n  }\n  function formatError(o) {\n    if (o.error) {\n      var e = o.error;\n      o.error = {\n        code: e.error_code,\n        message: e.error_msg\n      };\n    }\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    windows: {\n      name: 'Windows live',\n      // REF: http://msdn.microsoft.com/en-us/library/hh243641.aspx\n      oauth: {\n        version: 2,\n        auth: 'https://login.live.com/oauth20_authorize.srf',\n        grant: 'https://login.live.com/oauth20_token.srf'\n      },\n      // Refresh the access_token once expired\n      refresh: true,\n      logout: function () {\n        return 'http://login.live.com/oauth20_logout.srf?ts=' + new Date().getTime();\n      },\n      // Authorization scopes\n      scope: {\n        basic: 'wl.signin,wl.basic',\n        email: 'wl.emails',\n        birthday: 'wl.birthday',\n        events: 'wl.calendars',\n        photos: 'wl.photos',\n        videos: 'wl.photos',\n        friends: 'wl.contacts_emails',\n        files: 'wl.skydrive',\n        publish: 'wl.share',\n        publish_files: 'wl.skydrive_update',\n        share: 'wl.share',\n        create_event: 'wl.calendars_update,wl.events_create',\n        offline_access: 'wl.offline_access'\n      },\n      // API base URL\n      base: 'https://apis.live.net/v5.0/',\n      // Map GET requests\n      get: {\n        // Friends\n        me: 'me',\n        'me/friends': 'me/friends',\n        'me/following': 'me/contacts',\n        'me/followers': 'me/friends',\n        'me/contacts': 'me/contacts',\n        'me/albums': 'me/albums',\n        // Include the data[id] in the path\n        'me/album': '@{id}/files',\n        'me/photo': '@{id}',\n        // Files\n        'me/files': '@{parent|me/skydrive}/files',\n        'me/folders': '@{id|me/skydrive}/files',\n        'me/folder': '@{id|me/skydrive}/files'\n      },\n      // Map POST requests\n      post: {\n        'me/albums': 'me/albums',\n        'me/album': '@{id}/files/',\n        'me/folders': '@{id|me/skydrive/}',\n        'me/files': '@{parent|me/skydrive}/files'\n      },\n      // Map DELETE requests\n      del: {\n        // Include the data[id] in the path\n        'me/album': '@{id}',\n        'me/photo': '@{id}',\n        'me/folder': '@{id}',\n        'me/files': '@{id}'\n      },\n      wrap: {\n        me: formatUser,\n        'me/friends': formatFriends,\n        'me/contacts': formatFriends,\n        'me/followers': formatFriends,\n        'me/following': formatFriends,\n        'me/albums': formatAlbums,\n        'me/photos': formatDefault,\n        'default': formatDefault\n      },\n      xhr: function (p) {\n        if (p.method !== 'get' && p.method !== 'delete' && !hello.utils.hasBinary(p.data)) {\n          // Does this have a data-uri to upload as a file?\n          if (typeof p.data.file === 'string') {\n            p.data.file = hello.utils.toBlob(p.data.file);\n          } else {\n            p.data = JSON.stringify(p.data);\n            p.headers = {\n              'Content-Type': 'application/json'\n            };\n          }\n        }\n        return true;\n      },\n      jsonp: function (p) {\n        if (p.method !== 'get' && !hello.utils.hasBinary(p.data)) {\n          p.data.method = p.method;\n          p.method = 'get';\n        }\n      }\n    }\n  });\n  function formatDefault(o) {\n    if ('data' in o) {\n      o.data.forEach(function (d) {\n        if (d.picture) {\n          d.thumbnail = d.picture;\n        }\n        if (d.images) {\n          d.pictures = d.images.map(formatImage).sort(function (a, b) {\n            return a.width - b.width;\n          });\n        }\n      });\n    }\n    return o;\n  }\n  function formatImage(image) {\n    return {\n      width: image.width,\n      height: image.height,\n      source: image.source\n    };\n  }\n  function formatAlbums(o) {\n    if ('data' in o) {\n      o.data.forEach(function (d) {\n        d.photos = d.files = 'https://apis.live.net/v5.0/' + d.id + '/photos';\n      });\n    }\n    return o;\n  }\n  function formatUser(o, headers, req) {\n    if (o.id) {\n      var token = req.query.access_token;\n      if (o.emails) {\n        o.email = o.emails.preferred;\n      }\n\n      // If this is not an non-network friend\n      if (o.is_friend !== false) {\n        // Use the id of the user_id if available\n        var id = o.user_id || o.id;\n        o.thumbnail = o.picture = 'https://apis.live.net/v5.0/' + id + '/picture?access_token=' + token;\n      }\n    }\n    return o;\n  }\n  function formatFriends(o, headers, req) {\n    if ('data' in o) {\n      o.data.forEach(function (d) {\n        formatUser(d, headers, req);\n      });\n    }\n    return o;\n  }\n})(hello);\n(function (hello) {\n  hello.init({\n    yahoo: {\n      // Ensure that you define an oauth_proxy\n      oauth: {\n        version: '1.0a',\n        auth: 'https://api.login.yahoo.com/oauth/v2/request_auth',\n        request: 'https://api.login.yahoo.com/oauth/v2/get_request_token',\n        token: 'https://api.login.yahoo.com/oauth/v2/get_token'\n      },\n      // Login handler\n      login: function (p) {\n        // Change the default popup window to be at least 560\n        // Yahoo does dynamically change it on the fly for the signin screen (only, what if your already signed in)\n        p.options.popup.width = 560;\n\n        // Yahoo throws an parameter error if for whatever reason the state.scope contains a comma, so lets remove scope\n        try {\n          delete p.qs.state.scope;\n        } catch (e) {}\n      },\n      base: 'https://social.yahooapis.com/v1/',\n      get: {\n        me: yql('select * from social.profile(0) where guid=me'),\n        'me/friends': yql('select * from social.contacts(0) where guid=me'),\n        'me/following': yql('select * from social.contacts(0) where guid=me')\n      },\n      wrap: {\n        me: formatUser,\n        // Can't get IDs\n        // It might be better to loop through the social.relationship table with has unique IDs of users.\n        'me/friends': formatFriends,\n        'me/following': formatFriends,\n        'default': paging\n      }\n    }\n  });\n\n  /*\n  \t// Auto-refresh fix: bug in Yahoo can't get this to work with node-oauth-shim\n  \tlogin : function(o){\n  \t\t// Is the user already logged in\n  \t\tvar auth = hello('yahoo').getAuthResponse();\n  \t\t\t// Is this a refresh token?\n  \t\tif(o.options.display==='none'&&auth&&auth.access_token&&auth.refresh_token){\n  \t\t\t// Add the old token and the refresh token, including path to the query\n  \t\t\t// See http://developer.yahoo.com/oauth/guide/oauth-refreshaccesstoken.html\n  \t\t\to.qs.access_token = auth.access_token;\n  \t\t\to.qs.refresh_token = auth.refresh_token;\n  \t\t\to.qs.token_url = 'https://api.login.yahoo.com/oauth/v2/get_token';\n  \t\t}\n  \t},\n  */\n\n  function formatError(o) {\n    if (o && 'meta' in o && 'error_type' in o.meta) {\n      o.error = {\n        code: o.meta.error_type,\n        message: o.meta.error_message\n      };\n    }\n  }\n  function formatUser(o) {\n    formatError(o);\n    if (o.query && o.query.results && o.query.results.profile) {\n      o = o.query.results.profile;\n      o.id = o.guid;\n      o.last_name = o.familyName;\n      o.first_name = o.givenName || o.nickname;\n      var a = [];\n      if (o.first_name) {\n        a.push(o.first_name);\n      }\n      if (o.last_name) {\n        a.push(o.last_name);\n      }\n      o.name = a.join(' ');\n      o.email = o.emails && o.emails[0] ? o.emails[0].handle : null;\n      o.thumbnail = o.image ? o.image.imageUrl : null;\n    }\n    return o;\n  }\n  function formatFriends(o, headers, request) {\n    formatError(o);\n    paging(o, headers, request);\n    var contact;\n    var field;\n    if (o.query && o.query.results && o.query.results.contact) {\n      o.data = o.query.results.contact;\n      delete o.query;\n      if (!Array.isArray(o.data)) {\n        o.data = [o.data];\n      }\n      o.data.forEach(formatFriend);\n    }\n    return o;\n  }\n  function formatFriend(contact) {\n    contact.id = null;\n\n    // #362: Reports of responses returning a single item, rather than an Array of items.\n    // Format the contact.fields to be an array.\n    if (contact.fields && !(contact.fields instanceof Array)) {\n      contact.fields = [contact.fields];\n    }\n    (contact.fields || []).forEach(function (field) {\n      if (field.type === 'email') {\n        contact.email = field.value;\n      }\n      if (field.type === 'name') {\n        contact.first_name = field.value.givenName;\n        contact.last_name = field.value.familyName;\n        contact.name = field.value.givenName + ' ' + field.value.familyName;\n      }\n      if (field.type === 'yahooid') {\n        contact.id = field.value;\n      }\n    });\n  }\n  function paging(res, headers, request) {\n    // See: http://developer.yahoo.com/yql/guide/paging.html#local_limits\n    if (res.query && res.query.count && request.options) {\n      res.paging = {\n        next: '?start=' + (res.query.count + (+request.options.start || 1))\n      };\n    }\n    return res;\n  }\n  function yql(q) {\n    return 'https://query.yahooapis.com/v1/yql?q=' + (q + ' limit @{limit|100} offset @{start|0}').replace(/\\s/g, '%20') + '&format=json';\n  }\n})(hello);\n\n// Register as anonymous AMD module\nif (typeof define === 'function' && define.amd) {\n  define(function () {\n    return hello;\n  });\n}\n\n// CommonJS module for browserify\nif (typeof module === 'object' && module.exports) {\n  module.exports = hello;\n}","map":{"version":3,"names":["Object","create","F","o","arguments","length","Error","prototype","keys","k","r","hasOwnProperty","call","push","Array","indexOf","s","j","forEach","fun","TypeError","t","len","thisArg","i","filter","a","val","map","isArray","toString","window","location","assign","url","Function","bind","b","C","slice","f","_this","D","apply","concat","hello","name","use","utils","extend","x","settings","redirect_uri","href","split","response_type","display","state","oauth_proxy","timeout","popup","resizable","scrollbars","width","height","scope","scope_map","basic","default_service","force","page_uri","services","service","self","Event","init","options","id","login","error","promise","Promise","p","args","network","callback","qs","diffKey","opts","merge","proxy","then","emit","value","reject","provider","callbackId","globalEvent","obj","JSON","parse","store","fulfill","authResponse","redirectUri","responseType","oauth","test","grant","replace","client_id","encodeURIComponent","session","SCOPE_SPLIT","scopeMap","String","join","unique","filterEmpty","item","scope_delim","access_token","expires","Date","getTime","diff","unchanged","parseInt","version","refresh_token","stringify","encodeFunction","auth","iframe","timer","setInterval","closed","clearInterval","response","logout","_opts","message","undefined","getAuthResponse","events","code","params","formatFunction","str","reg","RegExp","match","isEmpty","param","m","decodeURIComponent","prefix","localStorage","setItem","removeItem","e","cache","getItem","prop","document","cookie","_m","substr","get","json","set","days","append","node","attr","target","n","createElement","y","innerHTML","setAttribute","body","appendChild","setTimeout","getElementsByTagName","src","style","position","left","bottom","unshift","path","URL","cloneNode","index","key","STATE_PENDING","STATE_FULFILLED","STATE_REJECTED","api","executor","fulfillValue","rejectReason","onFulfilled","onRejected","deliver","curr","next","resolver","execute","execute_handlers","handlers","func","process","nextTick","setImmediate","cb","method","result","resolve","resolved","separator","parent","findEvents","on","evt","off","handler","emitAfter","guid","Math","random","console","documentElement","top","dualScreenTop","screenTop","screen","innerHeight","clientHeight","dualScreenLeft","screenLeft","innerWidth","clientWidth","optionsArray","navigator","userAgent","open","focus","responseHandler","search","oauth_token","hash","stateDecoded","expires_in","authCallback","error_message","error_description","res","closeWindow","oauth_redirect","callbackID","frameElement","removeChild","close","addEventListener","oldSessions","expired","CURRENT_TIME","eventName","oldSess","refresh","query","data","toLowerCase","headers","formatResponse","clone","actions","xhr","jsonp","form","getPath","defaults","base","request","statusCode","success","wrap","time","paging","hasBinary","cors","request_cors","formatUrl","onprogress","upload","onuploadprogress","_query","post","sign","proxy_response_type","suppress_response_codes","XMLHttpRequest","domInstance","type","toUpperCase","Element","tagName","Number","isBinary","FormData","binary","onload","responseText","_e","status","statusText","headersToJSON","getAllResponseHeaders","onerror","File","Blob","HTMLInputElement","files","overrideMimeType","setRequestHeader","send","exec","bool","head","operaFix","script","async","onreadystatechange","readyState","text","doc","reenableAfterSubmit","newform","win","callbackonload","elements","disabled","encoding","enctype","input","el","inputs","NodeList","parentNode","innerText","getAttribute","submit","ee","FileList","toBlob","dataURI","atob","array","charCodeAt","Uint8Array","dataToJSON","w","nodeListToJSON","file","nodelist","opener","chrome","identity","launchWebAuthFlow","_open","_cache","storage","local","interactive","ref","responseUrl","_popup","cordova","hidden","utilPopup","redirectUriOrigin","origin","protocol","hostname","executeScript","OAuth1Settings","token","OAuth2Settings","dropbox","redirect","root","me","req","default","me/files","fileName","me/folders","del","formatError","uid","display_name","first_name","shift","last_name","is_dir","contents","formatFile","is_deleted","ArrayBuffer","thumb_exists","thumbnail","mime_type","downloadLink","limit","facebook","email","share","birthday","photos","videos","friends","publish_files","publish","offline_access","auth_type","formatUser","formatFriends","format","picture","d","pictures","images","sort","cover_photo","can_upload","upload_location","flickr","per_page","photoset_id","checkResponse","realname","_content","getBuddyIcon","me/albums","photoset","title","getApiUrl","me/photos","formatPhotos","jsoncallback","extraParams","skipNetwork","withUser","user_nsid","userId","user_id","profile","size","nsid","iconserver","iconfarm","createPhotoUrl","farm","server","secret","stat","photo","createPictures","source","NO_LIMIT","sizes","max","contacts","contact","username","page","pages","foursquare","user","items","formatRequest","meta","errorDetail","suffix","firstName","lastName","v","github","avatar_url","Link","contactsUrl","google","create_event","access_type","nonce","approval_prompt","me/album","uploadDrive","parents","mimeType","put","patch","sub","family_name","familyName","given_name","givenName","emails","formatPerson","me/friends","formatFeed","gEntry","toJSON","toInt","formatItem","thumbnailLink","formatImage","image","feed","entry","formatEntry","displayName","$t","gd$email","address","updated","link","pic","gd$etag","category","group","media$group","media$content","mediaContent","mediaThumbnail","media$thumbnail","_a","description","summary","updated_time","created_time","published","rel","scheme","term","openSearch$itemsPerPage","start","openSearch$startIndex","total","openSearch$totalResults","nextPageToken","Multipart","boundary","counter","lineBreak","delim","ready","dataUri","addFile","fr","FileReader","addContent","btoa","readAsBinaryString","content","onready","fn","parts","instagram","me/like","profile_picture","full_name","caption","standard_resolution","error_type","formatFriend","pagination","next_url","joinme","scheduler","meetings","meetings/start/adhoc","meetings/start/scheduled","meetingId","meetings/schedule","meetings/update","fullName","errorCode","details","Message","ErrorCode","getErrorCode","Authorization","linkedin","me/share","visibility","attribution","comment","like","values","headline","empty","formatQuery","formattedName","pictureUrl","emailAddress","_count","_start","_total","oauth2_access_token","soundcloud","next_href","spotify","formatFollowees","formatTracks","artists","twitter","arrayToDataResponse","profile_image_url_https","profile_image_url","users","errors","next_cursor_str","vk","fields","photo_max","error_code","error_msg","windows","formatAlbums","formatDefault","preferred","is_friend","yahoo","yql","results","nickname","handle","imageUrl","field","count","q","define","amd","module","exports"],"sources":["/home/ashutosh/work/kbc/node_modules/hellojs/dist/hello.all.js"],"sourcesContent":["/*! hellojs v1.18.0 | (c) 2012-2019 Andrew Dodson | MIT https://adodson.com/hello.js/LICENSE */\n// ES5 Object.create\nif (!Object.create) {\n\n\t// Shim, Object create\n\t// A shim for Object.create(), it adds a prototype to a new object\n\tObject.create = (function() {\n\n\t\tfunction F() {}\n\n\t\treturn function(o) {\n\n\t\t\tif (arguments.length != 1) {\n\t\t\t\tthrow new Error('Object.create implementation only accepts one parameter.');\n\t\t\t}\n\n\t\t\tF.prototype = o;\n\t\t\treturn new F();\n\t\t};\n\n\t})();\n\n}\n\n// ES5 Object.keys\nif (!Object.keys) {\n\tObject.keys = function(o, k, r) {\n\t\tr = [];\n\t\tfor (k in o) {\n\t\t\tif (r.hasOwnProperty.call(o, k))\n\t\t\t\tr.push(k);\n\t\t}\n\n\t\treturn r;\n\t};\n}\n\n// ES5 [].indexOf\nif (!Array.prototype.indexOf) {\n\tArray.prototype.indexOf = function(s) {\n\n\t\tfor (var j = 0; j < this.length; j++) {\n\t\t\tif (this[j] === s) {\n\t\t\t\treturn j;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t};\n}\n\n// ES5 [].forEach\nif (!Array.prototype.forEach) {\n\tArray.prototype.forEach = function(fun/*, thisArg*/) {\n\n\t\tif (this === void 0 || this === null) {\n\t\t\tthrow new TypeError();\n\t\t}\n\n\t\tvar t = Object(this);\n\t\tvar len = t.length >>> 0;\n\t\tif (typeof fun !== 'function') {\n\t\t\tthrow new TypeError();\n\t\t}\n\n\t\tvar thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (i in t) {\n\t\t\t\tfun.call(thisArg, t[i], i, t);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t};\n}\n\n// ES5 [].filter\nif (!Array.prototype.filter) {\n\tArray.prototype.filter = function(fun, thisArg) {\n\n\t\tvar a = [];\n\t\tthis.forEach(function(val, i, t) {\n\t\t\tif (fun.call(thisArg || void 0, val, i, t)) {\n\t\t\t\ta.push(val);\n\t\t\t}\n\t\t});\n\n\t\treturn a;\n\t};\n}\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.19\n// Reference: http://es5.github.io/#x15.4.4.19\nif (!Array.prototype.map) {\n\n\tArray.prototype.map = function(fun, thisArg) {\n\n\t\tvar a = [];\n\t\tthis.forEach(function(val, i, t) {\n\t\t\ta.push(fun.call(thisArg || void 0, val, i, t));\n\t\t});\n\n\t\treturn a;\n\t};\n}\n\n// ES5 isArray\nif (!Array.isArray) {\n\n\t// Function Array.isArray\n\tArray.isArray = function(o) {\n\t\treturn Object.prototype.toString.call(o) === '[object Array]';\n\t};\n\n}\n\n// Test for location.assign\nif (typeof window === 'object' && typeof window.location === 'object' && !window.location.assign) {\n\n\twindow.location.assign = function(url) {\n\t\twindow.location = url;\n\t};\n\n}\n\n// Test for Function.bind\nif (!Function.prototype.bind) {\n\n\t// MDN\n\t// Polyfill IE8, does not support native Function.bind\n\tFunction.prototype.bind = function(b) {\n\n\t\tif (typeof this !== 'function') {\n\t\t\tthrow new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n\t\t}\n\n\t\tfunction C() {}\n\n\t\tvar a = [].slice;\n\t\tvar f = a.call(arguments, 1);\n\t\tvar _this = this;\n\t\tvar D = function() {\n\t\t\treturn _this.apply(this instanceof C ? this : b || window, f.concat(a.call(arguments)));\n\t\t};\n\n\t\tC.prototype = this.prototype;\n\t\tD.prototype = new C();\n\n\t\treturn D;\n\t};\n\n}\n\n/**\n * @hello.js\n *\n * HelloJS is a client side Javascript SDK for making OAuth2 logins and subsequent REST calls.\n *\n * @author Andrew Dodson\n * @website https://adodson.com/hello.js/\n *\n * @copyright Andrew Dodson, 2012 - 2015\n * @license MIT: You are free to use and modify this code for any use, on the condition that this copyright notice remains.\n */\n\nvar hello = function(name) {\n\treturn hello.use(name);\n};\n\nhello.utils = {\n\n\t// Extend the first object with the properties and methods of the second\n\textend: function(r /*, a[, b[, ...]] */) {\n\n\t\t// Get the arguments as an array but ommit the initial item\n\t\tArray.prototype.slice.call(arguments, 1).forEach(function(a) {\n\t\t\tif (Array.isArray(r) && Array.isArray(a)) {\n\t\t\t\tArray.prototype.push.apply(r, a);\n\t\t\t}\n\t\t\telse if (r && (r instanceof Object || typeof r === 'object') && a && (a instanceof Object || typeof a === 'object') && r !== a) {\n\t\t\t\tfor (var x in a) {\n\t\t\t\t\tr[x] = hello.utils.extend(r[x], a[x]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t// Clone it\n\t\t\t\t\ta = a.slice(0);\n\t\t\t\t}\n\n\t\t\t\tr = a;\n\t\t\t}\n\t\t});\n\n\t\treturn r;\n\t}\n};\n\n// Core library\nhello.utils.extend(hello, {\n\n\tsettings: {\n\n\t\t// OAuth2 authentication defaults\n\t\tredirect_uri: window.location.href.split('#')[0],\n\t\tresponse_type: 'token',\n\t\tdisplay: 'popup',\n\t\tstate: '',\n\n\t\t// OAuth1 shim\n\t\t// The path to the OAuth1 server for signing user requests\n\t\t// Want to recreate your own? Checkout https://github.com/MrSwitch/node-oauth-shim\n\t\toauth_proxy: 'https://auth-server.herokuapp.com/proxy',\n\n\t\t// API timeout in milliseconds\n\t\ttimeout: 20000,\n\n\t\t// Popup Options\n\t\tpopup: {\n\t\t\tresizable: 1,\n\t\t\tscrollbars: 1,\n\t\t\twidth: 500,\n\t\t\theight: 550\n\t\t},\n\n\t\t// Default scope\n\t\t// Many services require atleast a profile scope,\n\t\t// HelloJS automatially includes the value of provider.scope_map.basic\n\t\t// If that's not required it can be removed via hello.settings.scope.length = 0;\n\t\tscope: ['basic'],\n\n\t\t// Scope Maps\n\t\t// This is the default module scope, these are the defaults which each service is mapped too.\n\t\t// By including them here it prevents the scope from being applied accidentally\n\t\tscope_map: {\n\t\t\tbasic: ''\n\t\t},\n\n\t\t// Default service / network\n\t\tdefault_service: null,\n\n\t\t// Force authentication\n\t\t// When hello.login is fired.\n\t\t// (null): ignore current session expiry and continue with login\n\t\t// (true): ignore current session expiry and continue with login, ask for user to reauthenticate\n\t\t// (false): if the current session looks good for the request scopes return the current session.\n\t\tforce: null,\n\n\t\t// Page URL\n\t\t// When 'display=page' this property defines where the users page should end up after redirect_uri\n\t\t// Ths could be problematic if the redirect_uri is indeed the final place,\n\t\t// Typically this circumvents the problem of the redirect_url being a dumb relay page.\n\t\tpage_uri: window.location.href\n\t},\n\n\t// Service configuration objects\n\tservices: {},\n\n\t// Use\n\t// Define a new instance of the HelloJS library with a default service\n\tuse: function(service) {\n\n\t\t// Create self, which inherits from its parent\n\t\tvar self = Object.create(this);\n\n\t\t// Inherit the prototype from its parent\n\t\tself.settings = Object.create(this.settings);\n\n\t\t// Define the default service\n\t\tif (service) {\n\t\t\tself.settings.default_service = service;\n\t\t}\n\n\t\t// Create an instance of Events\n\t\tself.utils.Event.call(self);\n\n\t\treturn self;\n\t},\n\n\t// Initialize\n\t// Define the client_ids for the endpoint services\n\t// @param object o, contains a key value pair, service => clientId\n\t// @param object opts, contains a key value pair of options used for defining the authentication defaults\n\t// @param number timeout, timeout in seconds\n\tinit: function(services, options) {\n\n\t\tvar utils = this.utils;\n\n\t\tif (!services) {\n\t\t\treturn this.services;\n\t\t}\n\n\t\t// Define provider credentials\n\t\t// Reformat the ID field\n\t\tfor (var x in services) {if (services.hasOwnProperty(x)) {\n\t\t\tif (typeof (services[x]) !== 'object') {\n\t\t\t\tservices[x] = {id: services[x]};\n\t\t\t}\n\t\t}}\n\n\t\t// Merge services if there already exists some\n\t\tutils.extend(this.services, services);\n\n\t\t// Update the default settings with this one.\n\t\tif (options) {\n\t\t\tutils.extend(this.settings, options);\n\n\t\t\t// Do this immediatly incase the browser changes the current path.\n\t\t\tif ('redirect_uri' in options) {\n\t\t\t\tthis.settings.redirect_uri = utils.url(options.redirect_uri).href;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t// Login\n\t// Using the endpoint\n\t// @param network stringify       name to connect to\n\t// @param options object    (optional)  {display mode, is either none|popup(default)|page, scope: email,birthday,publish, .. }\n\t// @param callback  function  (optional)  fired on signin\n\tlogin: function() {\n\n\t\t// Create an object which inherits its parent as the prototype and constructs a new event chain.\n\t\tvar _this = this;\n\t\tvar utils = _this.utils;\n\t\tvar error = utils.error;\n\t\tvar promise = utils.Promise();\n\n\t\t// Get parameters\n\t\tvar p = utils.args({network: 's', options: 'o', callback: 'f'}, arguments);\n\n\t\t// Local vars\n\t\tvar url;\n\n\t\t// Get all the custom options and store to be appended to the querystring\n\t\tvar qs = utils.diffKey(p.options, _this.settings);\n\n\t\t// Merge/override options with app defaults\n\t\tvar opts = p.options = utils.merge(_this.settings, p.options || {});\n\n\t\t// Merge/override options with app defaults\n\t\topts.popup = utils.merge(_this.settings.popup, p.options.popup || {});\n\n\t\t// Network\n\t\tp.network = p.network || _this.settings.default_service;\n\n\t\t// Bind callback to both reject and fulfill states\n\t\tpromise.proxy.then(p.callback, p.callback);\n\n\t\t// Trigger an event on the global listener\n\t\tfunction emit(s, value) {\n\t\t\thello.emit(s, value);\n\t\t}\n\n\t\tpromise.proxy.then(emit.bind(this, 'auth.login auth'), emit.bind(this, 'auth.failed auth'));\n\n\t\t// Is our service valid?\n\t\tif (typeof (p.network) !== 'string' || !(p.network in _this.services)) {\n\t\t\t// Trigger the default login.\n\t\t\t// Ahh we dont have one.\n\t\t\treturn promise.reject(error('invalid_network', 'The provided network was not recognized'));\n\t\t}\n\n\t\tvar provider = _this.services[p.network];\n\n\t\t// Create a global listener to capture events triggered out of scope\n\t\tvar callbackId = utils.globalEvent(function(obj) {\n\n\t\t\t// The responseHandler returns a string, lets save this locally\n\t\t\tif (obj) {\n\t\t\t\tif (typeof (obj) == 'string') {\n\t\t\t\t\tobj = JSON.parse(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj = error('cancelled', 'The authentication was not completed');\n\t\t\t}\n\n\t\t\t// Handle these response using the local\n\t\t\t// Trigger on the parent\n\t\t\tif (!obj.error) {\n\n\t\t\t\t// Save on the parent window the new credentials\n\t\t\t\t// This fixes an IE10 bug i think... atleast it does for me.\n\t\t\t\tutils.store(obj.network, obj);\n\n\t\t\t\t// Fulfill a successful login\n\t\t\t\tpromise.fulfill({\n\t\t\t\t\tnetwork: obj.network,\n\t\t\t\t\tauthResponse: obj\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Reject a successful login\n\t\t\t\tpromise.reject(obj);\n\t\t\t}\n\t\t});\n\n\t\tvar redirectUri = utils.url(opts.redirect_uri).href;\n\n\t\t// May be a space-delimited list of multiple, complementary types\n\t\tvar responseType = provider.oauth.response_type || opts.response_type;\n\n\t\t// Fallback to token if the module hasn't defined a grant url\n\t\tif (/\\bcode\\b/.test(responseType) && !provider.oauth.grant) {\n\t\t\tresponseType = responseType.replace(/\\bcode\\b/, 'token');\n\t\t}\n\n\t\t// Query string parameters, we may pass our own arguments to form the querystring\n\t\tp.qs = utils.merge(qs, {\n\t\t\tclient_id: encodeURIComponent(provider.id),\n\t\t\tresponse_type: encodeURIComponent(responseType),\n\t\t\tredirect_uri: encodeURIComponent(redirectUri),\n\t\t\tstate: {\n\t\t\t\tclient_id: provider.id,\n\t\t\t\tnetwork: p.network,\n\t\t\t\tdisplay: opts.display,\n\t\t\t\tcallback: callbackId,\n\t\t\t\tstate: opts.state,\n\t\t\t\tredirect_uri: redirectUri\n\t\t\t}\n\t\t});\n\n\t\t// Get current session for merging scopes, and for quick auth response\n\t\tvar session = utils.store(p.network);\n\n\t\t// Scopes (authentication permisions)\n\t\t// Ensure this is a string - IE has a problem moving Arrays between windows\n\t\t// Append the setup scope\n\t\tvar SCOPE_SPLIT = /[,\\s]+/;\n\n\t\t// Include default scope settings (cloned).\n\t\tvar scope = _this.settings.scope ? [_this.settings.scope.toString()] : [];\n\n\t\t// Extend the providers scope list with the default\n\t\tvar scopeMap = utils.merge(_this.settings.scope_map, provider.scope || {});\n\n\t\t// Add user defined scopes...\n\t\tif (opts.scope) {\n\t\t\tscope.push(opts.scope.toString());\n\t\t}\n\n\t\t// Append scopes from a previous session.\n\t\t// This helps keep app credentials constant,\n\t\t// Avoiding having to keep tabs on what scopes are authorized\n\t\tif (session && 'scope' in session && session.scope instanceof String) {\n\t\t\tscope.push(session.scope);\n\t\t}\n\n\t\t// Join and Split again\n\t\tscope = scope.join(',').split(SCOPE_SPLIT);\n\n\t\t// Format remove duplicates and empty values\n\t\tscope = utils.unique(scope).filter(filterEmpty);\n\n\t\t// Save the the scopes to the state with the names that they were requested with.\n\t\tp.qs.state.scope = scope.join(',');\n\n\t\t// Map scopes to the providers naming convention\n\t\tscope = scope.map(function(item) {\n\t\t\t// Does this have a mapping?\n\t\t\treturn (item in scopeMap) ? scopeMap[item] : item;\n\t\t});\n\n\t\t// Stringify and Arrayify so that double mapped scopes are given the chance to be formatted\n\t\tscope = scope.join(',').split(SCOPE_SPLIT);\n\n\t\t// Again...\n\t\t// Format remove duplicates and empty values\n\t\tscope = utils.unique(scope).filter(filterEmpty);\n\n\t\t// Join with the expected scope delimiter into a string\n\t\tp.qs.scope = scope.join(provider.scope_delim || ',');\n\n\t\t// Is the user already signed in with the appropriate scopes, valid access_token?\n\t\tif (opts.force === false) {\n\n\t\t\tif (session && 'access_token' in session && session.access_token && 'expires' in session && session.expires > ((new Date()).getTime() / 1e3)) {\n\t\t\t\t// What is different about the scopes in the session vs the scopes in the new login?\n\t\t\t\tvar diff = utils.diff((session.scope || '').split(SCOPE_SPLIT), (p.qs.state.scope || '').split(SCOPE_SPLIT));\n\t\t\t\tif (diff.length === 0) {\n\n\t\t\t\t\t// OK trigger the callback\n\t\t\t\t\tpromise.fulfill({\n\t\t\t\t\t\tunchanged: true,\n\t\t\t\t\t\tnetwork: p.network,\n\t\t\t\t\t\tauthResponse: session\n\t\t\t\t\t});\n\n\t\t\t\t\t// Nothing has changed\n\t\t\t\t\treturn promise;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Page URL\n\t\tif (opts.display === 'page' && opts.page_uri) {\n\t\t\t// Add a page location, place to endup after session has authenticated\n\t\t\tp.qs.state.page_uri = utils.url(opts.page_uri).href;\n\t\t}\n\n\t\t// Bespoke\n\t\t// Override login querystrings from auth_options\n\t\tif ('login' in provider && typeof (provider.login) === 'function') {\n\t\t\t// Format the paramaters according to the providers formatting function\n\t\t\tprovider.login(p);\n\t\t}\n\n\t\t// Add OAuth to state\n\t\t// Where the service is going to take advantage of the oauth_proxy\n\t\tif (!/\\btoken\\b/.test(responseType) ||\n\t\tparseInt(provider.oauth.version, 10) < 2 ||\n\t\t(opts.display === 'none' && provider.oauth.grant && session && session.refresh_token)) {\n\n\t\t\t// Add the oauth endpoints\n\t\t\tp.qs.state.oauth = provider.oauth;\n\n\t\t\t// Add the proxy url\n\t\t\tp.qs.state.oauth_proxy = opts.oauth_proxy;\n\n\t\t}\n\n\t\t// Convert state to a string\n\t\tp.qs.state = encodeURIComponent(JSON.stringify(p.qs.state));\n\n\t\t// URL\n\t\tif (parseInt(provider.oauth.version, 10) === 1) {\n\n\t\t\t// Turn the request to the OAuth Proxy for 3-legged auth\n\t\t\turl = utils.qs(opts.oauth_proxy, p.qs, encodeFunction);\n\t\t}\n\n\t\t// Refresh token\n\t\telse if (opts.display === 'none' && provider.oauth.grant && session && session.refresh_token) {\n\n\t\t\t// Add the refresh_token to the request\n\t\t\tp.qs.refresh_token = session.refresh_token;\n\n\t\t\t// Define the request path\n\t\t\turl = utils.qs(opts.oauth_proxy, p.qs, encodeFunction);\n\t\t}\n\t\telse {\n\t\t\turl = utils.qs(provider.oauth.auth, p.qs, encodeFunction);\n\t\t}\n\n\t\t// Broadcast this event as an auth:init\n\t\temit('auth.init', p);\n\n\t\t// Execute\n\t\t// Trigger how we want self displayed\n\t\tif (opts.display === 'none') {\n\t\t\t// Sign-in in the background, iframe\n\t\t\tutils.iframe(url, redirectUri);\n\t\t}\n\n\t\t// Triggering popup?\n\t\telse if (opts.display === 'popup') {\n\n\t\t\tvar popup = utils.popup(url, redirectUri, opts.popup);\n\n\t\t\tvar timer = setInterval(function() {\n\t\t\t\tif (!popup || popup.closed) {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\tif (!promise.state) {\n\n\t\t\t\t\t\tvar response = error('cancelled', 'Login has been cancelled');\n\n\t\t\t\t\t\tif (!popup) {\n\t\t\t\t\t\t\tresponse = error('blocked', 'Popup was blocked');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresponse.network = p.network;\n\n\t\t\t\t\t\tpromise.reject(response);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\telse {\n\t\t\twindow.location = url;\n\t\t}\n\n\t\treturn promise.proxy;\n\n\t\tfunction encodeFunction(s) {return s;}\n\n\t\tfunction filterEmpty(s) {return !!s;}\n\t},\n\n\t// Remove any data associated with a given service\n\t// @param string name of the service\n\t// @param function callback\n\tlogout: function() {\n\n\t\tvar _this = this;\n\t\tvar utils = _this.utils;\n\t\tvar error = utils.error;\n\n\t\t// Create a new promise\n\t\tvar promise = utils.Promise();\n\n\t\tvar p = utils.args({name:'s', options: 'o', callback: 'f'}, arguments);\n\n\t\tp.options = p.options || {};\n\n\t\t// Add callback to events\n\t\tpromise.proxy.then(p.callback, p.callback);\n\n\t\t// Trigger an event on the global listener\n\t\tfunction emit(s, value) {\n\t\t\thello.emit(s, value);\n\t\t}\n\n\t\tpromise.proxy.then(emit.bind(this, 'auth.logout auth'), emit.bind(this, 'error'));\n\n\t\t// Network\n\t\tp.name = p.name || this.settings.default_service;\n\t\tp.authResponse = utils.store(p.name);\n\n\t\tif (p.name && !(p.name in _this.services)) {\n\n\t\t\tpromise.reject(error('invalid_network', 'The network was unrecognized'));\n\n\t\t}\n\t\telse if (p.name && p.authResponse) {\n\n\t\t\t// Define the callback\n\t\t\tvar callback = function(opts) {\n\n\t\t\t\t// Remove from the store\n\t\t\t\tutils.store(p.name, null);\n\n\t\t\t\t// Emit events by default\n\t\t\t\tpromise.fulfill(hello.utils.merge({network:p.name}, opts || {}));\n\t\t\t};\n\n\t\t\t// Run an async operation to remove the users session\n\t\t\tvar _opts = {};\n\t\t\tif (p.options.force) {\n\t\t\t\tvar logout = _this.services[p.name].logout;\n\t\t\t\tif (logout) {\n\t\t\t\t\t// Convert logout to URL string,\n\t\t\t\t\t// If no string is returned, then this function will handle the logout async style\n\t\t\t\t\tif (typeof (logout) === 'function') {\n\t\t\t\t\t\tlogout = logout(callback, p);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If logout is a string then assume URL and open in iframe.\n\t\t\t\t\tif (typeof (logout) === 'string') {\n\t\t\t\t\t\tutils.iframe(logout);\n\t\t\t\t\t\t_opts.force = null;\n\t\t\t\t\t\t_opts.message = 'Logout success on providers site was indeterminate';\n\t\t\t\t\t}\n\t\t\t\t\telse if (logout === undefined) {\n\t\t\t\t\t\t// The callback function will handle the response.\n\t\t\t\t\t\treturn promise.proxy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove local credentials\n\t\t\tcallback(_opts);\n\t\t}\n\t\telse {\n\t\t\tpromise.reject(error('invalid_session', 'There was no session to remove'));\n\t\t}\n\n\t\treturn promise.proxy;\n\t},\n\n\t// Returns all the sessions that are subscribed too\n\t// @param string optional, name of the service to get information about.\n\tgetAuthResponse: function(service) {\n\n\t\t// If the service doesn't exist\n\t\tservice = service || this.settings.default_service;\n\n\t\tif (!service || !(service in this.services)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.utils.store(service) || null;\n\t},\n\n\t// Events: placeholder for the events\n\tevents: {}\n});\n\n// Core utilities\nhello.utils.extend(hello.utils, {\n\n\t// Error\n\terror: function(code, message) {\n\t\treturn {\n\t\t\terror: {\n\t\t\t\tcode: code,\n\t\t\t\tmessage: message\n\t\t\t}\n\t\t};\n\t},\n\n\t// Append the querystring to a url\n\t// @param string url\n\t// @param object parameters\n\tqs: function(url, params, formatFunction) {\n\n\t\tif (params) {\n\n\t\t\t// Set default formatting function\n\t\t\tformatFunction = formatFunction || encodeURIComponent;\n\n\t\t\t// Override the items in the URL which already exist\n\t\t\tfor (var x in params) {\n\t\t\t\tvar str = '([\\\\?\\\\&])' + x + '=[^\\\\&]*';\n\t\t\t\tvar reg = new RegExp(str);\n\t\t\t\tif (url.match(reg)) {\n\t\t\t\t\turl = url.replace(reg, '$1' + x + '=' + formatFunction(params[x]));\n\t\t\t\t\tdelete params[x];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.isEmpty(params)) {\n\t\t\treturn url + (url.indexOf('?') > -1 ? '&' : '?') + this.param(params, formatFunction);\n\t\t}\n\n\t\treturn url;\n\t},\n\n\t// Param\n\t// Explode/encode the parameters of an URL string/object\n\t// @param string s, string to decode\n\tparam: function(s, formatFunction) {\n\t\tvar b;\n\t\tvar a = {};\n\t\tvar m;\n\n\t\tif (typeof (s) === 'string') {\n\n\t\t\tformatFunction = formatFunction || decodeURIComponent;\n\n\t\t\tm = s.replace(/^[\\#\\?]/, '').match(/([^=\\/\\&]+)=([^\\&]+)/g);\n\t\t\tif (m) {\n\t\t\t\tfor (var i = 0; i < m.length; i++) {\n\t\t\t\t\tb = m[i].match(/([^=]+)=(.*)/);\n\t\t\t\t\ta[b[1]] = formatFunction(b[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn a;\n\t\t}\n\t\telse {\n\n\t\t\tformatFunction = formatFunction || encodeURIComponent;\n\n\t\t\tvar o = s;\n\n\t\t\ta = [];\n\n\t\t\tfor (var x in o) {if (o.hasOwnProperty(x)) {\n\t\t\t\tif (o.hasOwnProperty(x)) {\n\t\t\t\t\ta.push([x, o[x] === '?' ? '?' : formatFunction(o[x])].join('='));\n\t\t\t\t}\n\t\t\t}}\n\n\t\t\treturn a.join('&');\n\t\t}\n\t},\n\n\t// Local storage facade\n\tstore: (function() {\n\n\t\tvar a = ['localStorage', 'sessionStorage'];\n\t\tvar i = -1;\n\t\tvar prefix = 'test';\n\n\t\t// Set LocalStorage\n\t\tvar localStorage;\n\n\t\twhile (a[++i]) {\n\t\t\ttry {\n\t\t\t\t// In Chrome with cookies blocked, calling localStorage throws an error\n\t\t\t\tlocalStorage = window[a[i]];\n\t\t\t\tlocalStorage.setItem(prefix + i, i);\n\t\t\t\tlocalStorage.removeItem(prefix + i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlocalStorage = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!localStorage) {\n\n\t\t\tvar cache = null;\n\n\t\t\tlocalStorage = {\n\t\t\t\tgetItem: function(prop) {\n\t\t\t\t\tprop = prop + '=';\n\t\t\t\t\tvar m = document.cookie.split(';');\n\t\t\t\t\tfor (var i = 0; i < m.length; i++) {\n\t\t\t\t\t\tvar _m = m[i].replace(/(^\\s+|\\s+$)/, '');\n\t\t\t\t\t\tif (_m && _m.indexOf(prop) === 0) {\n\t\t\t\t\t\t\treturn _m.substr(prop.length);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn cache;\n\t\t\t\t},\n\n\t\t\t\tsetItem: function(prop, value) {\n\t\t\t\t\tcache = value;\n\t\t\t\t\tdocument.cookie = prop + '=' + value;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Fill the cache up\n\t\t\tcache = localStorage.getItem('hello');\n\t\t}\n\n\t\tfunction get() {\n\t\t\tvar json = {};\n\t\t\ttry {\n\t\t\t\tjson = JSON.parse(localStorage.getItem('hello')) || {};\n\t\t\t}\n\t\t\tcatch (e) {}\n\n\t\t\treturn json;\n\t\t}\n\n\t\tfunction set(json) {\n\t\t\tlocalStorage.setItem('hello', JSON.stringify(json));\n\t\t}\n\n\t\t// Check if the browser support local storage\n\t\treturn function(name, value, days) {\n\n\t\t\t// Local storage\n\t\t\tvar json = get();\n\n\t\t\tif (name && value === undefined) {\n\t\t\t\treturn json[name] || null;\n\t\t\t}\n\t\t\telse if (name && value === null) {\n\t\t\t\ttry {\n\t\t\t\t\tdelete json[name];\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tjson[name] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (name) {\n\t\t\t\tjson[name] = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn json;\n\t\t\t}\n\n\t\t\tset(json);\n\n\t\t\treturn json || null;\n\t\t};\n\n\t})(),\n\n\t// Create and Append new DOM elements\n\t// @param node string\n\t// @param attr object literal\n\t// @param dom/string\n\tappend: function(node, attr, target) {\n\n\t\tvar n = typeof (node) === 'string' ? document.createElement(node) : node;\n\n\t\tif (typeof (attr) === 'object') {\n\t\t\tif ('tagName' in attr) {\n\t\t\t\ttarget = attr;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (var x in attr) {if (attr.hasOwnProperty(x)) {\n\t\t\t\t\tif (typeof (attr[x]) === 'object') {\n\t\t\t\t\t\tfor (var y in attr[x]) {if (attr[x].hasOwnProperty(y)) {\n\t\t\t\t\t\t\tn[x][y] = attr[x][y];\n\t\t\t\t\t\t}}\n\t\t\t\t\t}\n\t\t\t\t\telse if (x === 'html') {\n\t\t\t\t\t\tn.innerHTML = attr[x];\n\t\t\t\t\t}\n\n\t\t\t\t\t// IE doesn't like us setting methods with setAttribute\n\t\t\t\t\telse if (!/^on/.test(x)) {\n\t\t\t\t\t\tn.setAttribute(x, attr[x]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tn[x] = attr[x];\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t}\n\t\t}\n\n\t\tif (target === 'body') {\n\t\t\t(function self() {\n\t\t\t\tif (document.body) {\n\t\t\t\t\tdocument.body.appendChild(n);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsetTimeout(self, 16);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\telse if (typeof (target) === 'object') {\n\t\t\ttarget.appendChild(n);\n\t\t}\n\t\telse if (typeof (target) === 'string') {\n\t\t\tdocument.getElementsByTagName(target)[0].appendChild(n);\n\t\t}\n\n\t\treturn n;\n\t},\n\n\t// An easy way to create a hidden iframe\n\t// @param string src\n\tiframe: function(src) {\n\t\tthis.append('iframe', {src: src, style: {position:'absolute', left: '-1000px', bottom: 0, height: '1px', width: '1px'}}, 'body');\n\t},\n\n\t// Recursive merge two objects into one, second parameter overides the first\n\t// @param a array\n\tmerge: function(/* Args: a, b, c, .. n */) {\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\targs.unshift({});\n\t\treturn this.extend.apply(null, args);\n\t},\n\n\t// Makes it easier to assign parameters, where some are optional\n\t// @param o object\n\t// @param a arguments\n\targs: function(o, args) {\n\n\t\tvar p = {};\n\t\tvar i = 0;\n\t\tvar t = null;\n\t\tvar x = null;\n\n\t\t// 'x' is the first key in the list of object parameters\n\t\tfor (x in o) {if (o.hasOwnProperty(x)) {\n\t\t\tbreak;\n\t\t}}\n\n\t\t// Passing in hash object of arguments?\n\t\t// Where the first argument can't be an object\n\t\tif ((args.length === 1) && (typeof (args[0]) === 'object') && o[x] != 'o!') {\n\n\t\t\t// Could this object still belong to a property?\n\t\t\t// Check the object keys if they match any of the property keys\n\t\t\tfor (x in args[0]) {if (o.hasOwnProperty(x)) {\n\t\t\t\t// Does this key exist in the property list?\n\t\t\t\tif (x in o) {\n\t\t\t\t\t// Yes this key does exist so its most likely this function has been invoked with an object parameter\n\t\t\t\t\t// Return first argument as the hash of all arguments\n\t\t\t\t\treturn args[0];\n\t\t\t\t}\n\t\t\t}}\n\t\t}\n\n\t\t// Else loop through and account for the missing ones.\n\t\tfor (x in o) {if (o.hasOwnProperty(x)) {\n\n\t\t\tt = typeof (args[i]);\n\n\t\t\tif ((typeof (o[x]) === 'function' && o[x].test(args[i])) || (typeof (o[x]) === 'string' && (\n\t\t\t(o[x].indexOf('s') > -1 && t === 'string') ||\n\t\t\t(o[x].indexOf('o') > -1 && t === 'object') ||\n\t\t\t(o[x].indexOf('i') > -1 && t === 'number') ||\n\t\t\t(o[x].indexOf('a') > -1 && t === 'object') ||\n\t\t\t(o[x].indexOf('f') > -1 && t === 'function')\n\t\t\t))\n\t\t\t) {\n\t\t\t\tp[x] = args[i++];\n\t\t\t}\n\n\t\t\telse if (typeof (o[x]) === 'string' && o[x].indexOf('!') > -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}}\n\n\t\treturn p;\n\t},\n\n\t// Returns a URL instance\n\turl: function(path) {\n\n\t\t// If the path is empty\n\t\tif (!path) {\n\t\t\treturn window.location;\n\t\t}\n\n\t\t// Chrome and FireFox support new URL() to extract URL objects\n\t\telse if (window.URL && URL instanceof Function && URL.length !== 0) {\n\t\t\treturn new URL(path, window.location);\n\t\t}\n\n\t\t// Ugly shim, it works!\n\t\telse {\n\t\t\tvar a = document.createElement('a');\n\t\t\ta.href = path;\n\t\t\treturn a.cloneNode(false);\n\t\t}\n\t},\n\n\tdiff: function(a, b) {\n\t\treturn b.filter(function(item) {\n\t\t\treturn a.indexOf(item) === -1;\n\t\t});\n\t},\n\n\t// Get the different hash of properties unique to `a`, and not in `b`\n\tdiffKey: function(a, b) {\n\t\tif (a || !b) {\n\t\t\tvar r = {};\n\t\t\tfor (var x in a) {\n\t\t\t\t// Does the property not exist?\n\t\t\t\tif (!(x in b)) {\n\t\t\t\t\tr[x] = a[x];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn r;\n\t\t}\n\n\t\treturn a;\n\t},\n\n\t// Unique\n\t// Remove duplicate and null values from an array\n\t// @param a array\n\tunique: function(a) {\n\t\tif (!Array.isArray(a)) { return []; }\n\n\t\treturn a.filter(function(item, index) {\n\t\t\t// Is this the first location of item\n\t\t\treturn a.indexOf(item) === index;\n\t\t});\n\t},\n\n\tisEmpty: function(obj) {\n\n\t\t// Scalar\n\t\tif (!obj)\n\t\t\treturn true;\n\n\t\t// Array\n\t\tif (Array.isArray(obj)) {\n\t\t\treturn !obj.length;\n\t\t}\n\t\telse if (typeof (obj) === 'object') {\n\t\t\t// Object\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t//jscs:disable\n\n\t/*!\n\t **  Thenable -- Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable\n\t **  Copyright (c) 2013-2014 Ralf S. Engelschall <http://engelschall.com>\n\t **  Licensed under The MIT License <http://opensource.org/licenses/MIT>\n\t **  Source-Code distributed on <http://github.com/rse/thenable>\n\t */\n\tPromise: (function(){\n\t\t/*  promise states [Promises/A+ 2.1]  */\n\t\tvar STATE_PENDING   = 0;                                         /*  [Promises/A+ 2.1.1]  */\n\t\tvar STATE_FULFILLED = 1;                                         /*  [Promises/A+ 2.1.2]  */\n\t\tvar STATE_REJECTED  = 2;                                         /*  [Promises/A+ 2.1.3]  */\n\n\t\t/*  promise object constructor  */\n\t\tvar api = function (executor) {\n\t\t\t/*  optionally support non-constructor/plain-function call  */\n\t\t\tif (!(this instanceof api))\n\t\t\t\treturn new api(executor);\n\n\t\t\t/*  initialize object  */\n\t\t\tthis.id           = \"Thenable/1.0.6\";\n\t\t\tthis.state        = STATE_PENDING; /*  initial state  */\n\t\t\tthis.fulfillValue = undefined;     /*  initial value  */     /*  [Promises/A+ 1.3, 2.1.2.2]  */\n\t\t\tthis.rejectReason = undefined;     /*  initial reason */     /*  [Promises/A+ 1.5, 2.1.3.2]  */\n\t\t\tthis.onFulfilled  = [];            /*  initial handlers  */\n\t\t\tthis.onRejected   = [];            /*  initial handlers  */\n\n\t\t\t/*  provide optional information-hiding proxy  */\n\t\t\tthis.proxy = {\n\t\t\t\tthen: this.then.bind(this)\n\t\t\t};\n\n\t\t\t/*  support optional executor function  */\n\t\t\tif (typeof executor === \"function\")\n\t\t\t\texecutor.call(this, this.fulfill.bind(this), this.reject.bind(this));\n\t\t};\n\n\t\t/*  promise API methods  */\n\t\tapi.prototype = {\n\t\t\t/*  promise resolving methods  */\n\t\t\tfulfill: function (value) { return deliver(this, STATE_FULFILLED, \"fulfillValue\", value); },\n\t\t\treject:  function (value) { return deliver(this, STATE_REJECTED,  \"rejectReason\", value); },\n\n\t\t\t/*  \"The then Method\" [Promises/A+ 1.1, 1.2, 2.2]  */\n\t\t\tthen: function (onFulfilled, onRejected) {\n\t\t\t\tvar curr = this;\n\t\t\t\tvar next = new api();                                    /*  [Promises/A+ 2.2.7]  */\n\t\t\t\tcurr.onFulfilled.push(\n\t\t\t\t\tresolver(onFulfilled, next, \"fulfill\"));             /*  [Promises/A+ 2.2.2/2.2.6]  */\n\t\t\t\tcurr.onRejected.push(\n\t\t\t\t\tresolver(onRejected,  next, \"reject\" ));             /*  [Promises/A+ 2.2.3/2.2.6]  */\n\t\t\t\texecute(curr);\n\t\t\t\treturn next.proxy;                                       /*  [Promises/A+ 2.2.7, 3.3]  */\n\t\t\t}\n\t\t};\n\n\t\t/*  deliver an action  */\n\t\tvar deliver = function (curr, state, name, value) {\n\t\t\tif (curr.state === STATE_PENDING) {\n\t\t\t\tcurr.state = state;                                      /*  [Promises/A+ 2.1.2.1, 2.1.3.1]  */\n\t\t\t\tcurr[name] = value;                                      /*  [Promises/A+ 2.1.2.2, 2.1.3.2]  */\n\t\t\t\texecute(curr);\n\t\t\t}\n\t\t\treturn curr;\n\t\t};\n\n\t\t/*  execute all handlers  */\n\t\tvar execute = function (curr) {\n\t\t\tif (curr.state === STATE_FULFILLED)\n\t\t\t\texecute_handlers(curr, \"onFulfilled\", curr.fulfillValue);\n\t\t\telse if (curr.state === STATE_REJECTED)\n\t\t\t\texecute_handlers(curr, \"onRejected\",  curr.rejectReason);\n\t\t};\n\n\t\t/*  execute particular set of handlers  */\n\t\tvar execute_handlers = function (curr, name, value) {\n\t\t\t/* global process: true */\n\t\t\t/* global setImmediate: true */\n\t\t\t/* global setTimeout: true */\n\n\t\t\t/*  short-circuit processing  */\n\t\t\tif (curr[name].length === 0)\n\t\t\t\treturn;\n\n\t\t\t/*  iterate over all handlers, exactly once  */\n\t\t\tvar handlers = curr[name];\n\t\t\tcurr[name] = [];                                             /*  [Promises/A+ 2.2.2.3, 2.2.3.3]  */\n\t\t\tvar func = function () {\n\t\t\t\tfor (var i = 0; i < handlers.length; i++)\n\t\t\t\t\thandlers[i](value);                                  /*  [Promises/A+ 2.2.5]  */\n\t\t\t};\n\n\t\t\t/*  execute procedure asynchronously  */                     /*  [Promises/A+ 2.2.4, 3.1]  */\n\t\t\tif (typeof process === \"object\" && typeof process.nextTick === \"function\")\n\t\t\t\tprocess.nextTick(func);\n\t\t\telse if (typeof setImmediate === \"function\")\n\t\t\t\tsetImmediate(func);\n\t\t\telse\n\t\t\t\tsetTimeout(func, 0);\n\t\t};\n\n\t\t/*  generate a resolver function  */\n\t\tvar resolver = function (cb, next, method) {\n\t\t\treturn function (value) {\n\t\t\t\tif (typeof cb !== \"function\")                            /*  [Promises/A+ 2.2.1, 2.2.7.3, 2.2.7.4]  */\n\t\t\t\t\tnext[method].call(next, value);                      /*  [Promises/A+ 2.2.7.3, 2.2.7.4]  */\n\t\t\t\telse {\n\t\t\t\t\tvar result;\n\t\t\t\t\ttry { result = cb(value); }                          /*  [Promises/A+ 2.2.2.1, 2.2.3.1, 2.2.5, 3.2]  */\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\tnext.reject(e);                                  /*  [Promises/A+ 2.2.7.2]  */\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tresolve(next, result);                               /*  [Promises/A+ 2.2.7.1]  */\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\t/*  \"Promise Resolution Procedure\"  */                           /*  [Promises/A+ 2.3]  */\n\t\tvar resolve = function (promise, x) {\n\t\t\t/*  sanity check arguments  */                               /*  [Promises/A+ 2.3.1]  */\n\t\t\tif (promise === x || promise.proxy === x) {\n\t\t\t\tpromise.reject(new TypeError(\"cannot resolve promise with itself\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/*  surgically check for a \"then\" method\n\t\t\t\t(mainly to just call the \"getter\" of \"then\" only once)  */\n\t\t\tvar then;\n\t\t\tif ((typeof x === \"object\" && x !== null) || typeof x === \"function\") {\n\t\t\t\ttry { then = x.then; }                                   /*  [Promises/A+ 2.3.3.1, 3.5]  */\n\t\t\t\tcatch (e) {\n\t\t\t\t\tpromise.reject(e);                                   /*  [Promises/A+ 2.3.3.2]  */\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*  handle own Thenables    [Promises/A+ 2.3.2]\n\t\t\t\tand similar \"thenables\" [Promises/A+ 2.3.3]  */\n\t\t\tif (typeof then === \"function\") {\n\t\t\t\tvar resolved = false;\n\t\t\t\ttry {\n\t\t\t\t\t/*  call retrieved \"then\" method */                  /*  [Promises/A+ 2.3.3.3]  */\n\t\t\t\t\tthen.call(x,\n\t\t\t\t\t\t/*  resolvePromise  */                           /*  [Promises/A+ 2.3.3.3.1]  */\n\t\t\t\t\t\tfunction (y) {\n\t\t\t\t\t\t\tif (resolved) return; resolved = true;       /*  [Promises/A+ 2.3.3.3.3]  */\n\t\t\t\t\t\t\tif (y === x)                                 /*  [Promises/A+ 3.6]  */\n\t\t\t\t\t\t\t\tpromise.reject(new TypeError(\"circular thenable chain\"));\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tresolve(promise, y);\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t/*  rejectPromise  */                            /*  [Promises/A+ 2.3.3.3.2]  */\n\t\t\t\t\t\tfunction (r) {\n\t\t\t\t\t\t\tif (resolved) return; resolved = true;       /*  [Promises/A+ 2.3.3.3.3]  */\n\t\t\t\t\t\t\tpromise.reject(r);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tif (!resolved)                                       /*  [Promises/A+ 2.3.3.3.3]  */\n\t\t\t\t\t\tpromise.reject(e);                               /*  [Promises/A+ 2.3.3.3.4]  */\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/*  handle other values  */\n\t\t\tpromise.fulfill(x);                                          /*  [Promises/A+ 2.3.4, 2.3.3.4]  */\n\t\t};\n\n\t\t/*  export API  */\n\t\treturn api;\n\t})(),\n\n\t//jscs:enable\n\n\t// Event\n\t// A contructor superclass for adding event menthods, on, off, emit.\n\tEvent: function() {\n\n\t\tvar separator = /[\\s\\,]+/;\n\n\t\t// If this doesn't support getPrototype then we can't get prototype.events of the parent\n\t\t// So lets get the current instance events, and add those to a parent property\n\t\tthis.parent = {\n\t\t\tevents: this.events,\n\t\t\tfindEvents: this.findEvents,\n\t\t\tparent: this.parent,\n\t\t\tutils: this.utils\n\t\t};\n\n\t\tthis.events = {};\n\n\t\t// On, subscribe to events\n\t\t// @param evt   string\n\t\t// @param callback  function\n\t\tthis.on = function(evt, callback) {\n\n\t\t\tif (callback && typeof (callback) === 'function') {\n\t\t\t\tvar a = evt.split(separator);\n\t\t\t\tfor (var i = 0; i < a.length; i++) {\n\n\t\t\t\t\t// Has this event already been fired on this instance?\n\t\t\t\t\tthis.events[a[i]] = [callback].concat(this.events[a[i]] || []);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\n\t\t// Off, unsubscribe to events\n\t\t// @param evt   string\n\t\t// @param callback  function\n\t\tthis.off = function(evt, callback) {\n\n\t\t\tthis.findEvents(evt, function(name, index) {\n\t\t\t\tif (!callback || this.events[name][index] === callback) {\n\t\t\t\t\tthis.events[name][index] = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn this;\n\t\t};\n\n\t\t// Emit\n\t\t// Triggers any subscribed events\n\t\tthis.emit = function(evt /*, data, ... */) {\n\n\t\t\t// Get arguments as an Array, knock off the first one\n\t\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\targs.push(evt);\n\n\t\t\t// Handler\n\t\t\tvar handler = function(name, index) {\n\n\t\t\t\t// Replace the last property with the event name\n\t\t\t\targs[args.length - 1] = (name === '*' ? evt : name);\n\n\t\t\t\t// Trigger\n\t\t\t\tthis.events[name][index].apply(this, args);\n\t\t\t};\n\n\t\t\t// Find the callbacks which match the condition and call\n\t\t\tvar _this = this;\n\t\t\twhile (_this && _this.findEvents) {\n\n\t\t\t\t// Find events which match\n\t\t\t\t_this.findEvents(evt + ',*', handler);\n\t\t\t\t_this = _this.parent;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\n\t\t//\n\t\t// Easy functions\n\t\tthis.emitAfter = function() {\n\t\t\tvar _this = this;\n\t\t\tvar args = arguments;\n\t\t\tsetTimeout(function() {\n\t\t\t\t_this.emit.apply(_this, args);\n\t\t\t}, 0);\n\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.findEvents = function(evt, callback) {\n\n\t\t\tvar a = evt.split(separator);\n\n\t\t\tfor (var name in this.events) {if (this.events.hasOwnProperty(name)) {\n\n\t\t\t\tif (a.indexOf(name) > -1) {\n\n\t\t\t\t\tfor (var i = 0; i < this.events[name].length; i++) {\n\n\t\t\t\t\t\t// Does the event handler exist?\n\t\t\t\t\t\tif (this.events[name][i]) {\n\t\t\t\t\t\t\t// Emit on the local instance of this\n\t\t\t\t\t\t\tcallback.call(this, name, i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}}\n\t\t};\n\n\t\treturn this;\n\t},\n\n\t// Global Events\n\t// Attach the callback to the window object\n\t// Return its unique reference\n\tglobalEvent: function(callback, guid) {\n\t\t// If the guid has not been supplied then create a new one.\n\t\tguid = guid || '_hellojs_' + parseInt(Math.random() * 1e12, 10).toString(36);\n\n\t\t// Define the callback function\n\t\twindow[guid] = function() {\n\t\t\t// Trigger the callback\n\t\t\ttry {\n\t\t\t\tif (callback.apply(this, arguments)) {\n\t\t\t\t\tdelete window[guid];\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t};\n\n\t\treturn guid;\n\t},\n\n\t// Trigger a clientside popup\n\t// This has been augmented to support PhoneGap\n\tpopup: function(url, redirectUri, options) {\n\n\t\tvar documentElement = document.documentElement;\n\n\t\t// Multi Screen Popup Positioning (http://stackoverflow.com/a/16861050)\n\t\t// Credit: http://www.xtf.dk/2011/08/center-new-popup-window-even-on.html\n\t\t// Fixes dual-screen position                         Most browsers      Firefox\n\n\t\tif (options.height && options.top === undefined) {\n\t\t\tvar dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n\t\t\tvar height = screen.height || window.innerHeight || documentElement.clientHeight;\n\t\t\toptions.top = parseInt((height - options.height) / 2, 10) + dualScreenTop;\n\t\t}\n\n\t\tif (options.width && options.left === undefined) {\n\t\t\tvar dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n\t\t\tvar width = screen.width || window.innerWidth || documentElement.clientWidth;\n\t\t\toptions.left = parseInt((width - options.width) / 2, 10) + dualScreenLeft;\n\t\t}\n\n\t\t// Convert options into an array\n\t\tvar optionsArray = [];\n\t\tObject.keys(options).forEach(function(name) {\n\t\t\tvar value = options[name];\n\t\t\toptionsArray.push(name + (value !== null ? '=' + value : ''));\n\t\t});\n\n\t\t// Call the open() function with the initial path\n\t\t//\n\t\t// OAuth redirect, fixes URI fragments from being lost in Safari\n\t\t// (URI Fragments within 302 Location URI are lost over HTTPS)\n\t\t// Loading the redirect.html before triggering the OAuth Flow seems to fix it.\n\t\t//\n\t\t// Firefox  decodes URL fragments when calling location.hash.\n\t\t//  - This is bad if the value contains break points which are escaped\n\t\t//  - Hence the url must be encoded twice as it contains breakpoints.\n\t\tif (navigator.userAgent.indexOf('Safari') !== -1 && navigator.userAgent.indexOf('Chrome') === -1) {\n\t\t\turl = redirectUri + '#oauth_redirect=' + encodeURIComponent(encodeURIComponent(url));\n\t\t}\n\n\t\tvar popup = window.open(\n\t\t\turl,\n\t\t\t'_blank',\n\t\t\toptionsArray.join(',')\n\t\t);\n\n\t\tif (popup && popup.focus) {\n\t\t\tpopup.focus();\n\t\t}\n\n\t\treturn popup;\n\t},\n\n\t// OAuth and API response handler\n\tresponseHandler: function(window, parent) {\n\n\t\tvar _this = this;\n\t\tvar p;\n\t\tvar location = window.location;\n\n\t\t// Is this an auth relay message which needs to call the proxy?\n\t\tp = _this.param(location.search);\n\n\t\t// OAuth2 or OAuth1 server response?\n\t\tif (p && p.state && (p.code || p.oauth_token)) {\n\n\t\t\tvar state = JSON.parse(p.state);\n\n\t\t\t// Add this path as the redirect_uri\n\t\t\tp.redirect_uri = state.redirect_uri || location.href.replace(/[\\?\\#].*$/, '');\n\n\t\t\t// Redirect to the host\n\t\t\tvar path = _this.qs(state.oauth_proxy, p);\n\n\t\t\tlocation.assign(path);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Save session, from redirected authentication\n\t\t// #access_token has come in?\n\t\t//\n\t\t// FACEBOOK is returning auth errors within as a query_string... thats a stickler for consistency.\n\t\t// SoundCloud is the state in the querystring and the token in the hashtag, so we'll mix the two together\n\n\t\tp = _this.merge(_this.param(location.search || ''), _this.param(location.hash || ''));\n\n\t\t// If p.state\n\t\tif (p && 'state' in p) {\n\n\t\t\t// Remove any addition information\n\t\t\t// E.g. p.state = 'facebook.page';\n\t\t\ttry {\n\t\t\t\tvar a = JSON.parse(p.state);\n\t\t\t\t_this.extend(p, a);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tvar stateDecoded = decodeURIComponent(p.state);\n\t\t\t\ttry {\n\t\t\t\t\tvar b = JSON.parse(stateDecoded);\n\t\t\t\t\t_this.extend(p, b);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tconsole.error('Could not decode state parameter');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Access_token?\n\t\t\tif (('access_token' in p && p.access_token) && p.network) {\n\n\t\t\t\tif (!p.expires_in || parseInt(p.expires_in, 10) === 0) {\n\t\t\t\t\t// If p.expires_in is unset, set to 0\n\t\t\t\t\tp.expires_in = 0;\n\t\t\t\t}\n\n\t\t\t\tp.expires_in = parseInt(p.expires_in, 10);\n\t\t\t\tp.expires = ((new Date()).getTime() / 1e3) + (p.expires_in || (60 * 60 * 24 * 365));\n\n\t\t\t\t// Lets use the \"state\" to assign it to one of our networks\n\t\t\t\tauthCallback(p, window, parent);\n\t\t\t}\n\n\t\t\t// Error=?\n\t\t\t// &error_description=?\n\t\t\t// &state=?\n\t\t\telse if (('error' in p && p.error) && p.network) {\n\n\t\t\t\tp.error = {\n\t\t\t\t\tcode: p.error,\n\t\t\t\t\tmessage: p.error_message || p.error_description\n\t\t\t\t};\n\n\t\t\t\t// Let the state handler handle it\n\t\t\t\tauthCallback(p, window, parent);\n\t\t\t}\n\n\t\t\t// API call, or a cancelled login\n\t\t\t// Result is serialized JSON string\n\t\t\telse if (p.callback && p.callback in parent) {\n\n\t\t\t\t// Trigger a function in the parent\n\t\t\t\tvar res = 'result' in p && p.result ? JSON.parse(p.result) : false;\n\n\t\t\t\t// Trigger the callback on the parent\n\t\t\t\tcallback(parent, p.callback)(res);\n\t\t\t\tcloseWindow();\n\t\t\t}\n\n\t\t\t// If this page is still open\n\t\t\tif (p.page_uri) {\n\t\t\t\tlocation.assign(p.page_uri);\n\t\t\t}\n\t\t}\n\n\t\t// OAuth redirect, fixes URI fragments from being lost in Safari\n\t\t// (URI Fragments within 302 Location URI are lost over HTTPS)\n\t\t// Loading the redirect.html before triggering the OAuth Flow seems to fix it.\n\t\telse if ('oauth_redirect' in p) {\n\n\t\t\tlocation.assign(decodeURIComponent(p.oauth_redirect));\n\t\t\treturn;\n\t\t}\n\n\t\t// Trigger a callback to authenticate\n\t\tfunction authCallback(obj, window, parent) {\n\n\t\t\tvar cb = obj.callback;\n\t\t\tvar network = obj.network;\n\n\t\t\t// Trigger the callback on the parent\n\t\t\t_this.store(network, obj);\n\n\t\t\t// If this is a page request it has no parent or opener window to handle callbacks\n\t\t\tif (('display' in obj) && obj.display === 'page') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove from session object\n\t\t\tif (parent && cb && cb in parent) {\n\n\t\t\t\ttry {\n\t\t\t\t\tdelete obj.callback;\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\n\t\t\t\t// Update store\n\t\t\t\t_this.store(network, obj);\n\n\t\t\t\t// Call the globalEvent function on the parent\n\t\t\t\t// It's safer to pass back a string to the parent,\n\t\t\t\t// Rather than an object/array (better for IE8)\n\t\t\t\tvar str = JSON.stringify(obj);\n\n\t\t\t\ttry {\n\t\t\t\t\tcallback(parent, cb)(str);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\t// Error thrown whilst executing parent callback\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcloseWindow();\n\t\t}\n\n\t\tfunction callback(parent, callbackID) {\n\t\t\tif (callbackID.indexOf('_hellojs_') !== 0) {\n\t\t\t\treturn function() {\n\t\t\t\t\tthrow 'Could not execute callback ' + callbackID;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn parent[callbackID];\n\t\t}\n\n\t\tfunction closeWindow() {\n\n\t\t\tif (window.frameElement) {\n\t\t\t\t// Inside an iframe, remove from parent\n\t\t\t\tparent.document.body.removeChild(window.frameElement);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Close this current window\n\t\t\t\ttry {\n\t\t\t\t\twindow.close();\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\n\t\t\t\t// IOS bug wont let us close a popup if still loading\n\t\t\t\tif (window.addEventListener) {\n\t\t\t\t\twindow.addEventListener('load', function() {\n\t\t\t\t\t\twindow.close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n});\n\n// Events\n// Extend the hello object with its own event instance\nhello.utils.Event.call(hello);\n\n///////////////////////////////////\n// Monitoring session state\n// Check for session changes\n///////////////////////////////////\n\n(function(hello) {\n\n\t// Monitor for a change in state and fire\n\tvar oldSessions = {};\n\n\t// Hash of expired tokens\n\tvar expired = {};\n\n\t// Listen to other triggers to Auth events, use these to update this\n\thello.on('auth.login, auth.logout', function(auth) {\n\t\tif (auth && typeof (auth) === 'object' && auth.network) {\n\t\t\toldSessions[auth.network] = hello.utils.store(auth.network) || {};\n\t\t}\n\t});\n\n\t(function self() {\n\n\t\tvar CURRENT_TIME = ((new Date()).getTime() / 1e3);\n\t\tvar emit = function(eventName) {\n\t\t\thello.emit('auth.' + eventName, {\n\t\t\t\tnetwork: name,\n\t\t\t\tauthResponse: session\n\t\t\t});\n\t\t};\n\n\t\t// Loop through the services\n\t\tfor (var name in hello.services) {if (hello.services.hasOwnProperty(name)) {\n\n\t\t\tif (!hello.services[name].id) {\n\t\t\t\t// We haven't attached an ID so dont listen.\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Get session\n\t\t\tvar session = hello.utils.store(name) || {};\n\t\t\tvar provider = hello.services[name];\n\t\t\tvar oldSess = oldSessions[name] || {};\n\n\t\t\t// Listen for globalEvents that did not get triggered from the child\n\t\t\tif (session && 'callback' in session) {\n\n\t\t\t\t// To do remove from session object...\n\t\t\t\tvar cb = session.callback;\n\t\t\t\ttry {\n\t\t\t\t\tdelete session.callback;\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\n\t\t\t\t// Update store\n\t\t\t\t// Removing the callback\n\t\t\t\thello.utils.store(name, session);\n\n\t\t\t\t// Emit global events\n\t\t\t\ttry {\n\t\t\t\t\twindow[cb](session);\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\t\t\t}\n\n\t\t\t// Refresh token\n\t\t\tif (session && ('expires' in session) && session.expires < CURRENT_TIME) {\n\n\t\t\t\t// If auto refresh is possible\n\t\t\t\t// Either the browser supports\n\t\t\t\tvar refresh = provider.refresh || session.refresh_token;\n\n\t\t\t\t// Has the refresh been run recently?\n\t\t\t\tif (refresh && (!(name in expired) || expired[name] < CURRENT_TIME)) {\n\t\t\t\t\t// Try to resignin\n\t\t\t\t\thello.emit('notice', name + ' has expired trying to resignin');\n\t\t\t\t\thello.login(name, {display: 'none', force: false});\n\n\t\t\t\t\t// Update expired, every 10 minutes\n\t\t\t\t\texpired[name] = CURRENT_TIME + 600;\n\t\t\t\t}\n\n\t\t\t\t// Does this provider not support refresh\n\t\t\t\telse if (!refresh && !(name in expired)) {\n\t\t\t\t\t// Label the event\n\t\t\t\t\temit('expired');\n\t\t\t\t\texpired[name] = true;\n\t\t\t\t}\n\n\t\t\t\t// If session has expired then we dont want to store its value until it can be established that its been updated\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Has session changed?\n\t\t\telse if (oldSess.access_token === session.access_token &&\n\t\t\toldSess.expires === session.expires) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Access_token has been removed\n\t\t\telse if (!session.access_token && oldSess.access_token) {\n\t\t\t\temit('logout');\n\t\t\t}\n\n\t\t\t// Access_token has been created\n\t\t\telse if (session.access_token && !oldSess.access_token) {\n\t\t\t\temit('login');\n\t\t\t}\n\n\t\t\t// Access_token has been updated\n\t\t\telse if (session.expires !== oldSess.expires) {\n\t\t\t\temit('update');\n\t\t\t}\n\n\t\t\t// Updated stored session\n\t\t\toldSessions[name] = session;\n\n\t\t\t// Remove the expired flags\n\t\t\tif (name in expired) {\n\t\t\t\tdelete expired[name];\n\t\t\t}\n\t\t}}\n\n\t\t// Check error events\n\t\tsetTimeout(self, 1000);\n\t})();\n\n})(hello);\n\n// EOF CORE lib\n//////////////////////////////////\n\n/////////////////////////////////////////\n// API\n// @param path    string\n// @param query   object (optional)\n// @param method  string (optional)\n// @param data    object (optional)\n// @param timeout integer (optional)\n// @param callback  function (optional)\n\nhello.api = function() {\n\n\t// Shorthand\n\tvar _this = this;\n\tvar utils = _this.utils;\n\tvar error = utils.error;\n\n\t// Construct a new Promise object\n\tvar promise = utils.Promise();\n\n\t// Arguments\n\tvar p = utils.args({path: 's!', query: 'o', method: 's', data: 'o', timeout: 'i', callback: 'f'}, arguments);\n\n\t// Method\n\tp.method = (p.method || 'get').toLowerCase();\n\n\t// Headers\n\tp.headers = p.headers || {};\n\n\t// Query\n\tp.query = p.query || {};\n\n\t// If get, put all parameters into query\n\tif (p.method === 'get' || p.method === 'delete') {\n\t\tutils.extend(p.query, p.data);\n\t\tp.data = {};\n\t}\n\n\tvar data = p.data = p.data || {};\n\n\t// Completed event callback\n\tpromise.then(p.callback, p.callback);\n\n\t// Remove the network from path, e.g. facebook:/me/friends\n\t// Results in { network : facebook, path : me/friends }\n\tif (!p.path) {\n\t\treturn promise.reject(error('invalid_path', 'Missing the path parameter from the request'));\n\t}\n\n\tp.path = p.path.replace(/^\\/+/, '');\n\tvar a = (p.path.split(/[\\/\\:]/, 2) || [])[0].toLowerCase();\n\n\tif (a in _this.services) {\n\t\tp.network = a;\n\t\tvar reg = new RegExp('^' + a + ':?\\/?');\n\t\tp.path = p.path.replace(reg, '');\n\t}\n\n\t// Network & Provider\n\t// Define the network that this request is made for\n\tp.network = _this.settings.default_service = p.network || _this.settings.default_service;\n\tvar o = _this.services[p.network];\n\n\t// INVALID\n\t// Is there no service by the given network name?\n\tif (!o) {\n\t\treturn promise.reject(error('invalid_network', 'Could not match the service requested: ' + p.network));\n\t}\n\n\t// PATH\n\t// As long as the path isn't flagged as unavaiable, e.g. path == false\n\n\tif (!(!(p.method in o) || !(p.path in o[p.method]) || o[p.method][p.path] !== false)) {\n\t\treturn promise.reject(error('invalid_path', 'The provided path is not available on the selected network'));\n\t}\n\n\t// PROXY\n\t// OAuth1 calls always need a proxy\n\n\tif (!p.oauth_proxy) {\n\t\tp.oauth_proxy = _this.settings.oauth_proxy;\n\t}\n\n\tif (!('proxy' in p)) {\n\t\tp.proxy = p.oauth_proxy && o.oauth && parseInt(o.oauth.version, 10) === 1;\n\t}\n\n\t// TIMEOUT\n\t// Adopt timeout from global settings by default\n\n\tif (!('timeout' in p)) {\n\t\tp.timeout = _this.settings.timeout;\n\t}\n\n\t// Format response\n\t// Whether to run the raw response through post processing.\n\tif (!('formatResponse' in p)) {\n\t\tp.formatResponse = true;\n\t}\n\n\t// Get the current session\n\t// Append the access_token to the query\n\tp.authResponse = _this.getAuthResponse(p.network);\n\tif (p.authResponse && p.authResponse.access_token) {\n\t\tp.query.access_token = p.authResponse.access_token;\n\t}\n\n\tvar url = p.path;\n\tvar m;\n\n\t// Store the query as options\n\t// This is used to populate the request object before the data is augmented by the prewrap handlers.\n\tp.options = utils.clone(p.query);\n\n\t// Clone the data object\n\t// Prevent this script overwriting the data of the incoming object.\n\t// Ensure that everytime we run an iteration the callbacks haven't removed some data\n\tp.data = utils.clone(data);\n\n\t// URL Mapping\n\t// Is there a map for the given URL?\n\tvar actions = o[{'delete': 'del'}[p.method] || p.method] || {};\n\n\t// Extrapolate the QueryString\n\t// Provide a clean path\n\t// Move the querystring into the data\n\tif (p.method === 'get') {\n\n\t\tvar query = url.split(/[\\?#]/)[1];\n\t\tif (query) {\n\t\t\tutils.extend(p.query, utils.param(query));\n\n\t\t\t// Remove the query part from the URL\n\t\t\turl = url.replace(/\\?.*?(#|$)/, '$1');\n\t\t}\n\t}\n\n\t// Is the hash fragment defined\n\tif ((m = url.match(/#(.+)/, ''))) {\n\t\turl = url.split('#')[0];\n\t\tp.path = m[1];\n\t}\n\telse if (url in actions) {\n\t\tp.path = url;\n\t\turl = actions[url];\n\t}\n\telse if ('default' in actions) {\n\t\turl = actions['default'];\n\t}\n\n\t// Redirect Handler\n\t// This defines for the Form+Iframe+Hash hack where to return the results too.\n\tp.redirect_uri = _this.settings.redirect_uri;\n\n\t// Define FormatHandler\n\t// The request can be procesed in a multitude of ways\n\t// Here's the options - depending on the browser and endpoint\n\tp.xhr = o.xhr;\n\tp.jsonp = o.jsonp;\n\tp.form = o.form;\n\n\t// Make request\n\tif (typeof (url) === 'function') {\n\t\t// Does self have its own callback?\n\t\turl(p, getPath);\n\t}\n\telse {\n\t\t// Else the URL is a string\n\t\tgetPath(url);\n\t}\n\n\treturn promise.proxy;\n\n\t// If url needs a base\n\t// Wrap everything in\n\tfunction getPath(url) {\n\n\t\t// Format the string if it needs it\n\t\turl = url.replace(/\\@\\{([a-z\\_\\-]+)(\\|.*?)?\\}/gi, function(m, key, defaults) {\n\t\t\tvar val = defaults ? defaults.replace(/^\\|/, '') : '';\n\t\t\tif (key in p.query) {\n\t\t\t\tval = p.query[key];\n\t\t\t\tdelete p.query[key];\n\t\t\t}\n\t\t\telse if (p.data && key in p.data) {\n\t\t\t\tval = p.data[key];\n\t\t\t\tdelete p.data[key];\n\t\t\t}\n\t\t\telse if (!defaults) {\n\t\t\t\tpromise.reject(error('missing_attribute', 'The attribute ' + key + ' is missing from the request'));\n\t\t\t}\n\n\t\t\treturn val;\n\t\t});\n\n\t\t// Add base\n\t\tif (!url.match(/^https?:\\/\\//)) {\n\t\t\turl = o.base + url;\n\t\t}\n\n\t\t// Define the request URL\n\t\tp.url = url;\n\n\t\t// Make the HTTP request with the curated request object\n\t\t// CALLBACK HANDLER\n\t\t// @ response object\n\t\t// @ statusCode integer if available\n\t\tutils.request(p, function(r, headers) {\n\n\t\t\t// Is this a raw response?\n\t\t\tif (!p.formatResponse) {\n\t\t\t\t// Bad request? error statusCode or otherwise contains an error response vis JSONP?\n\t\t\t\tif (typeof headers === 'object' ? (headers.statusCode >= 400) : (typeof r === 'object' && 'error' in r)) {\n\t\t\t\t\tpromise.reject(r);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tpromise.fulfill(r);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Should this be an object\n\t\t\tif (r === true) {\n\t\t\t\tr = {success:true};\n\t\t\t}\n\t\t\telse if (!r) {\n\t\t\t\tr = {};\n\t\t\t}\n\n\t\t\t// The delete callback needs a better response\n\t\t\tif (p.method === 'delete') {\n\t\t\t\tr = (!r || utils.isEmpty(r)) ? {success:true} : r;\n\t\t\t}\n\n\t\t\t// FORMAT RESPONSE?\n\t\t\t// Does self request have a corresponding formatter\n\t\t\tif (o.wrap && ((p.path in o.wrap) || ('default' in o.wrap))) {\n\t\t\t\tvar wrap = (p.path in o.wrap ? p.path : 'default');\n\t\t\t\tvar time = (new Date()).getTime();\n\n\t\t\t\t// FORMAT RESPONSE\n\t\t\t\tvar b = o.wrap[wrap](r, headers, p);\n\n\t\t\t\t// Has the response been utterly overwritten?\n\t\t\t\t// Typically self augments the existing object.. but for those rare occassions\n\t\t\t\tif (b) {\n\t\t\t\t\tr = b;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is there a next_page defined in the response?\n\t\t\tif (r && 'paging' in r && r.paging.next) {\n\n\t\t\t\t// Add the relative path if it is missing from the paging/next path\n\t\t\t\tif (r.paging.next[0] === '?') {\n\t\t\t\t\tr.paging.next = p.path + r.paging.next;\n\t\t\t\t}\n\n\t\t\t\t// The relative path has been defined, lets markup the handler in the HashFragment\n\t\t\t\telse {\n\t\t\t\t\tr.paging.next += '#' + p.path;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispatch to listeners\n\t\t\t// Emit events which pertain to the formatted response\n\t\t\tif (!r || 'error' in r) {\n\t\t\t\tpromise.reject(r);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpromise.fulfill(r);\n\t\t\t}\n\t\t});\n\t}\n};\n\n// API utilities\nhello.utils.extend(hello.utils, {\n\n\t// Make an HTTP request\n\trequest: function(p, callback) {\n\n\t\tvar _this = this;\n\t\tvar error = _this.error;\n\n\t\t// This has to go through a POST request\n\t\tif (!_this.isEmpty(p.data) && !('FileList' in window) && _this.hasBinary(p.data)) {\n\n\t\t\t// Disable XHR and JSONP\n\t\t\tp.xhr = false;\n\t\t\tp.jsonp = false;\n\t\t}\n\n\t\t// Check if the browser and service support CORS\n\t\tvar cors = this.request_cors(function() {\n\t\t\t// If it does then run this...\n\t\t\treturn ((p.xhr === undefined) || (p.xhr && (typeof (p.xhr) !== 'function' || p.xhr(p, p.query))));\n\t\t});\n\n\t\tif (cors) {\n\n\t\t\tformatUrl(p, function(url) {\n\n\t\t\t\tvar x = _this.xhr(p.method, url, p.headers, p.data, callback);\n\t\t\t\tx.onprogress = p.onprogress || null;\n\n\t\t\t\t// Windows Phone does not support xhr.upload, see #74\n\t\t\t\t// Feature detect\n\t\t\t\tif (x.upload && p.onuploadprogress) {\n\t\t\t\t\tx.upload.onprogress = p.onuploadprogress;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Clone the query object\n\t\t// Each request modifies the query object and needs to be tared after each one.\n\t\tvar _query = p.query;\n\n\t\tp.query = _this.clone(p.query);\n\n\t\t// Assign a new callbackID\n\t\tp.callbackID = _this.globalEvent();\n\n\t\t// JSONP\n\t\tif (p.jsonp !== false) {\n\n\t\t\t// Clone the query object\n\t\t\tp.query.callback = p.callbackID;\n\n\t\t\t// If the JSONP is a function then run it\n\t\t\tif (typeof (p.jsonp) === 'function') {\n\t\t\t\tp.jsonp(p, p.query);\n\t\t\t}\n\n\t\t\t// Lets use JSONP if the method is 'get'\n\t\t\tif (p.method === 'get') {\n\n\t\t\t\tformatUrl(p, function(url) {\n\t\t\t\t\t_this.jsonp(url, callback, p.callbackID, p.timeout);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// It's not compatible reset query\n\t\t\t\tp.query = _query;\n\t\t\t}\n\n\t\t}\n\n\t\t// Otherwise we're on to the old school, iframe hacks and JSONP\n\t\tif (p.form !== false) {\n\n\t\t\t// Add some additional query parameters to the URL\n\t\t\t// We're pretty stuffed if the endpoint doesn't like these\n\t\t\tp.query.redirect_uri = p.redirect_uri;\n\t\t\tp.query.state = JSON.stringify({callback:p.callbackID});\n\n\t\t\tvar opts;\n\n\t\t\tif (typeof (p.form) === 'function') {\n\n\t\t\t\t// Format the request\n\t\t\t\topts = p.form(p, p.query);\n\t\t\t}\n\n\t\t\tif (p.method === 'post' && opts !== false) {\n\n\t\t\t\tformatUrl(p, function(url) {\n\t\t\t\t\t_this.post(url, p.data, opts, callback, p.callbackID, p.timeout);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// None of the methods were successful throw an error\n\t\tcallback(error('invalid_request', 'There was no mechanism for handling this request'));\n\n\t\treturn;\n\n\t\t// Format URL\n\t\t// Constructs the request URL, optionally wraps the URL through a call to a proxy server\n\t\t// Returns the formatted URL\n\t\tfunction formatUrl(p, callback) {\n\n\t\t\t// Are we signing the request?\n\t\t\tvar sign;\n\n\t\t\t// OAuth1\n\t\t\t// Remove the token from the query before signing\n\t\t\tif (p.authResponse && p.authResponse.oauth && parseInt(p.authResponse.oauth.version, 10) === 1) {\n\n\t\t\t\t// OAUTH SIGNING PROXY\n\t\t\t\tsign = p.query.access_token;\n\n\t\t\t\t// Remove the access_token\n\t\t\t\tdelete p.query.access_token;\n\n\t\t\t\t// Enfore use of Proxy\n\t\t\t\tp.proxy = true;\n\t\t\t}\n\n\t\t\t// POST body to querystring\n\t\t\tif (p.data && (p.method === 'get' || p.method === 'delete')) {\n\t\t\t\t// Attach the p.data to the querystring.\n\t\t\t\t_this.extend(p.query, p.data);\n\t\t\t\tp.data = null;\n\t\t\t}\n\n\t\t\t// Construct the path\n\t\t\tvar path = _this.qs(p.url, p.query);\n\n\t\t\t// Proxy the request through a server\n\t\t\t// Used for signing OAuth1\n\t\t\t// And circumventing services without Access-Control Headers\n\t\t\tif (p.proxy) {\n\t\t\t\t// Use the proxy as a path\n\t\t\t\tpath = _this.qs(p.oauth_proxy, {\n\t\t\t\t\tpath: path,\n\t\t\t\t\taccess_token: sign || '',\n\n\t\t\t\t\t// This will prompt the request to be signed as though it is OAuth1\n\t\t\t\t\tthen: p.proxy_response_type || (p.method.toLowerCase() === 'get' ? 'redirect' : 'proxy'),\n\t\t\t\t\tmethod: p.method.toLowerCase(),\n\t\t\t\t\tsuppress_response_codes: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcallback(path);\n\t\t}\n\t},\n\n\t// Test whether the browser supports the CORS response\n\trequest_cors: function(callback) {\n\t\treturn 'withCredentials' in new XMLHttpRequest() && callback();\n\t},\n\n\t// Return the type of DOM object\n\tdomInstance: function(type, data) {\n\t\tvar test = 'HTML' + (type || '').replace(\n\t\t\t/^[a-z]/,\n\t\t\tfunction(m) {\n\t\t\t\treturn m.toUpperCase();\n\t\t\t}\n\n\t\t) + 'Element';\n\n\t\tif (!data) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (window[test]) {\n\t\t\treturn data instanceof window[test];\n\t\t}\n\t\telse if (window.Element) {\n\t\t\treturn data instanceof window.Element && (!type || (data.tagName && data.tagName.toLowerCase() === type));\n\t\t}\n\t\telse {\n\t\t\treturn (!(data instanceof Object || data instanceof Array || data instanceof String || data instanceof Number) && data.tagName && data.tagName.toLowerCase() === type);\n\t\t}\n\t},\n\n\t// Create a clone of an object\n\tclone: function(obj) {\n\t\t// Does not clone DOM elements, nor Binary data, e.g. Blobs, Filelists\n\t\tif (obj === null || typeof (obj) !== 'object' || obj instanceof Date || 'nodeName' in obj || this.isBinary(obj) || (typeof FormData === 'function' && obj instanceof FormData)) {\n\t\t\treturn obj;\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\t// Clone each item in the array\n\t\t\treturn obj.map(this.clone.bind(this));\n\t\t}\n\n\t\t// But does clone everything else.\n\t\tvar clone = {};\n\t\tfor (var x in obj) {\n\t\t\tclone[x] = this.clone(obj[x]);\n\t\t}\n\n\t\treturn clone;\n\t},\n\n\t// XHR: uses CORS to make requests\n\txhr: function(method, url, headers, data, callback) {\n\n\t\tvar r = new XMLHttpRequest();\n\t\tvar error = this.error;\n\n\t\t// Binary?\n\t\tvar binary = false;\n\t\tif (method === 'blob') {\n\t\t\tbinary = method;\n\t\t\tmethod = 'GET';\n\t\t}\n\n\t\tmethod = method.toUpperCase();\n\n\t\t// Xhr.responseType 'json' is not supported in any of the vendors yet.\n\t\tr.onload = function(e) {\n\t\t\tvar json = r.response;\n\t\t\ttry {\n\t\t\t\tjson = JSON.parse(r.responseText);\n\t\t\t}\n\t\t\tcatch (_e) {\n\t\t\t\tif (r.status === 401) {\n\t\t\t\t\tjson = error('access_denied', r.statusText);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar headers = headersToJSON(r.getAllResponseHeaders());\n\t\t\theaders.statusCode = r.status;\n\n\t\t\tcallback(json || (method === 'GET' ? error('empty_response', 'Could not get resource') : {}), headers);\n\t\t};\n\n\t\tr.onerror = function(e) {\n\t\t\tvar json = r.responseText;\n\t\t\ttry {\n\t\t\t\tjson = JSON.parse(r.responseText);\n\t\t\t}\n\t\t\tcatch (_e) {}\n\n\t\t\tcallback(json || error('access_denied', 'Could not get resource'));\n\t\t};\n\n\t\tvar x;\n\n\t\t// Should we add the query to the URL?\n\t\tif (method === 'GET' || method === 'DELETE') {\n\t\t\tdata = null;\n\t\t}\n\t\telse if (data && typeof (data) !== 'string' && !(data instanceof FormData) && !(data instanceof File) && !(data instanceof Blob)) {\n\t\t\t// Loop through and add formData\n\t\t\tvar f = new FormData();\n\t\t\tfor (x in data) if (data.hasOwnProperty(x)) {\n\t\t\t\tif (data[x] instanceof HTMLInputElement) {\n\t\t\t\t\tif ('files' in data[x] && data[x].files.length > 0) {\n\t\t\t\t\t\tf.append(x, data[x].files[0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (data[x] instanceof Blob) {\n\t\t\t\t\tf.append(x, data[x], data.name);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tf.append(x, data[x]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata = f;\n\t\t}\n\n\t\t// Open the path, async\n\t\tr.open(method, url, true);\n\n\t\tif (binary) {\n\t\t\tif ('responseType' in r) {\n\t\t\t\tr.responseType = binary;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\t\t}\n\t\t}\n\n\t\t// Set any bespoke headers\n\t\tif (headers) {\n\t\t\tfor (x in headers) {\n\t\t\t\tr.setRequestHeader(x, headers[x]);\n\t\t\t}\n\t\t}\n\n\t\tr.send(data);\n\n\t\treturn r;\n\n\t\t// Headers are returned as a string\n\t\tfunction headersToJSON(s) {\n\t\t\tvar r = {};\n\t\t\tvar reg = /([a-z\\-]+):\\s?(.*);?/gi;\n\t\t\tvar m;\n\t\t\twhile ((m = reg.exec(s))) {\n\t\t\t\tr[m[1]] = m[2];\n\t\t\t}\n\n\t\t\treturn r;\n\t\t}\n\t},\n\n\t// JSONP\n\t// Injects a script tag into the DOM to be executed and appends a callback function to the window object\n\t// @param string/function pathFunc either a string of the URL or a callback function pathFunc(querystringhash, continueFunc);\n\t// @param function callback a function to call on completion;\n\tjsonp: function(url, callback, callbackID, timeout) {\n\n\t\tvar _this = this;\n\t\tvar error = _this.error;\n\n\t\t// Change the name of the callback\n\t\tvar bool = 0;\n\t\tvar head = document.getElementsByTagName('head')[0];\n\t\tvar operaFix;\n\t\tvar result = error('server_error', 'server_error');\n\t\tvar cb = function() {\n\t\t\tif (!(bool++)) {\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tcallback(result);\n\t\t\t\t\thead.removeChild(script);\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t};\n\n\t\t// Add callback to the window object\n\t\tcallbackID = _this.globalEvent(function(json) {\n\t\t\tresult = json;\n\t\t\treturn true;\n\n\t\t\t// Mark callback as done\n\t\t}, callbackID);\n\n\t\t// The URL is a function for some cases and as such\n\t\t// Determine its value with a callback containing the new parameters of this function.\n\t\turl = url.replace(new RegExp('=\\\\?(&|$)'), '=' + callbackID + '$1');\n\n\t\t// Build script tag\n\t\tvar script = _this.append('script', {\n\t\t\tid: callbackID,\n\t\t\tname: callbackID,\n\t\t\tsrc: url,\n\t\t\tasync: true,\n\t\t\tonload: cb,\n\t\t\tonerror: cb,\n\t\t\tonreadystatechange: function() {\n\t\t\t\tif (/loaded|complete/i.test(this.readyState)) {\n\t\t\t\t\tcb();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Opera fix error\n\t\t// Problem: If an error occurs with script loading Opera fails to trigger the script.onerror handler we specified\n\t\t//\n\t\t// Fix:\n\t\t// By setting the request to synchronous we can trigger the error handler when all else fails.\n\t\t// This action will be ignored if we've already called the callback handler \"cb\" with a successful onload event\n\t\tif (window.navigator.userAgent.toLowerCase().indexOf('opera') > -1) {\n\t\t\toperaFix = _this.append('script', {\n\t\t\t\ttext: 'document.getElementById(\\'' + callbackID + '\\').onerror();'\n\t\t\t});\n\t\t\tscript.async = false;\n\t\t}\n\n\t\t// Add timeout\n\t\tif (timeout) {\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tresult = error('timeout', 'timeout');\n\t\t\t\tcb();\n\t\t\t}, timeout);\n\t\t}\n\n\t\t// TODO: add fix for IE,\n\t\t// However: unable recreate the bug of firing off the onreadystatechange before the script content has been executed and the value of \"result\" has been defined.\n\t\t// Inject script tag into the head element\n\t\thead.appendChild(script);\n\n\t\t// Append Opera Fix to run after our script\n\t\tif (operaFix) {\n\t\t\thead.appendChild(operaFix);\n\t\t}\n\t},\n\n\t// Post\n\t// Send information to a remote location using the post mechanism\n\t// @param string uri path\n\t// @param object data, key value data to send\n\t// @param function callback, function to execute in response\n\tpost: function(url, data, options, callback, callbackID, timeout) {\n\n\t\tvar _this = this;\n\t\tvar error = _this.error;\n\t\tvar doc = document;\n\n\t\t// This hack needs a form\n\t\tvar form = null;\n\t\tvar reenableAfterSubmit = [];\n\t\tvar newform;\n\t\tvar i = 0;\n\t\tvar x = null;\n\t\tvar bool = 0;\n\t\tvar cb = function(r) {\n\t\t\tif (!(bool++)) {\n\t\t\t\tcallback(r);\n\t\t\t}\n\t\t};\n\n\t\t// What is the name of the callback to contain\n\t\t// We'll also use this to name the iframe\n\t\t_this.globalEvent(cb, callbackID);\n\n\t\t// Build the iframe window\n\t\tvar win;\n\t\ttry {\n\t\t\t// IE7 hack, only lets us define the name here, not later.\n\t\t\twin = doc.createElement('<iframe name=\"' + callbackID + '\">');\n\t\t}\n\t\tcatch (e) {\n\t\t\twin = doc.createElement('iframe');\n\t\t}\n\n\t\twin.name = callbackID;\n\t\twin.id = callbackID;\n\t\twin.style.display = 'none';\n\n\t\t// Override callback mechanism. Triggger a response onload/onerror\n\t\tif (options && options.callbackonload) {\n\t\t\t// Onload is being fired twice\n\t\t\twin.onload = function() {\n\t\t\t\tcb({\n\t\t\t\t\tresponse: 'posted',\n\t\t\t\t\tmessage: 'Content was posted'\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tif (timeout) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tcb(error('timeout', 'The post operation timed out'));\n\t\t\t}, timeout);\n\t\t}\n\n\t\tdoc.body.appendChild(win);\n\n\t\t// If we are just posting a single item\n\t\tif (_this.domInstance('form', data)) {\n\t\t\t// Get the parent form\n\t\t\tform = data.form;\n\n\t\t\t// Loop through and disable all of its siblings\n\t\t\tfor (i = 0; i < form.elements.length; i++) {\n\t\t\t\tif (form.elements[i] !== data) {\n\t\t\t\t\tform.elements[i].setAttribute('disabled', true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Move the focus to the form\n\t\t\tdata = form;\n\t\t}\n\n\t\t// Posting a form\n\t\tif (_this.domInstance('form', data)) {\n\t\t\t// This is a form element\n\t\t\tform = data;\n\n\t\t\t// Does this form need to be a multipart form?\n\t\t\tfor (i = 0; i < form.elements.length; i++) {\n\t\t\t\tif (!form.elements[i].disabled && form.elements[i].type === 'file') {\n\t\t\t\t\tform.encoding = form.enctype = 'multipart/form-data';\n\t\t\t\t\tform.elements[i].setAttribute('name', 'file');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Its not a form element,\n\t\t\t// Therefore it must be a JSON object of Key=>Value or Key=>Element\n\t\t\t// If anyone of those values are a input type=file we shall shall insert its siblings into the form for which it belongs.\n\t\t\tfor (x in data) if (data.hasOwnProperty(x)) {\n\t\t\t\t// Is this an input Element?\n\t\t\t\tif (_this.domInstance('input', data[x]) && data[x].type === 'file') {\n\t\t\t\t\tform = data[x].form;\n\t\t\t\t\tform.encoding = form.enctype = 'multipart/form-data';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do If there is no defined form element, lets create one.\n\t\t\tif (!form) {\n\t\t\t\t// Build form\n\t\t\t\tform = doc.createElement('form');\n\t\t\t\tdoc.body.appendChild(form);\n\t\t\t\tnewform = form;\n\t\t\t}\n\n\t\t\tvar input;\n\n\t\t\t// Add elements to the form if they dont exist\n\t\t\tfor (x in data) if (data.hasOwnProperty(x)) {\n\n\t\t\t\t// Is this an element?\n\t\t\t\tvar el = (_this.domInstance('input', data[x]) || _this.domInstance('textArea', data[x]) || _this.domInstance('select', data[x]));\n\n\t\t\t\t// Is this not an input element, or one that exists outside the form.\n\t\t\t\tif (!el || data[x].form !== form) {\n\n\t\t\t\t\t// Does an element have the same name?\n\t\t\t\t\tvar inputs = form.elements[x];\n\t\t\t\t\tif (input) {\n\t\t\t\t\t\t// Remove it.\n\t\t\t\t\t\tif (!(inputs instanceof NodeList)) {\n\t\t\t\t\t\t\tinputs = [inputs];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (i = 0; i < inputs.length; i++) {\n\t\t\t\t\t\t\tinputs[i].parentNode.removeChild(inputs[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create an input element\n\t\t\t\t\tinput = doc.createElement('input');\n\t\t\t\t\tinput.setAttribute('type', 'hidden');\n\t\t\t\t\tinput.setAttribute('name', x);\n\n\t\t\t\t\t// Does it have a value attribute?\n\t\t\t\t\tif (el) {\n\t\t\t\t\t\tinput.value = data[x].value;\n\t\t\t\t\t}\n\t\t\t\t\telse if (_this.domInstance(null, data[x])) {\n\t\t\t\t\t\tinput.value = data[x].innerHTML || data[x].innerText;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tinput.value = data[x];\n\t\t\t\t\t}\n\n\t\t\t\t\tform.appendChild(input);\n\t\t\t\t}\n\n\t\t\t\t// It is an element, which exists within the form, but the name is wrong\n\t\t\t\telse if (el && data[x].name !== x) {\n\t\t\t\t\tdata[x].setAttribute('name', x);\n\t\t\t\t\tdata[x].name = x;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Disable elements from within the form if they weren't specified\n\t\t\tfor (i = 0; i < form.elements.length; i++) {\n\n\t\t\t\tinput = form.elements[i];\n\n\t\t\t\t// Does the same name and value exist in the parent\n\t\t\t\tif (!(input.name in data) && input.getAttribute('disabled') !== true) {\n\t\t\t\t\t// Disable\n\t\t\t\t\tinput.setAttribute('disabled', true);\n\n\t\t\t\t\t// Add re-enable to callback\n\t\t\t\t\treenableAfterSubmit.push(input);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Set the target of the form\n\t\tform.setAttribute('method', 'POST');\n\t\tform.setAttribute('target', callbackID);\n\t\tform.target = callbackID;\n\n\t\t// Update the form URL\n\t\tform.setAttribute('action', url);\n\n\t\t// Submit the form\n\t\t// Some reason this needs to be offset from the current window execution\n\t\tsetTimeout(function() {\n\t\t\tform.submit();\n\n\t\t\tsetTimeout(function() {\n\t\t\t\ttry {\n\t\t\t\t\t// Remove the iframe from the page.\n\t\t\t\t\t//win.parentNode.removeChild(win);\n\t\t\t\t\t// Remove the form\n\t\t\t\t\tif (newform) {\n\t\t\t\t\t\tnewform.parentNode.removeChild(newform);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.error('HelloJS: could not remove iframe');\n\t\t\t\t\t}\n\t\t\t\t\tcatch (ee) {}\n\t\t\t\t}\n\n\t\t\t\t// Reenable the disabled form\n\t\t\t\tfor (var i = 0; i < reenableAfterSubmit.length; i++) {\n\t\t\t\t\tif (reenableAfterSubmit[i]) {\n\t\t\t\t\t\treenableAfterSubmit[i].setAttribute('disabled', false);\n\t\t\t\t\t\treenableAfterSubmit[i].disabled = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t}, 100);\n\t},\n\n\t// Some of the providers require that only multipart is used with non-binary forms.\n\t// This function checks whether the form contains binary data\n\thasBinary: function(data) {\n\t\tfor (var x in data) if (data.hasOwnProperty(x)) {\n\t\t\tif (this.isBinary(data[x])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t// Determines if a variable Either Is or like a FormInput has the value of a Blob\n\n\tisBinary: function(data) {\n\n\t\treturn data instanceof Object && (\n\t\t(this.domInstance('input', data) && data.type === 'file') ||\n\t\t('FileList' in window && data instanceof window.FileList) ||\n\t\t('File' in window && data instanceof window.File) ||\n\t\t('Blob' in window && data instanceof window.Blob));\n\n\t},\n\n\t// Convert Data-URI to Blob string\n\ttoBlob: function(dataURI) {\n\t\tvar reg = /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i;\n\t\tvar m = dataURI.match(reg);\n\t\tif (!m) {\n\t\t\treturn dataURI;\n\t\t}\n\n\t\tvar binary = atob(dataURI.replace(reg, ''));\n\t\tvar array = [];\n\t\tfor (var i = 0; i < binary.length; i++) {\n\t\t\tarray.push(binary.charCodeAt(i));\n\t\t}\n\n\t\treturn new Blob([new Uint8Array(array)], {type: m[1]});\n\t}\n\n});\n\n// EXTRA: Convert FormElement to JSON for POSTing\n// Wrappers to add additional functionality to existing functions\n(function(hello) {\n\n\t// Copy original function\n\tvar api = hello.api;\n\tvar utils = hello.utils;\n\n\tutils.extend(utils, {\n\n\t\t// DataToJSON\n\t\t// This takes a FormElement|NodeList|InputElement|MixedObjects and convers the data object to JSON.\n\t\tdataToJSON: function(p) {\n\n\t\t\tvar _this = this;\n\t\t\tvar w = window;\n\t\t\tvar data = p.data;\n\n\t\t\t// Is data a form object\n\t\t\tif (_this.domInstance('form', data)) {\n\t\t\t\tdata = _this.nodeListToJSON(data.elements);\n\t\t\t}\n\t\t\telse if ('NodeList' in w && data instanceof NodeList) {\n\t\t\t\tdata = _this.nodeListToJSON(data);\n\t\t\t}\n\t\t\telse if (_this.domInstance('input', data)) {\n\t\t\t\tdata = _this.nodeListToJSON([data]);\n\t\t\t}\n\n\t\t\t// Is data a blob, File, FileList?\n\t\t\tif (('File' in w && data instanceof w.File) ||\n\t\t\t\t('Blob' in w && data instanceof w.Blob) ||\n\t\t\t\t('FileList' in w && data instanceof w.FileList)) {\n\t\t\t\tdata = {file: data};\n\t\t\t}\n\n\t\t\t// Loop through data if it's not form data it must now be a JSON object\n\t\t\tif (!('FormData' in w && data instanceof w.FormData)) {\n\n\t\t\t\tfor (var x in data) if (data.hasOwnProperty(x)) {\n\n\t\t\t\t\tif ('FileList' in w && data[x] instanceof w.FileList) {\n\t\t\t\t\t\tif (data[x].length === 1) {\n\t\t\t\t\t\t\tdata[x] = data[x][0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (_this.domInstance('input', data[x]) && data[x].type === 'file') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\telse if (_this.domInstance('input', data[x]) ||\n\t\t\t\t\t\t_this.domInstance('select', data[x]) ||\n\t\t\t\t\t\t_this.domInstance('textArea', data[x])) {\n\t\t\t\t\t\tdata[x] = data[x].value;\n\t\t\t\t\t}\n\t\t\t\t\telse if (_this.domInstance(null, data[x])) {\n\t\t\t\t\t\tdata[x] = data[x].innerHTML || data[x].innerText;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tp.data = data;\n\t\t\treturn data;\n\t\t},\n\n\t\t// NodeListToJSON\n\t\t// Given a list of elements extrapolate their values and return as a json object\n\t\tnodeListToJSON: function(nodelist) {\n\n\t\t\tvar json = {};\n\n\t\t\t// Create a data string\n\t\t\tfor (var i = 0; i < nodelist.length; i++) {\n\n\t\t\t\tvar input = nodelist[i];\n\n\t\t\t\t// If the name of the input is empty or diabled, dont add it.\n\t\t\t\tif (input.disabled || !input.name) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Is this a file, does the browser not support 'files' and 'FormData'?\n\t\t\t\tif (input.type === 'file') {\n\t\t\t\t\tjson[input.name] = input;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tjson[input.name] = input.value || input.innerHTML;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn json;\n\t\t}\n\t});\n\n\t// Replace it\n\thello.api = function() {\n\n\t\t// Get arguments\n\t\tvar p = utils.args({path: 's!', method: 's', data:'o', timeout: 'i', callback: 'f'}, arguments);\n\n\t\t// Change for into a data object\n\t\tif (p.data) {\n\t\t\tutils.dataToJSON(p);\n\t\t}\n\n\t\treturn api.call(this, p);\n\t};\n\n})(hello);\n\n/////////////////////////////////////\n//\n// Save any access token that is in the current page URL\n// Handle any response solicited through iframe hash tag following an API request\n//\n/////////////////////////////////////\n\nhello.utils.responseHandler(window, window.opener || window.parent);\n\n// Script to support ChromeApps\n// This overides the hello.utils.popup method to support chrome.identity.launchWebAuthFlow\n// See https://developer.chrome.com/apps/app_identity#non\n\n// Is this a chrome app?\n\nif (typeof chrome === 'object' && typeof chrome.identity === 'object' && chrome.identity.launchWebAuthFlow) {\n\n\t(function() {\n\n\t\t// Swap the popup method\n\t\thello.utils.popup = function(url) {\n\n\t\t\treturn _open(url, true);\n\n\t\t};\n\n\t\t// Swap the hidden iframe method\n\t\thello.utils.iframe = function(url) {\n\n\t\t\t_open(url, false);\n\n\t\t};\n\n\t\t// Swap the request_cors method\n\t\thello.utils.request_cors = function(callback) {\n\n\t\t\tcallback();\n\n\t\t\t// Always run as CORS\n\n\t\t\treturn true;\n\t\t};\n\n\t\t// Swap the storage method\n\t\tvar _cache = {};\n\t\tchrome.storage.local.get('hello', function(r) {\n\t\t\t// Update the cache\n\t\t\t_cache = r.hello || {};\n\t\t});\n\n\t\thello.utils.store = function(name, value) {\n\n\t\t\t// Get all\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn _cache;\n\t\t\t}\n\n\t\t\t// Get\n\t\t\tif (arguments.length === 1) {\n\t\t\t\treturn _cache[name] || null;\n\t\t\t}\n\n\t\t\t// Set\n\t\t\tif (value) {\n\t\t\t\t_cache[name] = value;\n\t\t\t\tchrome.storage.local.set({hello: _cache});\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t// Delete\n\t\t\tif (value === null) {\n\t\t\t\tdelete _cache[name];\n\t\t\t\tchrome.storage.local.set({hello: _cache});\n\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\n\t\t// Open function\n\t\tfunction _open(url, interactive) {\n\n\t\t\t// Launch\n\t\t\tvar ref = {\n\t\t\t\tclosed: false\n\t\t\t};\n\n\t\t\t// Launch the webAuthFlow\n\t\t\tchrome.identity.launchWebAuthFlow({\n\t\t\t\turl: url,\n\t\t\t\tinteractive: interactive\n\t\t\t}, function(responseUrl) {\n\n\t\t\t\t// Did the user cancel this prematurely\n\t\t\t\tif (responseUrl === undefined) {\n\t\t\t\t\tref.closed = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Split appart the URL\n\t\t\t\tvar a = hello.utils.url(responseUrl);\n\n\t\t\t\t// The location can be augmented in to a location object like so...\n\t\t\t\t// We dont have window operations on the popup so lets create some\n\t\t\t\tvar _popup = {\n\t\t\t\t\tlocation: {\n\n\t\t\t\t\t\t// Change the location of the popup\n\t\t\t\t\t\tassign: function(url) {\n\n\t\t\t\t\t\t\t// If there is a secondary reassign\n\t\t\t\t\t\t\t// In the case of OAuth1\n\t\t\t\t\t\t\t// Trigger this in non-interactive mode.\n\t\t\t\t\t\t\t_open(url, false);\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tsearch: a.search,\n\t\t\t\t\t\thash: a.hash,\n\t\t\t\t\t\thref: a.href\n\t\t\t\t\t},\n\t\t\t\t\tclose: function() {}\n\t\t\t\t};\n\n\t\t\t\t// Then this URL contains information which HelloJS must process\n\t\t\t\t// URL string\n\t\t\t\t// Window - any action such as window relocation goes here\n\t\t\t\t// Opener - the parent window which opened this, aka this script\n\n\t\t\t\thello.utils.responseHandler(_popup, window);\n\t\t\t});\n\n\t\t\t// Return the reference\n\t\t\treturn ref;\n\t\t}\n\n\t})();\n}\n\n// Phonegap override for hello.phonegap.js\n(function() {\n\n\t// Is this a phonegap implementation?\n\tif (!(/^file:\\/{3}[^\\/]/.test(window.location.href) && window.cordova)) {\n\t\t// Cordova is not included.\n\t\treturn;\n\t}\n\n\t// Augment the hidden iframe method\n\thello.utils.iframe = function(url, redirectUri) {\n\t\thello.utils.popup(url, redirectUri, {hidden: 'yes'});\n\t};\n\n\t// Augment the popup\n\tvar utilPopup = hello.utils.popup;\n\n\t// Replace popup\n\thello.utils.popup = function(url, redirectUri, options) {\n\n\t\t// Run the standard\n\t\tvar popup = utilPopup.call(this, url, redirectUri, options);\n\n\t\t// Create a function for reopening the popup, and assigning events to the new popup object\n\t\t// PhoneGap support\n\t\t// Add an event listener to listen to the change in the popup windows URL\n\t\t// This must appear before popup.focus();\n\t\ttry {\n\t\t\tif (popup && popup.addEventListener) {\n\n\t\t\t\t// Get the origin of the redirect URI\n\n\t\t\t\tvar a = hello.utils.url(redirectUri);\n\t\t\t\tvar redirectUriOrigin = a.origin || (a.protocol + '//' + a.hostname);\n\n\t\t\t\t// Listen to changes in the InAppBrowser window\n\n\t\t\t\tpopup.addEventListener('loadstart', function(e) {\n\n\t\t\t\t\tvar url = e.url;\n\n\t\t\t\t\t// Is this the path, as given by the redirectUri?\n\t\t\t\t\t// Check the new URL agains the redirectUriOrigin.\n\t\t\t\t\t// According to #63 a user could click 'cancel' in some dialog boxes ....\n\t\t\t\t\t// The popup redirects to another page with the same origin, yet we still wish it to close.\n\n\t\t\t\t\tif (url.indexOf(redirectUriOrigin) !== 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Split appart the URL\n\t\t\t\t\tvar a = hello.utils.url(url);\n\n\t\t\t\t\t// We dont have window operations on the popup so lets create some\n\t\t\t\t\t// The location can be augmented in to a location object like so...\n\n\t\t\t\t\tvar _popup = {\n\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\t// Change the location of the popup\n\t\t\t\t\t\t\tassign: function(location) {\n\n\t\t\t\t\t\t\t\t// Unfourtunatly an app is may not change the location of a InAppBrowser window.\n\t\t\t\t\t\t\t\t// So to shim this, just open a new one.\n\t\t\t\t\t\t\t\tpopup.executeScript({code: 'window.location.href = \"' + location + ';\"'});\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\tsearch: a.search,\n\t\t\t\t\t\t\thash: a.hash,\n\t\t\t\t\t\t\thref: a.href\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\tif (popup.close) {\n\t\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tpopup.closed = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcatch (_e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\t// Then this URL contains information which HelloJS must process\n\t\t\t\t\t// URL string\n\t\t\t\t\t// Window - any action such as window relocation goes here\n\t\t\t\t\t// Opener - the parent window which opened this, aka this script\n\n\t\t\t\t\thello.utils.responseHandler(_popup, window);\n\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tcatch (e) {}\n\n\t\treturn popup;\n\t};\n\n})();\n\n(function(hello) {\n\n\t// OAuth1\n\tvar OAuth1Settings = {\n\t\tversion: '1.0',\n\t\tauth: 'https://www.dropbox.com/1/oauth/authorize',\n\t\trequest: 'https://api.dropbox.com/1/oauth/request_token',\n\t\ttoken: 'https://api.dropbox.com/1/oauth/access_token'\n\t};\n\n\t// OAuth2 Settings\n\tvar OAuth2Settings = {\n\t\tversion: 2,\n\t\tauth: 'https://www.dropbox.com/1/oauth2/authorize',\n\t\tgrant: 'https://api.dropbox.com/1/oauth2/token'\n\t};\n\n\t// Initiate the Dropbox module\n\thello.init({\n\n\t\tdropbox: {\n\n\t\t\tname: 'Dropbox',\n\n\t\t\toauth: OAuth2Settings,\n\n\t\t\tlogin: function(p) {\n\t\t\t\t// OAuth2 non-standard adjustments\n\t\t\t\tp.qs.scope = '';\n\n\t\t\t\t// Should this be run as OAuth1?\n\t\t\t\t// If the redirect_uri is is HTTP (non-secure) then its required to revert to the OAuth1 endpoints\n\t\t\t\tvar redirect = decodeURIComponent(p.qs.redirect_uri);\n\t\t\t\tif (redirect.indexOf('http:') === 0 && redirect.indexOf('http://localhost/') !== 0) {\n\n\t\t\t\t\t// Override the dropbox OAuth settings.\n\t\t\t\t\thello.services.dropbox.oauth = OAuth1Settings;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Override the dropbox OAuth settings.\n\t\t\t\t\thello.services.dropbox.oauth = OAuth2Settings;\n\t\t\t\t}\n\n\t\t\t\t// The dropbox login window is a different size\n\t\t\t\tp.options.popup.width = 1000;\n\t\t\t\tp.options.popup.height = 1000;\n\t\t\t},\n\n\t\t\t/*\n\t\t\t\tDropbox does not allow insecure HTTP URI's in the redirect_uri field\n\t\t\t\t...otherwise I'd love to use OAuth2\n\n\t\t\t\tFollow request https://forums.dropbox.com/topic.php?id=106505\n\n\t\t\t\tp.qs.response_type = 'code';\n\t\t\t\toauth: {\n\t\t\t\t\tversion: 2,\n\t\t\t\t\tauth: 'https://www.dropbox.com/1/oauth2/authorize',\n\t\t\t\t\tgrant: 'https://api.dropbox.com/1/oauth2/token'\n\t\t\t\t}\n\t\t\t*/\n\n\t\t\t// API Base URL\n\t\t\tbase: 'https://api.dropbox.com/1/',\n\n\t\t\t// Bespoke setting: this is states whether to use the custom environment of Dropbox or to use their own environment\n\t\t\t// Because it's notoriously difficult for Dropbox too provide access from other webservices, this defaults to Sandbox\n\t\t\troot: 'sandbox',\n\n\t\t\t// Map GET requests\n\t\t\tget: {\n\t\t\t\tme: 'account/info',\n\n\t\t\t\t// Https://www.dropbox.com/developers/core/docs#metadata\n\t\t\t\t'me/files': req('metadata/auto/@{parent|}'),\n\t\t\t\t'me/folder': req('metadata/auto/@{id}'),\n\t\t\t\t'me/folders': req('metadata/auto/'),\n\n\t\t\t\t'default': function(p, callback) {\n\t\t\t\t\tif (p.path.match('https://api-content.dropbox.com/1/files/')) {\n\t\t\t\t\t\t// This is a file, return binary data\n\t\t\t\t\t\tp.method = 'blob';\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(p.path);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tpost: {\n\t\t\t\t'me/files': function(p, callback) {\n\n\t\t\t\t\tvar path = p.data.parent;\n\t\t\t\t\tvar fileName = p.data.name;\n\n\t\t\t\t\tp.data = {\n\t\t\t\t\t\tfile: p.data.file\n\t\t\t\t\t};\n\n\t\t\t\t\t// Does this have a data-uri to upload as a file?\n\t\t\t\t\tif (typeof (p.data.file) === 'string') {\n\t\t\t\t\t\tp.data.file = hello.utils.toBlob(p.data.file);\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback('https://api-content.dropbox.com/1/files_put/auto/' + path + '/' + fileName);\n\t\t\t\t},\n\n\t\t\t\t'me/folders': function(p, callback) {\n\n\t\t\t\t\tvar name = p.data.name;\n\t\t\t\t\tp.data = {};\n\n\t\t\t\t\tcallback('fileops/create_folder?root=@{root|sandbox}&' + hello.utils.param({\n\t\t\t\t\t\tpath: name\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Map DELETE requests\n\t\t\tdel: {\n\t\t\t\t'me/files': 'fileops/delete?root=@{root|sandbox}&path=@{id}',\n\t\t\t\t'me/folder': 'fileops/delete?root=@{root|sandbox}&path=@{id}'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tif (!o.uid) {\n\t\t\t\t\t\treturn o;\n\t\t\t\t\t}\n\n\t\t\t\t\to.name = o.display_name;\n\t\t\t\t\tvar m = o.name.split(' ');\n\t\t\t\t\to.first_name = m.shift();\n\t\t\t\t\to.last_name = m.join(' ');\n\t\t\t\t\to.id = o.uid;\n\t\t\t\t\tdelete o.uid;\n\t\t\t\t\tdelete o.display_name;\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o, headers, req) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tif (o.is_dir && o.contents) {\n\t\t\t\t\t\to.data = o.contents;\n\t\t\t\t\t\tdelete o.contents;\n\n\t\t\t\t\t\to.data.forEach(function(item) {\n\t\t\t\t\t\t\titem.root = o.root;\n\t\t\t\t\t\t\tformatFile(item, headers, req);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tformatFile(o, headers, req);\n\n\t\t\t\t\tif (o.is_deleted) {\n\t\t\t\t\t\to.success = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Doesn't return the CORS headers\n\t\t\txhr: function(p) {\n\n\t\t\t\t// The proxy supports allow-cross-origin-resource\n\t\t\t\t// Alas that's the only thing we're using.\n\t\t\t\tif (p.data && p.data.file) {\n\t\t\t\t\tvar file = p.data.file;\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tif (file.files) {\n\t\t\t\t\t\t\tp.data = file.files[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tp.data = file;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (p.method === 'delete') {\n\t\t\t\t\tp.method = 'post';\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\tform: function(p, qs) {\n\t\t\t\tdelete qs.state;\n\t\t\t\tdelete qs.redirect_uri;\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction formatError(o) {\n\t\tif (o && 'error' in o) {\n\t\t\to.error = {\n\t\t\t\tcode: 'server_error',\n\t\t\t\tmessage: o.error.message || o.error\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction formatFile(o, headers, req) {\n\n\t\tif (typeof o !== 'object' ||\n\t\t\t(typeof Blob !== 'undefined' && o instanceof Blob) ||\n\t\t\t(typeof ArrayBuffer !== 'undefined' && o instanceof ArrayBuffer)) {\n\t\t\t// This is a file, let it through unformatted\n\t\t\treturn;\n\t\t}\n\n\t\tif ('error' in o) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar path = (o.root !== 'app_folder' ? o.root : '') + o.path.replace(/\\&/g, '%26');\n\t\tpath = path.replace(/^\\//, '');\n\t\tif (o.thumb_exists) {\n\t\t\to.thumbnail = req.oauth_proxy + '?path=' +\n\t\t\tencodeURIComponent('https://api-content.dropbox.com/1/thumbnails/auto/' + path + '?format=jpeg&size=m') + '&access_token=' + req.options.access_token;\n\t\t}\n\n\t\to.type = (o.is_dir ? 'folder' : o.mime_type);\n\t\to.name = o.path.replace(/.*\\//g, '');\n\t\tif (o.is_dir) {\n\t\t\to.files = path.replace(/^\\//, '');\n\t\t}\n\t\telse {\n\t\t\to.downloadLink = hello.settings.oauth_proxy + '?path=' +\n\t\t\tencodeURIComponent('https://api-content.dropbox.com/1/files/auto/' + path) + '&access_token=' + req.options.access_token;\n\t\t\to.file = 'https://api-content.dropbox.com/1/files/auto/' + path;\n\t\t}\n\n\t\tif (!o.id) {\n\t\t\to.id = o.path.replace(/^\\//, '');\n\t\t}\n\n\t\t// O.media = 'https://api-content.dropbox.com/1/files/' + path;\n\t}\n\n\tfunction req(str) {\n\t\treturn function(p, cb) {\n\t\t\tdelete p.query.limit;\n\t\t\tcb(str);\n\t\t};\n\t}\n\n})(hello);\n\n(function(hello) {\n\t// For APIs, once a version is no longer usable, any calls made to it will be defaulted to the next oldest usable version.\n\t// So we explicitly state it.\n\tvar version = 'v2.9';\n\n\thello.init({\n\n\t\tfacebook: {\n\n\t\t\tname: 'Facebook',\n\n\t\t\t// SEE https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://www.facebook.com/' + version + '/dialog/oauth/',\n\t\t\t\tgrant: 'https://graph.facebook.com/oauth/access_token'\n\t\t\t},\n\n\t\t\t// Authorization scopes\n\t\t\tscope: {\n\t\t\t\tbasic: 'public_profile',\n\t\t\t\temail: 'email',\n\t\t\t\tshare: 'user_posts',\n\t\t\t\tbirthday: 'user_birthday',\n\t\t\t\tevents: 'user_events',\n\t\t\t\tphotos: 'user_photos',\n\t\t\t\tvideos: 'user_videos',\n\t\t\t\tfriends: 'user_friends',\n\t\t\t\tfiles: 'user_photos,user_videos',\n\t\t\t\tpublish_files: 'user_photos,user_videos,publish_actions',\n\t\t\t\tpublish: 'publish_actions',\n\n\t\t\t\t// Deprecated in v2.0\n\t\t\t\t// Create_event\t: 'create_event',\n\n\t\t\t\toffline_access: ''\n\t\t\t},\n\n\t\t\t// Refresh the access_token\n\t\t\trefresh: false,\n\n\t\t\tlogin: function(p) {\n\n\t\t\t\t// Reauthenticate\n\t\t\t\t// https://developers.facebook.com/docs/facebook-login/reauthentication\n\t\t\t\tif (p.options.force) {\n\t\t\t\t\tp.qs.auth_type = 'reauthenticate';\n\t\t\t\t}\n\n\t\t\t\t// Set the display value\n\t\t\t\tp.qs.display = p.options.display || 'popup';\n\t\t\t},\n\n\t\t\tlogout: function(callback, options) {\n\t\t\t\t// Assign callback to a global handler\n\t\t\t\tvar callbackID = hello.utils.globalEvent(callback);\n\t\t\t\tvar redirect = encodeURIComponent(hello.settings.redirect_uri + '?' + hello.utils.param({callback:callbackID, result: JSON.stringify({force:true}), state: '{}'}));\n\t\t\t\tvar token = (options.authResponse || {}).access_token;\n\t\t\t\thello.utils.iframe('https://www.facebook.com/logout.php?next=' + redirect + '&access_token=' + token);\n\n\t\t\t\t// Possible responses:\n\t\t\t\t// String URL\t- hello.logout should handle the logout\n\t\t\t\t// Undefined\t- this function will handle the callback\n\t\t\t\t// True - throw a success, this callback isn't handling the callback\n\t\t\t\t// False - throw a error\n\t\t\t\tif (!token) {\n\t\t\t\t\t// If there isn't a token, the above wont return a response, so lets trigger a response\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// API Base URL\n\t\t\tbase: 'https://graph.facebook.com/' + version + '/',\n\n\t\t\t// Map GET requests\n\t\t\tget: {\n\t\t\t\tme: 'me?fields=email,first_name,last_name,name,timezone,verified',\n\t\t\t\t'me/friends': 'me/friends',\n\t\t\t\t'me/following': 'me/friends',\n\t\t\t\t'me/followers': 'me/friends',\n\t\t\t\t'me/share': 'me/feed',\n\t\t\t\t'me/like': 'me/likes',\n\t\t\t\t'me/files': 'me/albums',\n\t\t\t\t'me/albums': 'me/albums?fields=cover_photo,name',\n\t\t\t\t'me/album': '@{id}/photos?fields=picture',\n\t\t\t\t'me/photos': 'me/photos',\n\t\t\t\t'me/photo': '@{id}',\n\t\t\t\t'friend/albums': '@{id}/albums',\n\t\t\t\t'friend/photos': '@{id}/photos'\n\n\t\t\t\t// Pagination\n\t\t\t\t// Https://developers.facebook.com/docs/reference/api/pagination/\n\t\t\t},\n\n\t\t\t// Map POST requests\n\t\t\tpost: {\n\t\t\t\t'me/share': 'me/feed',\n\t\t\t\t'me/photo': '@{id}'\n\n\t\t\t\t// Https://developers.facebook.com/docs/graph-api/reference/v2.2/object/likes/\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: formatUser,\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/albums': format,\n\t\t\t\t'me/photos': format,\n\t\t\t\t'me/files': format,\n\t\t\t\t'default': format\n\t\t\t},\n\n\t\t\t// Special requirements for handling XHR\n\t\t\txhr: function(p, qs) {\n\t\t\t\tif (p.method === 'get' || p.method === 'post') {\n\t\t\t\t\tqs.suppress_response_codes = true;\n\t\t\t\t}\n\n\t\t\t\t// Is this a post with a data-uri?\n\t\t\t\tif (p.method === 'post' && p.data && typeof (p.data.file) === 'string') {\n\t\t\t\t\t// Convert the Data-URI to a Blob\n\t\t\t\t\tp.data.file = hello.utils.toBlob(p.data.file);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\t// Special requirements for handling JSONP fallback\n\t\t\tjsonp: function(p, qs) {\n\t\t\t\tvar m = p.method;\n\t\t\t\tif (m !== 'get' && !hello.utils.hasBinary(p.data)) {\n\t\t\t\t\tp.data.method = m;\n\t\t\t\t\tp.method = 'get';\n\t\t\t\t}\n\t\t\t\telse if (p.method === 'delete') {\n\t\t\t\t\tqs.method = 'delete';\n\t\t\t\t\tp.method = 'post';\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Special requirements for iframe form hack\n\t\t\tform: function(p) {\n\t\t\t\treturn {\n\t\t\t\t\t// Fire the callback onload\n\t\t\t\t\tcallbackonload: true\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\n\tvar base = 'https://graph.facebook.com/';\n\n\tfunction formatUser(o) {\n\t\tif (o.id) {\n\t\t\to.thumbnail = o.picture = 'https://graph.facebook.com/' + o.id + '/picture';\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o) {\n\t\tif ('data' in o) {\n\t\t\to.data.forEach(formatUser);\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction format(o, headers, req) {\n\t\tif (typeof o === 'boolean') {\n\t\t\to = {success: o};\n\t\t}\n\n\t\tif (o && 'data' in o) {\n\t\t\tvar token = req.query.access_token;\n\n\t\t\tif (!(o.data instanceof Array)) {\n\t\t\t\tvar data = o.data;\n\t\t\t\tdelete o.data;\n\t\t\t\to.data = [data];\n\t\t\t}\n\n\t\t\to.data.forEach(function(d) {\n\n\t\t\t\tif (d.picture) {\n\t\t\t\t\td.thumbnail = d.picture;\n\t\t\t\t}\n\n\t\t\t\td.pictures = (d.images || [])\n\t\t\t\t\t.sort(function(a, b) {\n\t\t\t\t\t\treturn a.width - b.width;\n\t\t\t\t\t});\n\n\t\t\t\tif (d.cover_photo && d.cover_photo.id) {\n\t\t\t\t\td.thumbnail = base + d.cover_photo.id + '/picture?access_token=' + token;\n\t\t\t\t}\n\n\t\t\t\tif (d.type === 'album') {\n\t\t\t\t\td.files = d.photos = base + d.id + '/photos';\n\t\t\t\t}\n\n\t\t\t\tif (d.can_upload) {\n\t\t\t\t\td.upload_location = base + d.id + '/photos';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn o;\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tflickr: {\n\n\t\t\tname: 'Flickr',\n\n\t\t\t// Ensure that you define an oauth_proxy\n\t\t\toauth: {\n\t\t\t\tversion: '1.0a',\n\t\t\t\tauth: 'https://www.flickr.com/services/oauth/authorize?perms=read',\n\t\t\t\trequest: 'https://www.flickr.com/services/oauth/request_token',\n\t\t\t\ttoken: 'https://www.flickr.com/services/oauth/access_token'\n\t\t\t},\n\n\t\t\t// API base URL\n\t\t\tbase: 'https://api.flickr.com/services/rest',\n\n\t\t\t// Map GET resquests\n\t\t\tget: {\n\t\t\t\tme: sign('flickr.people.getInfo'),\n\t\t\t\t'me/friends': sign('flickr.contacts.getList', {per_page:'@{limit|50}'}),\n\t\t\t\t'me/following': sign('flickr.contacts.getList', {per_page:'@{limit|50}'}),\n\t\t\t\t'me/followers': sign('flickr.contacts.getList', {per_page:'@{limit|50}'}),\n\t\t\t\t'me/albums': sign('flickr.photosets.getList', {per_page:'@{limit|50}'}),\n\t\t\t\t'me/album': sign('flickr.photosets.getPhotos', {photoset_id: '@{id}'}),\n\t\t\t\t'me/photos': sign('flickr.people.getPhotos', {per_page:'@{limit|50}'})\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\to = checkResponse(o, 'person');\n\t\t\t\t\tif (o.id) {\n\t\t\t\t\t\tif (o.realname) {\n\t\t\t\t\t\t\to.name = o.realname._content;\n\t\t\t\t\t\t\tvar m = o.name.split(' ');\n\t\t\t\t\t\t\to.first_name = m.shift();\n\t\t\t\t\t\t\to.last_name = m.join(' ');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\to.thumbnail = getBuddyIcon(o, 'l');\n\t\t\t\t\t\to.picture = getBuddyIcon(o, 'l');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/albums': function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\to = checkResponse(o, 'photosets');\n\t\t\t\t\tpaging(o);\n\t\t\t\t\tif (o.photoset) {\n\t\t\t\t\t\to.data = o.photoset;\n\t\t\t\t\t\to.data.forEach(function(item) {\n\t\t\t\t\t\t\titem.name = item.title._content;\n\t\t\t\t\t\t\titem.photos = 'https://api.flickr.com/services/rest' + getApiUrl('flickr.photosets.getPhotos', {photoset_id: item.id}, true);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdelete o.photoset;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/photos': function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\treturn formatPhotos(o);\n\t\t\t\t},\n\n\t\t\t\t'default': function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\treturn formatPhotos(o);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: false,\n\n\t\t\tjsonp: function(p, qs) {\n\t\t\t\tif (p.method == 'get') {\n\t\t\t\t\tdelete qs.callback;\n\t\t\t\t\tqs.jsoncallback = p.callbackID;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction getApiUrl(method, extraParams, skipNetwork) {\n\t\tvar url = ((skipNetwork) ? '' : 'flickr:') +\n\t\t\t'?method=' + method +\n\t\t\t'&api_key=' + hello.services.flickr.id +\n\t\t\t'&format=json';\n\t\tfor (var param in extraParams) {\n\t\t\tif (extraParams.hasOwnProperty(param)) {\n\t\t\t\turl += '&' + param + '=' + extraParams[param];\n\t\t\t}\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t// This is not exactly neat but avoid to call\n\t// The method 'flickr.test.login' for each api call\n\n\tfunction withUser(cb) {\n\t\tvar auth = hello.getAuthResponse('flickr');\n\t\tcb(auth && auth.user_nsid ? auth.user_nsid : null);\n\t}\n\n\tfunction sign(url, params) {\n\t\tif (!params) {\n\t\t\tparams = {};\n\t\t}\n\n\t\treturn function(p, callback) {\n\t\t\twithUser(function(userId) {\n\t\t\t\tparams.user_id = userId;\n\t\t\t\tcallback(getApiUrl(url, params, true));\n\t\t\t});\n\t\t};\n\t}\n\n\tfunction getBuddyIcon(profile, size) {\n\t\tvar url = 'https://www.flickr.com/images/buddyicon.gif';\n\t\tif (profile.nsid && profile.iconserver && profile.iconfarm) {\n\t\t\turl = 'https://farm' + profile.iconfarm + '.staticflickr.com/' +\n\t\t\t\tprofile.iconserver + '/' +\n\t\t\t\t'buddyicons/' + profile.nsid +\n\t\t\t\t((size) ? '_' + size : '') + '.jpg';\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t// See: https://www.flickr.com/services/api/misc.urls.html\n\tfunction createPhotoUrl(id, farm, server, secret, size) {\n\t\tsize = (size) ? '_' + size : '';\n\t\treturn 'https://farm' + farm + '.staticflickr.com/' + server + '/' + id + '_' + secret + size + '.jpg';\n\t}\n\n\tfunction formatUser(o) {\n\t}\n\n\tfunction formatError(o) {\n\t\tif (o && o.stat && o.stat.toLowerCase() != 'ok') {\n\t\t\to.error = {\n\t\t\t\tcode: 'invalid_request',\n\t\t\t\tmessage: o.message\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction formatPhotos(o) {\n\t\tif (o.photoset || o.photos) {\n\t\t\tvar set = ('photoset' in o) ? 'photoset' : 'photos';\n\t\t\to = checkResponse(o, set);\n\t\t\tpaging(o);\n\t\t\to.data = o.photo;\n\t\t\tdelete o.photo;\n\t\t\tfor (var i = 0; i < o.data.length; i++) {\n\t\t\t\tvar photo = o.data[i];\n\t\t\t\tphoto.name = photo.title;\n\t\t\t\tphoto.picture = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, '');\n\t\t\t\tphoto.pictures = createPictures(photo.id, photo.farm, photo.server, photo.secret);\n\t\t\t\tphoto.source = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, 'b');\n\t\t\t\tphoto.thumbnail = createPhotoUrl(photo.id, photo.farm, photo.server, photo.secret, 'm');\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t// See: https://www.flickr.com/services/api/misc.urls.html\n\tfunction createPictures(id, farm, server, secret) {\n\n\t\tvar NO_LIMIT = 2048;\n\t\tvar sizes = [\n\t\t\t{id: 't', max: 100},\n\t\t\t{id: 'm', max: 240},\n\t\t\t{id: 'n', max: 320},\n\t\t\t{id: '', max: 500},\n\t\t\t{id: 'z', max: 640},\n\t\t\t{id: 'c', max: 800},\n\t\t\t{id: 'b', max: 1024},\n\t\t\t{id: 'h', max: 1600},\n\t\t\t{id: 'k', max: 2048},\n\t\t\t{id: 'o', max: NO_LIMIT}\n\t\t];\n\n\t\treturn sizes.map(function(size) {\n\t\t\treturn {\n\t\t\t\tsource: createPhotoUrl(id, farm, server, secret, size.id),\n\n\t\t\t\t// Note: this is a guess that's almost certain to be wrong (unless square source)\n\t\t\t\twidth: size.max,\n\t\t\t\theight: size.max\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction checkResponse(o, key) {\n\n\t\tif (key in o) {\n\t\t\to = o[key];\n\t\t}\n\t\telse if (!('error' in o)) {\n\t\t\to.error = {\n\t\t\t\tcode: 'invalid_request',\n\t\t\t\tmessage: o.message || 'Failed to get data from Flickr'\n\t\t\t};\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o) {\n\t\tformatError(o);\n\t\tif (o.contacts) {\n\t\t\to = checkResponse(o, 'contacts');\n\t\t\tpaging(o);\n\t\t\to.data = o.contact;\n\t\t\tdelete o.contact;\n\t\t\tfor (var i = 0; i < o.data.length; i++) {\n\t\t\t\tvar item = o.data[i];\n\t\t\t\titem.id = item.nsid;\n\t\t\t\titem.name = item.realname || item.username;\n\t\t\t\titem.thumbnail = getBuddyIcon(item, 'm');\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction paging(res) {\n\t\tif (res.page && res.pages && res.page !== res.pages) {\n\t\t\tres.paging = {\n\t\t\t\tnext: '?page=' + (++res.page)\n\t\t\t};\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tfoursquare: {\n\n\t\t\tname: 'Foursquare',\n\n\t\t\toauth: {\n\t\t\t\t// See: https://developer.foursquare.com/overview/auth\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://foursquare.com/oauth2/authenticate',\n\t\t\t\tgrant: 'https://foursquare.com/oauth2/access_token'\n\t\t\t},\n\n\t\t\t// Refresh the access_token once expired\n\t\t\trefresh: true,\n\n\t\t\tbase: 'https://api.foursquare.com/v2/',\n\n\t\t\tget: {\n\t\t\t\tme: 'users/self',\n\t\t\t\t'me/friends': 'users/self/friends',\n\t\t\t\t'me/followers': 'users/self/friends',\n\t\t\t\t'me/following': 'users/self/friends'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tif (o && o.response) {\n\t\t\t\t\t\to = o.response.user;\n\t\t\t\t\t\tformatUser(o);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o) {\n\t\t\t\t\tformatError(o);\n\n\t\t\t\t\t// Format friends\n\t\t\t\t\tif (o && 'response' in o && 'friends' in o.response && 'items' in o.response.friends) {\n\t\t\t\t\t\to.data = o.response.friends.items;\n\t\t\t\t\t\to.data.forEach(formatUser);\n\t\t\t\t\t\tdelete o.response;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: formatRequest,\n\t\t\tjsonp: formatRequest\n\t\t}\n\t});\n\n\tfunction formatError(o) {\n\t\tif (o.meta && (o.meta.code === 400 || o.meta.code === 401)) {\n\t\t\to.error = {\n\t\t\t\tcode: 'access_denied',\n\t\t\t\tmessage: o.meta.errorDetail\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction formatUser(o) {\n\t\tif (o && o.id) {\n\t\t\to.thumbnail = o.photo.prefix + '100x100' + o.photo.suffix;\n\t\t\to.name = o.firstName + ' ' + o.lastName;\n\t\t\to.first_name = o.firstName;\n\t\t\to.last_name = o.lastName;\n\t\t\tif (o.contact) {\n\t\t\t\tif (o.contact.email) {\n\t\t\t\t\to.email = o.contact.email;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction formatRequest(p, qs) {\n\t\tvar token = qs.access_token;\n\t\tdelete qs.access_token;\n\t\tqs.oauth_token = token;\n\t\tqs.v = 20121125;\n\t\treturn true;\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tgithub: {\n\n\t\t\tname: 'GitHub',\n\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://github.com/login/oauth/authorize',\n\t\t\t\tgrant: 'https://github.com/login/oauth/access_token',\n\t\t\t\tresponse_type: 'code'\n\t\t\t},\n\n\t\t\tscope: {\n\t\t\t\temail: 'user:email'\n\t\t\t},\n\n\t\t\tbase: 'https://api.github.com/',\n\n\t\t\tget: {\n\t\t\t\tme: 'user',\n\t\t\t\t'me/friends': 'user/following?per_page=@{limit|100}',\n\t\t\t\t'me/following': 'user/following?per_page=@{limit|100}',\n\t\t\t\t'me/followers': 'user/followers?per_page=@{limit|100}',\n\t\t\t\t'me/like': 'user/starred?per_page=@{limit|100}'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o, headers) {\n\n\t\t\t\t\tformatError(o, headers);\n\t\t\t\t\tformatUser(o);\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o, headers, req) {\n\n\t\t\t\t\tformatError(o, headers);\n\n\t\t\t\t\tif (Array.isArray(o)) {\n\t\t\t\t\t\to = {data:o};\n\t\t\t\t\t}\n\n\t\t\t\t\tif (o.data) {\n\t\t\t\t\t\tpaging(o, headers, req);\n\t\t\t\t\t\to.data.forEach(formatUser);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: function(p) {\n\n\t\t\t\tif (p.method !== 'get' && p.data) {\n\n\t\t\t\t\t// Serialize payload as JSON\n\t\t\t\t\tp.headers = p.headers || {};\n\t\t\t\t\tp.headers['Content-Type'] = 'application/json';\n\t\t\t\t\tif (typeof (p.data) === 'object') {\n\t\t\t\t\t\tp.data = JSON.stringify(p.data);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction formatError(o, headers) {\n\t\tvar code = headers ? headers.statusCode : (o && 'meta' in o && 'status' in o.meta && o.meta.status);\n\t\tif ((code === 401 || code === 403)) {\n\t\t\to.error = {\n\t\t\t\tcode: 'access_denied',\n\t\t\t\tmessage: o.message || (o.data ? o.data.message : 'Could not get response')\n\t\t\t};\n\t\t\tdelete o.message;\n\t\t}\n\t}\n\n\tfunction formatUser(o) {\n\t\tif (o.id) {\n\t\t\to.thumbnail = o.picture = o.avatar_url;\n\t\t\to.name = o.login;\n\t\t}\n\t}\n\n\tfunction paging(res, headers, req) {\n\t\tif (res.data && res.data.length && headers && headers.Link) {\n\t\t\tvar next = headers.Link.match(/<(.*?)>;\\s*rel=\\\"next\\\"/);\n\t\t\tif (next) {\n\t\t\t\tres.paging = {\n\t\t\t\t\tnext: next[1]\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\tvar contactsUrl = 'https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json&max-results=@{limit|1000}&start-index=@{start|1}';\n\n\thello.init({\n\n\t\tgoogle: {\n\n\t\t\tname: 'Google Sign-In',\n\n\t\t\t// See: http://code.google.com/apis/accounts/docs/OAuth2UserAgent.html\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://accounts.google.com/o/oauth2/v2/auth',\n\t\t\t\tgrant: 'https://www.googleapis.com/oauth2/v4/token'\n\t\t\t},\n\n\t\t\t// Authorization scopes\n\t\t\tscope: {\n\t\t\t\tbasic: 'openid profile',\n\t\t\t\temail: 'email',\n\t\t\t\tbirthday: '',\n\t\t\t\tevents: '',\n\t\t\t\tphotos: 'https://picasaweb.google.com/data/',\n\t\t\t\tvideos: 'http://gdata.youtube.com',\n\t\t\t\tfiles: 'https://www.googleapis.com/auth/drive.readonly',\n\t\t\t\tpublish: '',\n\t\t\t\tpublish_files: 'https://www.googleapis.com/auth/drive',\n\t\t\t\tshare: '',\n\t\t\t\tcreate_event: '',\n\t\t\t\toffline_access: ''\n\t\t\t},\n\n\t\t\tscope_delim: ' ',\n\n\t\t\tlogin: function(p) {\n\n\t\t\t\tif (p.qs.response_type === 'code') {\n\n\t\t\t\t\t// Let's set this to an offline access to return a refresh_token\n\t\t\t\t\tp.qs.access_type = 'offline';\n\t\t\t\t}\n\t\t\t\telse if (p.qs.response_type.indexOf('id_token') > -1) {\n\t\t\t\t\tp.qs.nonce = parseInt(Math.random() * 1e12, 10).toString(36);\n\t\t\t\t}\n\n\t\t\t\t// Reauthenticate\n\t\t\t\t// https://developers.google.com/identity/protocols/\n\t\t\t\tif (p.options.force) {\n\t\t\t\t\tp.qs.approval_prompt = 'force';\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// API base URI\n\t\t\tbase: 'https://www.googleapis.com/',\n\n\t\t\t// Map GET requests\n\t\t\tget: {\n\t\t\t\tme: 'oauth2/v3/userinfo?alt=json',\n\n\t\t\t\t// Deprecated Sept 1, 2014\n\t\t\t\t//'me': 'oauth2/v1/userinfo?alt=json',\n\n\t\t\t\t// See: https://developers.google.com/+/api/latest/people/list\n\t\t\t\t'me/following': contactsUrl,\n\t\t\t\t'me/followers': contactsUrl,\n\t\t\t\t'me/contacts': contactsUrl,\n\t\t\t\t'me/albums': 'https://picasaweb.google.com/data/feed/api/user/default?alt=json&max-results=@{limit|100}&start-index=@{start|1}',\n\t\t\t\t'me/album': function(p, callback) {\n\t\t\t\t\tvar key = p.query.id;\n\t\t\t\t\tdelete p.query.id;\n\t\t\t\t\tcallback(key.replace('/entry/', '/feed/'));\n\t\t\t\t},\n\n\t\t\t\t'me/photos': 'https://picasaweb.google.com/data/feed/api/user/default?alt=json&kind=photo&max-results=@{limit|100}&start-index=@{start|1}',\n\n\t\t\t\t// See: https://developers.google.com/drive/v2/reference/files/list\n\t\t\t\t'me/file': 'drive/v2/files/@{id}',\n\t\t\t\t'me/files': 'drive/v2/files?q=%22@{parent|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}',\n\n\t\t\t\t// See: https://developers.google.com/drive/v2/reference/files/list\n\t\t\t\t'me/folders': 'drive/v2/files?q=%22@{id|root}%22+in+parents+and+mimeType+=+%22application/vnd.google-apps.folder%22+and+trashed=false&maxResults=@{limit|100}',\n\n\t\t\t\t// See: https://developers.google.com/drive/v2/reference/files/list\n\t\t\t\t'me/folder': 'drive/v2/files?q=%22@{id|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}'\n\t\t\t},\n\n\t\t\t// Map POST requests\n\t\t\tpost: {\n\n\t\t\t\t// Google Drive\n\t\t\t\t'me/files': uploadDrive,\n\t\t\t\t'me/folders': function(p, callback) {\n\t\t\t\t\tp.data = {\n\t\t\t\t\t\ttitle: p.data.name,\n\t\t\t\t\t\tparents: [{id: p.data.parent || 'root'}],\n\t\t\t\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t\t\t\t};\n\t\t\t\t\tcallback('drive/v2/files');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Map PUT requests\n\t\t\tput: {\n\t\t\t\t'me/files': uploadDrive\n\t\t\t},\n\n\t\t\t// Map DELETE requests\n\t\t\tdel: {\n\t\t\t\t'me/files': 'drive/v2/files/@{id}',\n\t\t\t\t'me/folder': 'drive/v2/files/@{id}'\n\t\t\t},\n\n\t\t\t// Map PATCH requests\n\t\t\tpatch: {\n\t\t\t\t'me/file': 'drive/v2/files/@{id}'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tif (o.sub) {\n\t\t\t\t\t\to.id = o.sub;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (o.id) {\n\t\t\t\t\t\to.last_name = o.family_name || (o.name ? o.name.familyName : null);\n\t\t\t\t\t\to.first_name = o.given_name || (o.name ? o.name.givenName : null);\n\n\t\t\t\t\t\tif (o.emails && o.emails.length) {\n\t\t\t\t\t\t\to.email = o.emails[0].value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tformatPerson(o);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/friends': function(o) {\n\t\t\t\t\tif (o.items) {\n\t\t\t\t\t\tpaging(o);\n\t\t\t\t\t\to.data = o.items;\n\t\t\t\t\t\to.data.forEach(formatPerson);\n\t\t\t\t\t\tdelete o.items;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/contacts': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/share': formatFeed,\n\t\t\t\t'me/feed': formatFeed,\n\t\t\t\t'me/albums': gEntry,\n\t\t\t\t'me/photos': formatPhotos,\n\t\t\t\t'default': gEntry\n\t\t\t},\n\n\t\t\txhr: function(p) {\n\n\t\t\t\tif (p.method === 'post' || p.method === 'put') {\n\t\t\t\t\ttoJSON(p);\n\t\t\t\t}\n\t\t\t\telse if (p.method === 'patch') {\n\t\t\t\t\thello.utils.extend(p.query, p.data);\n\t\t\t\t\tp.data = null;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\t// Don't even try submitting via form.\n\t\t\t// This means no POST operations in <=IE9\n\t\t\tform: false\n\t\t}\n\t});\n\n\tfunction toInt(s) {\n\t\treturn parseInt(s, 10);\n\t}\n\n\tfunction formatFeed(o) {\n\t\tpaging(o);\n\t\to.data = o.items;\n\t\tdelete o.items;\n\t\treturn o;\n\t}\n\n\t// Format: ensure each record contains a name, id etc.\n\tfunction formatItem(o) {\n\t\tif (o.error) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!o.name) {\n\t\t\to.name = o.title || o.message;\n\t\t}\n\n\t\tif (!o.picture) {\n\t\t\to.picture = o.thumbnailLink;\n\t\t}\n\n\t\tif (!o.thumbnail) {\n\t\t\to.thumbnail = o.thumbnailLink;\n\t\t}\n\n\t\tif (o.mimeType === 'application/vnd.google-apps.folder') {\n\t\t\to.type = 'folder';\n\t\t\to.files = 'https://www.googleapis.com/drive/v2/files?q=%22' + o.id + '%22+in+parents';\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatImage(image) {\n\t\treturn {\n\t\t\tsource: image.url,\n\t\t\twidth: image.width,\n\t\t\theight: image.height\n\t\t};\n\t}\n\n\tfunction formatPhotos(o) {\n\t\tif ('feed' in o) {\n\t\t\to.data = 'entry' in o.feed ? o.feed.entry.map(formatEntry) : [];\n\t\t\tdelete o.feed;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t// Google has a horrible JSON API\n\tfunction gEntry(o) {\n\t\tpaging(o);\n\n\t\tif ('feed' in o && 'entry' in o.feed) {\n\t\t\to.data = o.feed.entry.map(formatEntry);\n\t\t\tdelete o.feed;\n\t\t}\n\n\t\t// Old style: Picasa, etc.\n\t\telse if ('entry' in o) {\n\t\t\treturn formatEntry(o.entry);\n\t\t}\n\n\t\t// New style: Google Drive\n\t\telse if ('items' in o) {\n\t\t\to.data = o.items.map(formatItem);\n\t\t\tdelete o.items;\n\t\t}\n\t\telse {\n\t\t\tformatItem(o);\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatPerson(o) {\n\t\to.name = o.displayName || o.name;\n\t\to.picture = o.picture || (o.image ? o.image.url : null);\n\t\to.thumbnail = o.picture;\n\t}\n\n\tfunction formatFriends(o, headers, req) {\n\t\tpaging(o);\n\t\tvar r = [];\n\t\tif ('feed' in o && 'entry' in o.feed) {\n\t\t\tvar token = req.query.access_token;\n\t\t\tfor (var i = 0; i < o.feed.entry.length; i++) {\n\t\t\t\tvar a = o.feed.entry[i];\n\n\t\t\t\ta.id\t= a.id.$t;\n\t\t\t\ta.name\t= a.title.$t;\n\t\t\t\tdelete a.title;\n\t\t\t\tif (a.gd$email) {\n\t\t\t\t\ta.email\t= (a.gd$email && a.gd$email.length > 0) ? a.gd$email[0].address : null;\n\t\t\t\t\ta.emails = a.gd$email;\n\t\t\t\t\tdelete a.gd$email;\n\t\t\t\t}\n\n\t\t\t\tif (a.updated) {\n\t\t\t\t\ta.updated = a.updated.$t;\n\t\t\t\t}\n\n\t\t\t\tif (a.link) {\n\n\t\t\t\t\tvar pic = (a.link.length > 0) ? a.link[0].href : null;\n\t\t\t\t\tif (pic && a.link[0].gd$etag) {\n\t\t\t\t\t\tpic += (pic.indexOf('?') > -1 ? '&' : '?') + 'access_token=' + token;\n\t\t\t\t\t\ta.picture = pic;\n\t\t\t\t\t\ta.thumbnail = pic;\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete a.link;\n\t\t\t\t}\n\n\t\t\t\tif (a.category) {\n\t\t\t\t\tdelete a.category;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\to.data = o.feed.entry;\n\t\t\tdelete o.feed;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatEntry(a) {\n\n\t\tvar group = a.media$group;\n\t\tvar photo = group.media$content.length ? group.media$content[0] : {};\n\t\tvar mediaContent = group.media$content || [];\n\t\tvar mediaThumbnail = group.media$thumbnail || [];\n\n\t\tvar pictures = mediaContent\n\t\t\t.concat(mediaThumbnail)\n\t\t\t.map(formatImage)\n\t\t\t.sort(function(a, b) {\n\t\t\t\treturn a.width - b.width;\n\t\t\t});\n\n\t\tvar i = 0;\n\t\tvar _a;\n\t\tvar p = {\n\t\t\tid: a.id.$t,\n\t\t\tname: a.title.$t,\n\t\t\tdescription: a.summary.$t,\n\t\t\tupdated_time: a.updated.$t,\n\t\t\tcreated_time: a.published.$t,\n\t\t\tpicture: photo ? photo.url : null,\n\t\t\tpictures: pictures,\n\t\t\timages: [],\n\t\t\tthumbnail: photo ? photo.url : null,\n\t\t\twidth: photo.width,\n\t\t\theight: photo.height\n\t\t};\n\n\t\t// Get feed/children\n\t\tif ('link' in a) {\n\t\t\tfor (i = 0; i < a.link.length; i++) {\n\t\t\t\tvar d = a.link[i];\n\t\t\t\tif (d.rel.match(/\\#feed$/)) {\n\t\t\t\t\tp.upload_location = p.files = p.photos = d.href;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Get images of different scales\n\t\tif ('category' in a && a.category.length) {\n\t\t\t_a = a.category;\n\t\t\tfor (i = 0; i < _a.length; i++) {\n\t\t\t\tif (_a[i].scheme && _a[i].scheme.match(/\\#kind$/)) {\n\t\t\t\t\tp.type = _a[i].term.replace(/^.*?\\#/, '');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Get images of different scales\n\t\tif ('media$thumbnail' in group && group.media$thumbnail.length) {\n\t\t\t_a = group.media$thumbnail;\n\t\t\tp.thumbnail = _a[0].url;\n\t\t\tp.images = _a.map(formatImage);\n\t\t}\n\n\t\t_a = group.media$content;\n\n\t\tif (_a && _a.length) {\n\t\t\tp.images.push(formatImage(_a[0]));\n\t\t}\n\n\t\treturn p;\n\t}\n\n\tfunction paging(res) {\n\n\t\t// Contacts V2\n\t\tif ('feed' in res && res.feed.openSearch$itemsPerPage) {\n\t\t\tvar limit = toInt(res.feed.openSearch$itemsPerPage.$t);\n\t\t\tvar start = toInt(res.feed.openSearch$startIndex.$t);\n\t\t\tvar total = toInt(res.feed.openSearch$totalResults.$t);\n\n\t\t\tif ((start + limit) < total) {\n\t\t\t\tres.paging = {\n\t\t\t\t\tnext: '?start=' + (start + limit)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\telse if ('nextPageToken' in res) {\n\t\t\tres.paging = {\n\t\t\t\tnext: '?pageToken=' + res.nextPageToken\n\t\t\t};\n\t\t}\n\t}\n\n\t// Construct a multipart message\n\tfunction Multipart() {\n\n\t\t// Internal body\n\t\tvar body = [];\n\t\tvar boundary = (Math.random() * 1e10).toString(32);\n\t\tvar counter = 0;\n\t\tvar lineBreak = '\\r\\n';\n\t\tvar delim = lineBreak + '--' + boundary;\n\t\tvar ready = function() {};\n\n\t\tvar dataUri = /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i;\n\n\t\t// Add file\n\t\tfunction addFile(item) {\n\t\t\tvar fr = new FileReader();\n\t\t\tfr.onload = function(e) {\n\t\t\t\taddContent(btoa(e.target.result), item.type + lineBreak + 'Content-Transfer-Encoding: base64');\n\t\t\t};\n\n\t\t\tfr.readAsBinaryString(item);\n\t\t}\n\n\t\t// Add content\n\t\tfunction addContent(content, type) {\n\t\t\tbody.push(lineBreak + 'Content-Type: ' + type + lineBreak + lineBreak + content);\n\t\t\tcounter--;\n\t\t\tready();\n\t\t}\n\n\t\t// Add new things to the object\n\t\tthis.append = function(content, type) {\n\n\t\t\t// Does the content have an array\n\t\t\tif (typeof (content) === 'string' || !('length' in Object(content))) {\n\t\t\t\t// Converti to multiples\n\t\t\t\tcontent = [content];\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < content.length; i++) {\n\n\t\t\t\tcounter++;\n\n\t\t\t\tvar item = content[i];\n\n\t\t\t\t// Is this a file?\n\t\t\t\t// Files can be either Blobs or File types\n\t\t\t\tif (\n\t\t\t\t\t(typeof (File) !== 'undefined' && item instanceof File) ||\n\t\t\t\t\t(typeof (Blob) !== 'undefined' && item instanceof Blob)\n\t\t\t\t) {\n\t\t\t\t\t// Read the file in\n\t\t\t\t\taddFile(item);\n\t\t\t\t}\n\n\t\t\t\t// Data-URI?\n\t\t\t\t// Data:[<mime type>][;charset=<charset>][;base64],<encoded data>\n\t\t\t\t// /^data\\:([^;,]+(\\;charset=[^;,]+)?)(\\;base64)?,/i\n\t\t\t\telse if (typeof (item) === 'string' && item.match(dataUri)) {\n\t\t\t\t\tvar m = item.match(dataUri);\n\t\t\t\t\taddContent(item.replace(dataUri, ''), m[1] + lineBreak + 'Content-Transfer-Encoding: base64');\n\t\t\t\t}\n\n\t\t\t\t// Regular string\n\t\t\t\telse {\n\t\t\t\t\taddContent(item, type);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.onready = function(fn) {\n\t\t\tready = function() {\n\t\t\t\tif (counter === 0) {\n\t\t\t\t\t// Trigger ready\n\t\t\t\t\tbody.unshift('');\n\t\t\t\t\tbody.push('--');\n\t\t\t\t\tfn(body.join(delim), boundary);\n\t\t\t\t\tbody = [];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tready();\n\t\t};\n\t}\n\n\t// Upload to Drive\n\t// If this is PUT then only augment the file uploaded\n\t// PUT https://developers.google.com/drive/v2/reference/files/update\n\t// POST https://developers.google.com/drive/manage-uploads\n\tfunction uploadDrive(p, callback) {\n\n\t\tvar data = {};\n\n\t\t// Test for DOM element\n\t\tif (p.data &&\n\t\t\t(typeof (HTMLInputElement) !== 'undefined' && p.data instanceof HTMLInputElement)\n\t\t) {\n\t\t\tp.data = {file: p.data};\n\t\t}\n\n\t\tif (!p.data.name && Object(Object(p.data.file).files).length && p.method === 'post') {\n\t\t\tp.data.name = p.data.file.files[0].name;\n\t\t}\n\n\t\tif (p.method === 'post') {\n\t\t\tp.data = {\n\t\t\t\ttitle: p.data.name,\n\t\t\t\tparents: [{id: p.data.parent || 'root'}],\n\t\t\t\tfile: p.data.file\n\t\t\t};\n\t\t}\n\t\telse {\n\n\t\t\t// Make a reference\n\t\t\tdata = p.data;\n\t\t\tp.data = {};\n\n\t\t\t// Add the parts to change as required\n\t\t\tif (data.parent) {\n\t\t\t\tp.data.parents = [{id: p.data.parent || 'root'}];\n\t\t\t}\n\n\t\t\tif (data.file) {\n\t\t\t\tp.data.file = data.file;\n\t\t\t}\n\n\t\t\tif (data.name) {\n\t\t\t\tp.data.title = data.name;\n\t\t\t}\n\t\t}\n\n\t\t// Extract the file, if it exists from the data object\n\t\t// If the File is an INPUT element lets just concern ourselves with the NodeList\n\t\tvar file;\n\t\tif ('file' in p.data) {\n\t\t\tfile = p.data.file;\n\t\t\tdelete p.data.file;\n\n\t\t\tif (typeof (file) === 'object' && 'files' in file) {\n\t\t\t\t// Assign the NodeList\n\t\t\t\tfile = file.files;\n\t\t\t}\n\n\t\t\tif (!file || !file.length) {\n\t\t\t\tcallback({\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: 'request_invalid',\n\t\t\t\t\t\tmessage: 'There were no files attached with this request to upload'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Set type p.data.mimeType = Object(file[0]).type || 'application/octet-stream';\n\n\t\t// Construct a multipart message\n\t\tvar parts = new Multipart();\n\t\tparts.append(JSON.stringify(p.data), 'application/json');\n\n\t\t// Read the file into a  base64 string... yep a hassle, i know\n\t\t// FormData doesn't let us assign our own Multipart headers and HTTP Content-Type\n\t\t// Alas GoogleApi need these in a particular format\n\t\tif (file) {\n\t\t\tparts.append(file);\n\t\t}\n\n\t\tparts.onready(function(body, boundary) {\n\n\t\t\tp.headers['content-type'] = 'multipart/related; boundary=\"' + boundary + '\"';\n\t\t\tp.data = body;\n\n\t\t\tcallback('upload/drive/v2/files' + (data.id ? '/' + data.id : '') + '?uploadType=multipart');\n\t\t});\n\n\t}\n\n\tfunction toJSON(p) {\n\t\tif (typeof (p.data) === 'object') {\n\t\t\t// Convert the POST into a javascript object\n\t\t\ttry {\n\t\t\t\tp.data = JSON.stringify(p.data);\n\t\t\t\tp.headers['content-type'] = 'application/json';\n\t\t\t}\n\t\t\tcatch (e) {}\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tinstagram: {\n\n\t\t\tname: 'Instagram',\n\n\t\t\toauth: {\n\t\t\t\t// See: http://instagram.com/developer/authentication/\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://instagram.com/oauth/authorize/',\n\t\t\t\tgrant: 'https://api.instagram.com/oauth/access_token'\n\t\t\t},\n\n\t\t\t// Refresh the access_token once expired\n\t\t\trefresh: true,\n\n\t\t\tscope: {\n\t\t\t\tbasic: 'basic',\n\t\t\t\tphotos: '',\n\t\t\t\tfriends: 'relationships',\n\t\t\t\tpublish: 'likes comments',\n\t\t\t\temail: '',\n\t\t\t\tshare: '',\n\t\t\t\tpublish_files: '',\n\t\t\t\tfiles: '',\n\t\t\t\tvideos: '',\n\t\t\t\toffline_access: ''\n\t\t\t},\n\n\t\t\tscope_delim: ' ',\n\n\t\t\tbase: 'https://api.instagram.com/v1/',\n\n\t\t\tget: {\n\t\t\t\tme: 'users/self',\n\t\t\t\t'me/feed': 'users/self/feed?count=@{limit|100}',\n\t\t\t\t'me/photos': 'users/self/media/recent?min_id=0&count=@{limit|100}',\n\t\t\t\t'me/friends': 'users/self/follows?count=@{limit|100}',\n\t\t\t\t'me/following': 'users/self/follows?count=@{limit|100}',\n\t\t\t\t'me/followers': 'users/self/followed-by?count=@{limit|100}',\n\t\t\t\t'friend/photos': 'users/@{id}/media/recent?min_id=0&count=@{limit|100}'\n\t\t\t},\n\n\t\t\tpost: {\n\t\t\t\t'me/like': function(p, callback) {\n\t\t\t\t\tvar id = p.data.id;\n\t\t\t\t\tp.data = {};\n\t\t\t\t\tcallback('media/' + id + '/likes');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdel: {\n\t\t\t\t'me/like': 'media/@{id}/likes'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\n\t\t\t\t\tformatError(o);\n\n\t\t\t\t\tif ('data' in o) {\n\t\t\t\t\t\to.id = o.data.id;\n\t\t\t\t\t\to.thumbnail = o.data.profile_picture;\n\t\t\t\t\t\to.name = o.data.full_name || o.data.username;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/photos': function(o) {\n\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tpaging(o);\n\n\t\t\t\t\tif ('data' in o) {\n\t\t\t\t\t\to.data = o.data.filter(function(d) {\n\t\t\t\t\t\t\treturn d.type === 'image';\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\to.data.forEach(function(d) {\n\t\t\t\t\t\t\td.name = d.caption ? d.caption.text : null;\n\t\t\t\t\t\t\td.thumbnail = d.images.thumbnail.url;\n\t\t\t\t\t\t\td.picture = d.images.standard_resolution.url;\n\t\t\t\t\t\t\td.pictures = Object.keys(d.images)\n\t\t\t\t\t\t\t\t.map(function(key) {\n\t\t\t\t\t\t\t\t\tvar image = d.images[key];\n\t\t\t\t\t\t\t\t\treturn formatImage(image);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.sort(function(a, b) {\n\t\t\t\t\t\t\t\t\treturn a.width - b.width;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o) {\n\t\t\t\t\to = formatError(o);\n\t\t\t\t\tpaging(o);\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Instagram does not return any CORS Headers\n\t\t\t// So besides JSONP we're stuck with proxy\n\t\t\txhr: function(p, qs) {\n\n\t\t\t\tvar method = p.method;\n\t\t\t\tvar proxy = method !== 'get';\n\n\t\t\t\tif (proxy) {\n\n\t\t\t\t\tif ((method === 'post' || method === 'put') && p.query.access_token) {\n\t\t\t\t\t\tp.data.access_token = p.query.access_token;\n\t\t\t\t\t\tdelete p.query.access_token;\n\t\t\t\t\t}\n\n\t\t\t\t\t// No access control headers\n\t\t\t\t\t// Use the proxy instead\n\t\t\t\t\tp.proxy = proxy;\n\t\t\t\t}\n\n\t\t\t\treturn proxy;\n\t\t\t},\n\n\t\t\t// No form\n\t\t\tform: false\n\t\t}\n\t});\n\n\tfunction formatImage(image) {\n\t\treturn {\n\t\t\tsource: image.url,\n\t\t\twidth: image.width,\n\t\t\theight: image.height\n\t\t};\n\t}\n\n\tfunction formatError(o) {\n\t\tif (typeof o === 'string') {\n\t\t\treturn {\n\t\t\t\terror: {\n\t\t\t\t\tcode: 'invalid_request',\n\t\t\t\t\tmessage: o\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (o && 'meta' in o && 'error_type' in o.meta) {\n\t\t\to.error = {\n\t\t\t\tcode: o.meta.error_type,\n\t\t\t\tmessage: o.meta.error_message\n\t\t\t};\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o) {\n\t\tpaging(o);\n\t\tif (o && 'data' in o) {\n\t\t\to.data.forEach(formatFriend);\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriend(o) {\n\t\tif (o.id) {\n\t\t\to.thumbnail = o.profile_picture;\n\t\t\to.name = o.full_name || o.username;\n\t\t}\n\t}\n\n\t// See: http://instagram.com/developer/endpoints/\n\tfunction paging(res) {\n\t\tif ('pagination' in res) {\n\t\t\tres.paging = {\n\t\t\t\tnext: res.pagination.next_url\n\t\t\t};\n\t\t\tdelete res.pagination;\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tjoinme: {\n\n\t\t\tname: 'join.me',\n\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://secure.join.me/api/public/v1/auth/oauth2',\n\t\t\t\tgrant: 'https://secure.join.me/api/public/v1/auth/oauth2'\n\t\t\t},\n\n\t\t\trefresh: false,\n\n\t\t\tscope: {\n\t\t\t\tbasic: 'user_info',\n\t\t\t\tuser: 'user_info',\n\t\t\t\tscheduler: 'scheduler',\n\t\t\t\tstart: 'start_meeting',\n\t\t\t\temail: '',\n\t\t\t\tfriends: '',\n\t\t\t\tshare: '',\n\t\t\t\tpublish: '',\n\t\t\t\tphotos: '',\n\t\t\t\tpublish_files: '',\n\t\t\t\tfiles: '',\n\t\t\t\tvideos: '',\n\t\t\t\toffline_access: ''\n\t\t\t},\n\n\t\t\tscope_delim: ' ',\n\n\t\t\tlogin: function(p) {\n\t\t\t\tp.options.popup.width = 400;\n\t\t\t\tp.options.popup.height = 700;\n\t\t\t},\n\n\t\t\tbase: 'https://api.join.me/v1/',\n\n\t\t\tget: {\n\t\t\t\tme: 'user',\n\t\t\t\tmeetings: 'meetings',\n\t\t\t\t'meetings/info': 'meetings/@{id}'\n\t\t\t},\n\n\t\t\tpost: {\n\t\t\t\t'meetings/start/adhoc': function(p, callback) {\n\t\t\t\t\tcallback('meetings/start');\n\t\t\t\t},\n\n\t\t\t\t'meetings/start/scheduled': function(p, callback) {\n\t\t\t\t\tvar meetingId = p.data.meetingId;\n\t\t\t\t\tp.data = {};\n\t\t\t\t\tcallback('meetings/' + meetingId + '/start');\n\t\t\t\t},\n\n\t\t\t\t'meetings/schedule': function(p, callback) {\n\t\t\t\t\tcallback('meetings');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tpatch: {\n\t\t\t\t'meetings/update': function(p, callback) {\n\t\t\t\t\tcallback('meetings/' + p.data.meetingId);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdel: {\n\t\t\t\t'meetings/delete': 'meetings/@{id}'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o, headers) {\n\t\t\t\t\tformatError(o, headers);\n\n\t\t\t\t\tif (!o.email) {\n\t\t\t\t\t\treturn o;\n\t\t\t\t\t}\n\n\t\t\t\t\to.name = o.fullName;\n\t\t\t\t\to.first_name = o.name.split(' ')[0];\n\t\t\t\t\to.last_name = o.name.split(' ')[1];\n\t\t\t\t\to.id = o.email;\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o, headers) {\n\t\t\t\t\tformatError(o, headers);\n\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: formatRequest\n\n\t\t}\n\t});\n\n\tfunction formatError(o, headers) {\n\t\tvar errorCode;\n\t\tvar message;\n\t\tvar details;\n\n\t\tif (o && ('Message' in o)) {\n\t\t\tmessage = o.Message;\n\t\t\tdelete o.Message;\n\n\t\t\tif ('ErrorCode' in o) {\n\t\t\t\terrorCode = o.ErrorCode;\n\t\t\t\tdelete o.ErrorCode;\n\t\t\t}\n\t\t\telse {\n\t\t\t\terrorCode = getErrorCode(headers);\n\t\t\t}\n\n\t\t\to.error = {\n\t\t\t\tcode: errorCode,\n\t\t\t\tmessage: message,\n\t\t\t\tdetails: o\n\t\t\t};\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatRequest(p, qs) {\n\t\t// Move the access token from the request body to the request header\n\t\tvar token = qs.access_token;\n\t\tdelete qs.access_token;\n\t\tp.headers.Authorization = 'Bearer ' + token;\n\n\t\t// Format non-get requests to indicate json body\n\t\tif (p.method !== 'get' && p.data) {\n\t\t\tp.headers['Content-Type'] = 'application/json';\n\t\t\tif (typeof (p.data) === 'object') {\n\t\t\t\tp.data = JSON.stringify(p.data);\n\t\t\t}\n\t\t}\n\n\t\tif (p.method === 'put') {\n\t\t\tp.method = 'patch';\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction getErrorCode(headers) {\n\t\tswitch (headers.statusCode) {\n\t\t\tcase 400:\n\t\t\t\treturn 'invalid_request';\n\t\t\tcase 403:\n\t\t\t\treturn 'stale_token';\n\t\t\tcase 401:\n\t\t\t\treturn 'invalid_token';\n\t\t\tcase 500:\n\t\t\t\treturn 'server_error';\n\t\t\tdefault:\n\t\t\t\treturn 'server_error';\n\t\t}\n\t}\n\n}(hello));\n\n(function(hello) {\n\n\thello.init({\n\n\t\tlinkedin: {\n\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tresponse_type: 'code',\n\t\t\t\tauth: 'https://www.linkedin.com/uas/oauth2/authorization',\n\t\t\t\tgrant: 'https://www.linkedin.com/uas/oauth2/accessToken'\n\t\t\t},\n\n\t\t\t// Refresh the access_token once expired\n\t\t\trefresh: true,\n\n\t\t\tscope: {\n\t\t\t\tbasic: 'r_basicprofile',\n\t\t\t\temail: 'r_emailaddress',\n\t\t\t\tfiles: '',\n\t\t\t\tfriends: '',\n\t\t\t\tphotos: '',\n\t\t\t\tpublish: 'w_share',\n\t\t\t\tpublish_files: 'w_share',\n\t\t\t\tshare: '',\n\t\t\t\tvideos: '',\n\t\t\t\toffline_access: ''\n\t\t\t},\n\t\t\tscope_delim: ' ',\n\n\t\t\tbase: 'https://api.linkedin.com/v1/',\n\n\t\t\tget: {\n\t\t\t\tme: 'people/~:(picture-url,first-name,last-name,id,formatted-name,email-address)',\n\n\t\t\t\t// See: http://developer.linkedin.com/documents/get-network-updates-and-statistics-api\n\t\t\t\t'me/share': 'people/~/network/updates?count=@{limit|250}'\n\t\t\t},\n\n\t\t\tpost: {\n\n\t\t\t\t// See: https://developer.linkedin.com/documents/api-requests-json\n\t\t\t\t'me/share': function(p, callback) {\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\tvisibility: {\n\t\t\t\t\t\t\tcode: 'anyone'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (p.data.id) {\n\n\t\t\t\t\t\tdata.attribution = {\n\t\t\t\t\t\t\tshare: {\n\t\t\t\t\t\t\t\tid: p.data.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdata.comment = p.data.message;\n\t\t\t\t\t\tif (p.data.picture && p.data.link) {\n\t\t\t\t\t\t\tdata.content = {\n\t\t\t\t\t\t\t\t'submitted-url': p.data.link,\n\t\t\t\t\t\t\t\t'submitted-image-url': p.data.picture\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tp.data = JSON.stringify(data);\n\n\t\t\t\t\tcallback('people/~/shares?format=json');\n\t\t\t\t},\n\n\t\t\t\t'me/like': like\n\t\t\t},\n\n\t\t\tdel:{\n\t\t\t\t'me/like': like\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tformatUser(o);\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/share': function(o) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tpaging(o);\n\t\t\t\t\tif (o.values) {\n\t\t\t\t\t\to.data = o.values.map(formatUser);\n\t\t\t\t\t\to.data.forEach(function(item) {\n\t\t\t\t\t\t\titem.message = item.headline;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdelete o.values;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o, headers) {\n\t\t\t\t\tformatError(o);\n\t\t\t\t\tempty(o, headers);\n\t\t\t\t\tpaging(o);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tjsonp: function(p, qs) {\n\t\t\t\tformatQuery(qs);\n\t\t\t\tif (p.method === 'get') {\n\t\t\t\t\tqs.format = 'jsonp';\n\t\t\t\t\tqs['error-callback'] = p.callbackID;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: function(p, qs) {\n\t\t\t\tif (p.method !== 'get') {\n\t\t\t\t\tformatQuery(qs);\n\t\t\t\t\tp.headers['Content-Type'] = 'application/json';\n\n\t\t\t\t\t// Note: x-li-format ensures error responses are not returned in XML\n\t\t\t\t\tp.headers['x-li-format'] = 'json';\n\t\t\t\t\tp.proxy = true;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction formatError(o) {\n\t\tif (o && 'errorCode' in o) {\n\t\t\to.error = {\n\t\t\t\tcode: o.status,\n\t\t\t\tmessage: o.message\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction formatUser(o) {\n\t\tif (o.error) {\n\t\t\treturn;\n\t\t}\n\n\t\to.first_name = o.firstName;\n\t\to.last_name = o.lastName;\n\t\to.name = o.formattedName || (o.first_name + ' ' + o.last_name);\n\t\to.thumbnail = o.pictureUrl;\n\t\to.email = o.emailAddress;\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o) {\n\t\tformatError(o);\n\t\tpaging(o);\n\t\tif (o.values) {\n\t\t\to.data = o.values.map(formatUser);\n\t\t\tdelete o.values;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction paging(res) {\n\t\tif ('_count' in res && '_start' in res && (res._count + res._start) < res._total) {\n\t\t\tres.paging = {\n\t\t\t\tnext: '?start=' + (res._start + res._count) + '&count=' + res._count\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction empty(o, headers) {\n\t\tif (JSON.stringify(o) === '{}' && headers.statusCode === 200) {\n\t\t\to.success = true;\n\t\t}\n\t}\n\n\tfunction formatQuery(qs) {\n\t\t// LinkedIn signs requests with the parameter 'oauth2_access_token'\n\t\t// ... yeah another one who thinks they should be different!\n\t\tif (qs.access_token) {\n\t\t\tqs.oauth2_access_token = qs.access_token;\n\t\t\tdelete qs.access_token;\n\t\t}\n\t}\n\n\tfunction like(p, callback) {\n\t\tp.headers['x-li-format'] = 'json';\n\t\tvar id = p.data.id;\n\t\tp.data = (p.method !== 'delete').toString();\n\t\tp.method = 'put';\n\t\tcallback('people/~/network/updates/key=' + id + '/is-liked');\n\t}\n\n})(hello);\n\n// See: https://developers.soundcloud.com/docs/api/reference\n(function(hello) {\n\n\thello.init({\n\n\t\tsoundcloud: {\n\t\t\tname: 'SoundCloud',\n\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://soundcloud.com/connect',\n\t\t\t\tgrant: 'https://soundcloud.com/oauth2/token'\n\t\t\t},\n\n\t\t\t// Request path translated\n\t\t\tbase: 'https://api.soundcloud.com/',\n\t\t\tget: {\n\t\t\t\tme: 'me.json',\n\n\t\t\t\t// Http://developers.soundcloud.com/docs/api/reference#me\n\t\t\t\t'me/friends': 'me/followings.json',\n\t\t\t\t'me/followers': 'me/followers.json',\n\t\t\t\t'me/following': 'me/followings.json',\n\n\t\t\t\t// See: http://developers.soundcloud.com/docs/api/reference#activities\n\t\t\t\t'default': function(p, callback) {\n\n\t\t\t\t\t// Include '.json at the end of each request'\n\t\t\t\t\tcallback(p.path + '.json');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Response handlers\n\t\t\twrap: {\n\t\t\t\tme: function(o) {\n\t\t\t\t\tformatUser(o);\n\t\t\t\t\treturn o;\n\t\t\t\t},\n\n\t\t\t\t'default': function(o) {\n\t\t\t\t\tif (Array.isArray(o)) {\n\t\t\t\t\t\to = {\n\t\t\t\t\t\t\tdata: o.map(formatUser)\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tpaging(o);\n\t\t\t\t\treturn o;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\txhr: formatRequest,\n\t\t\tjsonp: formatRequest\n\t\t}\n\t});\n\n\tfunction formatRequest(p, qs) {\n\t\t// Alter the querystring\n\t\tvar token = qs.access_token;\n\t\tdelete qs.access_token;\n\t\tqs.oauth_token = token;\n\t\tqs['_status_code_map[302]'] = 200;\n\t\treturn true;\n\t}\n\n\tfunction formatUser(o) {\n\t\tif (o.id) {\n\t\t\to.picture = o.avatar_url;\n\t\t\to.thumbnail = o.avatar_url;\n\t\t\to.name = o.username || o.full_name;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t// See: http://developers.soundcloud.com/docs/api/reference#activities\n\tfunction paging(res) {\n\t\tif ('next_href' in res) {\n\t\t\tres.paging = {\n\t\t\t\tnext: res.next_href\n\t\t\t};\n\t\t}\n\t}\n\n})(hello);\n\n// See: https://developer.spotify.com/web-api/\n(function(hello) {\n\n\thello.init({\n\n\t\tspotify: {\n\t\t\tname: 'Spotify',\n\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://accounts.spotify.com/authorize',\n\t\t\t\tgrant: 'https://accounts.spotify.com/api/token'\n\t\t\t},\n\n\t\t\t// See: https://developer.spotify.com/web-api/using-scopes/\n\t\t\tscope_delim: ' ',\n\t\t\tscope: {\n\t\t\t\tbasic: '',\n\t\t\t\tphotos: '',\n\t\t\t\tfriends: 'user-follow-read',\n\t\t\t\tpublish: 'user-library-read',\n\t\t\t\temail: 'user-read-email',\n\t\t\t\tshare: '',\n\t\t\t\tpublish_files: '',\n\t\t\t\tfiles: '',\n\t\t\t\tvideos: '',\n\t\t\t\toffline_access: ''\n\t\t\t},\n\n\t\t\t// Request path translated\n\t\t\tbase: 'https://api.spotify.com',\n\n\t\t\t// See: https://developer.spotify.com/web-api/endpoint-reference/\n\t\t\tget: {\n\t\t\t\tme: '/v1/me',\n\t\t\t\t'me/following': '/v1/me/following?type=artist', // Only 'artist' is supported\n\n\t\t\t\t// Because tracks, albums and playlist exist on spotify, the tracks are considered\n\t\t\t\t// the resource for the 'me/likes' endpoint\n\t\t\t\t'me/like': '/v1/me/tracks'\n\t\t\t},\n\n\t\t\t// Response handlers\n\t\t\twrap: {\n\t\t\t\tme: formatUser,\n\t\t\t\t'me/following': formatFollowees,\n\t\t\t\t'me/like': formatTracks\n\t\t\t},\n\n\t\t\txhr: formatRequest,\n\t\t\tjsonp: false\n\t\t}\n\t});\n\n\t// Move the access token from the request body to the request header\n\tfunction formatRequest(p, qs) {\n\t\tvar token = qs.access_token;\n\t\tdelete qs.access_token;\n\t\tp.headers.Authorization = 'Bearer ' + token;\n\n\t\treturn true;\n\t}\n\n\tfunction formatUser(o) {\n\t\tif (o.id) {\n\t\t\to.name = o.display_name;\n\t\t\to.thumbnail = o.images.length ? o.images[0].url : null;\n\t\t\to.picture = o.thumbnail;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFollowees(o) {\n\t\tpaging(o);\n\t\tif (o && 'artists' in o) {\n\t\t\to.data = o.artists.items.forEach(formatUser);\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatTracks(o) {\n\t\tpaging(o);\n\t\to.data = o.items;\n\n\t\treturn o;\n\t}\n\n\tfunction paging(res) {\n\t\tif (res && 'next' in res) {\n\t\t\tres.paging = {\n\t\t\t\tnext: res.next\n\t\t\t};\n\t\t\tdelete res.next;\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\tvar base = 'https://api.twitter.com/';\n\n\thello.init({\n\n\t\ttwitter: {\n\n\t\t\t// Ensure that you define an oauth_proxy\n\t\t\toauth: {\n\t\t\t\tversion: '1.0a',\n\t\t\t\tauth: base + 'oauth/authenticate',\n\t\t\t\trequest: base + 'oauth/request_token',\n\t\t\t\ttoken: base + 'oauth/access_token'\n\t\t\t},\n\n\t\t\tlogin: function(p) {\n\t\t\t\t// Reauthenticate\n\t\t\t\t// https://dev.twitter.com/oauth/reference/get/oauth/authenticate\n\t\t\t\tvar prefix = '?force_login=true';\n\t\t\t\tthis.oauth.auth = this.oauth.auth.replace(prefix, '') + (p.options.force ? prefix : '');\n\t\t\t},\n\n\t\t\tbase: base + '1.1/',\n\n\t\t\tget: {\n\t\t\t\tme: 'account/verify_credentials.json',\n\t\t\t\t'me/friends': 'friends/list.json?count=@{limit|200}',\n\t\t\t\t'me/following': 'friends/list.json?count=@{limit|200}',\n\t\t\t\t'me/followers': 'followers/list.json?count=@{limit|200}',\n\n\t\t\t\t// Https://dev.twitter.com/docs/api/1.1/get/statuses/user_timeline\n\t\t\t\t'me/share': 'statuses/user_timeline.json?count=@{limit|200}',\n\n\t\t\t\t// Https://dev.twitter.com/rest/reference/get/favorites/list\n\t\t\t\t'me/like': 'favorites/list.json?count=@{limit|200}'\n\t\t\t},\n\n\t\t\tpost: {\n\t\t\t\t'me/share': function(p, callback) {\n\n\t\t\t\t\tvar data = p.data;\n\t\t\t\t\tp.data = null;\n\n\t\t\t\t\tvar status = [];\n\n\t\t\t\t\t// Change message to status\n\t\t\t\t\tif (data.message) {\n\t\t\t\t\t\tstatus.push(data.message);\n\t\t\t\t\t\tdelete data.message;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If link is given\n\t\t\t\t\tif (data.link) {\n\t\t\t\t\t\tstatus.push(data.link);\n\t\t\t\t\t\tdelete data.link;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.picture) {\n\t\t\t\t\t\tstatus.push(data.picture);\n\t\t\t\t\t\tdelete data.picture;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compound all the components\n\t\t\t\t\tif (status.length) {\n\t\t\t\t\t\tdata.status = status.join(' ');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Tweet media\n\t\t\t\t\tif (data.file) {\n\t\t\t\t\t\tdata['media[]'] = data.file;\n\t\t\t\t\t\tdelete data.file;\n\t\t\t\t\t\tp.data = data;\n\t\t\t\t\t\tcallback('statuses/update_with_media.json');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Retweet?\n\t\t\t\t\telse if ('id' in data) {\n\t\t\t\t\t\tcallback('statuses/retweet/' + data.id + '.json');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Tweet\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Assign the post body to the query parameters\n\t\t\t\t\t\thello.utils.extend(p.query, data);\n\t\t\t\t\t\tcallback('statuses/update.json?include_entities=1');\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// See: https://dev.twitter.com/rest/reference/post/favorites/create\n\t\t\t\t'me/like': function(p, callback) {\n\t\t\t\t\tvar id = p.data.id;\n\t\t\t\t\tp.data = null;\n\t\t\t\t\tcallback('favorites/create.json?id=' + id);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdel: {\n\n\t\t\t\t// See: https://dev.twitter.com/rest/reference/post/favorites/destroy\n\t\t\t\t'me/like': function() {\n\t\t\t\t\tp.method = 'post';\n\t\t\t\t\tvar id = p.data.id;\n\t\t\t\t\tp.data = null;\n\t\t\t\t\tcallback('favorites/destroy.json?id=' + id);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(res) {\n\t\t\t\t\tformatError(res);\n\t\t\t\t\tformatUser(res);\n\t\t\t\t\treturn res;\n\t\t\t\t},\n\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\n\t\t\t\t'me/share': function(res) {\n\t\t\t\t\tformatError(res);\n\t\t\t\t\tpaging(res);\n\t\t\t\t\tif (!res.error && 'length' in res) {\n\t\t\t\t\t\treturn {data: res};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res;\n\t\t\t\t},\n\n\t\t\t\t'default': function(res) {\n\t\t\t\t\tres = arrayToDataResponse(res);\n\t\t\t\t\tpaging(res);\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t},\n\t\t\txhr: function(p) {\n\n\t\t\t\t// Rely on the proxy for non-GET requests.\n\t\t\t\treturn (p.method !== 'get');\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction formatUser(o) {\n\t\tif (o.id) {\n\t\t\tif (o.name) {\n\t\t\t\tvar m = o.name.split(' ');\n\t\t\t\to.first_name = m.shift();\n\t\t\t\to.last_name = m.join(' ');\n\t\t\t}\n\n\t\t\t// See: https://dev.twitter.com/overview/general/user-profile-images-and-banners\n\t\t\to.thumbnail = o.profile_image_url_https || o.profile_image_url;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o) {\n\t\tformatError(o);\n\t\tpaging(o);\n\t\tif (o.users) {\n\t\t\to.data = o.users.map(formatUser);\n\t\t\tdelete o.users;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatError(o) {\n\t\tif (o.errors) {\n\t\t\tvar e = o.errors[0];\n\t\t\to.error = {\n\t\t\t\tcode: 'request_failed',\n\t\t\t\tmessage: e.message\n\t\t\t};\n\t\t}\n\t}\n\n\t// Take a cursor and add it to the path\n\tfunction paging(res) {\n\t\t// Does the response include a 'next_cursor_string'\n\t\tif ('next_cursor_str' in res) {\n\t\t\t// See: https://dev.twitter.com/docs/misc/cursoring\n\t\t\tres.paging = {\n\t\t\t\tnext: '?cursor=' + res.next_cursor_str\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction arrayToDataResponse(res) {\n\t\treturn Array.isArray(res) ? {data: res} : res;\n\t}\n\n\t/**\n\t// The documentation says to define user in the request\n\t// Although its not actually required.\n\n\tvar user_id;\n\n\tfunction withUserId(callback){\n\t\tif(user_id){\n\t\t\tcallback(user_id);\n\t\t}\n\t\telse{\n\t\t\thello.api('twitter:/me', function(o){\n\t\t\t\tuser_id = o.id;\n\t\t\t\tcallback(o.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction sign(url){\n\t\treturn function(p, callback){\n\t\t\twithUserId(function(user_id){\n\t\t\t\tcallback(url+'?user_id='+user_id);\n\t\t\t});\n\t\t};\n\t}\n\t*/\n\n})(hello);\n\n// Vkontakte (vk.com)\n(function(hello) {\n\n\thello.init({\n\n\t\tvk: {\n\t\t\tname: 'Vk',\n\n\t\t\t// See https://vk.com/dev/oauth_dialog\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://oauth.vk.com/authorize',\n\t\t\t\tgrant: 'https://oauth.vk.com/access_token'\n\t\t\t},\n\n\t\t\t// Authorization scopes\n\t\t\t// See https://vk.com/dev/permissions\n\t\t\tscope: {\n\t\t\t\temail: 'email',\n\t\t\t\tfriends: 'friends',\n\t\t\t\tphotos: 'photos',\n\t\t\t\tvideos: 'video',\n\t\t\t\tshare: 'share',\n\t\t\t\toffline_access: 'offline'\n\t\t\t},\n\n\t\t\t// Refresh the access_token\n\t\t\trefresh: true,\n\n\t\t\tlogin: function(p) {\n\t\t\t\tp.qs.display = window.navigator &&\n\t\t\t\t\twindow.navigator.userAgent &&\n\t\t\t\t\t/ipad|phone|phone|android/.test(window.navigator.userAgent.toLowerCase()) ? 'mobile' : 'popup';\n\t\t\t},\n\n\t\t\t// API Base URL\n\t\t\tbase: 'https://api.vk.com/method/',\n\n\t\t\t// Map GET requests\n\t\t\tget: {\n\t\t\t\tme: function(p, callback) {\n\t\t\t\t\tp.query.fields = 'id,first_name,last_name,photo_max';\n\t\t\t\t\tcallback('users.get');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: function(res, headers, req) {\n\t\t\t\t\tformatError(res);\n\t\t\t\t\treturn formatUser(res, req);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// No XHR\n\t\t\txhr: false,\n\n\t\t\t// All requests should be JSONP as of missing CORS headers in https://api.vk.com/method/*\n\t\t\tjsonp: true,\n\n\t\t\t// No form\n\t\t\tform: false\n\t\t}\n\t});\n\n\tfunction formatUser(o, req) {\n\n\t\tif (o !== null && 'response' in o && o.response !== null && o.response.length) {\n\t\t\to = o.response[0];\n\t\t\to.id = o.uid;\n\t\t\to.thumbnail = o.picture = o.photo_max;\n\t\t\to.name = o.first_name + ' ' + o.last_name;\n\n\t\t\tif (req.authResponse && req.authResponse.email !== null)\n\t\t\t\to.email = req.authResponse.email;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatError(o) {\n\n\t\tif (o.error) {\n\t\t\tvar e = o.error;\n\t\t\to.error = {\n\t\t\t\tcode: e.error_code,\n\t\t\t\tmessage: e.error_msg\n\t\t\t};\n\t\t}\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\t\twindows: {\n\t\t\tname: 'Windows live',\n\n\t\t\t// REF: http://msdn.microsoft.com/en-us/library/hh243641.aspx\n\t\t\toauth: {\n\t\t\t\tversion: 2,\n\t\t\t\tauth: 'https://login.live.com/oauth20_authorize.srf',\n\t\t\t\tgrant: 'https://login.live.com/oauth20_token.srf'\n\t\t\t},\n\n\t\t\t// Refresh the access_token once expired\n\t\t\trefresh: true,\n\n\t\t\tlogout: function() {\n\t\t\t\treturn 'http://login.live.com/oauth20_logout.srf?ts=' + (new Date()).getTime();\n\t\t\t},\n\n\t\t\t// Authorization scopes\n\t\t\tscope: {\n\t\t\t\tbasic: 'wl.signin,wl.basic',\n\t\t\t\temail: 'wl.emails',\n\t\t\t\tbirthday: 'wl.birthday',\n\t\t\t\tevents: 'wl.calendars',\n\t\t\t\tphotos: 'wl.photos',\n\t\t\t\tvideos: 'wl.photos',\n\t\t\t\tfriends: 'wl.contacts_emails',\n\t\t\t\tfiles: 'wl.skydrive',\n\t\t\t\tpublish: 'wl.share',\n\t\t\t\tpublish_files: 'wl.skydrive_update',\n\t\t\t\tshare: 'wl.share',\n\t\t\t\tcreate_event: 'wl.calendars_update,wl.events_create',\n\t\t\t\toffline_access: 'wl.offline_access'\n\t\t\t},\n\n\t\t\t// API base URL\n\t\t\tbase: 'https://apis.live.net/v5.0/',\n\n\t\t\t// Map GET requests\n\t\t\tget: {\n\n\t\t\t\t// Friends\n\t\t\t\tme: 'me',\n\t\t\t\t'me/friends': 'me/friends',\n\t\t\t\t'me/following': 'me/contacts',\n\t\t\t\t'me/followers': 'me/friends',\n\t\t\t\t'me/contacts': 'me/contacts',\n\n\t\t\t\t'me/albums': 'me/albums',\n\n\t\t\t\t// Include the data[id] in the path\n\t\t\t\t'me/album': '@{id}/files',\n\t\t\t\t'me/photo': '@{id}',\n\n\t\t\t\t// Files\n\t\t\t\t'me/files': '@{parent|me/skydrive}/files',\n\t\t\t\t'me/folders': '@{id|me/skydrive}/files',\n\t\t\t\t'me/folder': '@{id|me/skydrive}/files'\n\t\t\t},\n\n\t\t\t// Map POST requests\n\t\t\tpost: {\n\t\t\t\t'me/albums': 'me/albums',\n\t\t\t\t'me/album': '@{id}/files/',\n\n\t\t\t\t'me/folders': '@{id|me/skydrive/}',\n\t\t\t\t'me/files': '@{parent|me/skydrive}/files'\n\t\t\t},\n\n\t\t\t// Map DELETE requests\n\t\t\tdel: {\n\t\t\t\t// Include the data[id] in the path\n\t\t\t\t'me/album': '@{id}',\n\t\t\t\t'me/photo': '@{id}',\n\t\t\t\t'me/folder': '@{id}',\n\t\t\t\t'me/files': '@{id}'\n\t\t\t},\n\n\t\t\twrap: {\n\t\t\t\tme: formatUser,\n\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/contacts': formatFriends,\n\t\t\t\t'me/followers': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'me/albums': formatAlbums,\n\t\t\t\t'me/photos': formatDefault,\n\t\t\t\t'default': formatDefault\n\t\t\t},\n\n\t\t\txhr: function(p) {\n\t\t\t\tif (p.method !== 'get' && p.method !== 'delete' && !hello.utils.hasBinary(p.data)) {\n\n\t\t\t\t\t// Does this have a data-uri to upload as a file?\n\t\t\t\t\tif (typeof (p.data.file) === 'string') {\n\t\t\t\t\t\tp.data.file = hello.utils.toBlob(p.data.file);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.data = JSON.stringify(p.data);\n\t\t\t\t\t\tp.headers = {\n\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\tjsonp: function(p) {\n\t\t\t\tif (p.method !== 'get' && !hello.utils.hasBinary(p.data)) {\n\t\t\t\t\tp.data.method = p.method;\n\t\t\t\t\tp.method = 'get';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction formatDefault(o) {\n\t\tif ('data' in o) {\n\t\t\to.data.forEach(function(d) {\n\t\t\t\tif (d.picture) {\n\t\t\t\t\td.thumbnail = d.picture;\n\t\t\t\t}\n\n\t\t\t\tif (d.images) {\n\t\t\t\t\td.pictures = d.images\n\t\t\t\t\t\t.map(formatImage)\n\t\t\t\t\t\t.sort(function(a, b) {\n\t\t\t\t\t\t\treturn a.width - b.width;\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatImage(image) {\n\t\treturn {\n\t\t\twidth: image.width,\n\t\t\theight: image.height,\n\t\t\tsource: image.source\n\t\t};\n\t}\n\n\tfunction formatAlbums(o) {\n\t\tif ('data' in o) {\n\t\t\to.data.forEach(function(d) {\n\t\t\t\td.photos = d.files = 'https://apis.live.net/v5.0/' + d.id + '/photos';\n\t\t\t});\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatUser(o, headers, req) {\n\t\tif (o.id) {\n\t\t\tvar token = req.query.access_token;\n\t\t\tif (o.emails) {\n\t\t\t\to.email = o.emails.preferred;\n\t\t\t}\n\n\t\t\t// If this is not an non-network friend\n\t\t\tif (o.is_friend !== false) {\n\t\t\t\t// Use the id of the user_id if available\n\t\t\t\tvar id = (o.user_id || o.id);\n\t\t\t\to.thumbnail = o.picture = 'https://apis.live.net/v5.0/' + id + '/picture?access_token=' + token;\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o, headers, req) {\n\t\tif ('data' in o) {\n\t\t\to.data.forEach(function(d) {\n\t\t\t\tformatUser(d, headers, req);\n\t\t\t});\n\t\t}\n\n\t\treturn o;\n\t}\n\n})(hello);\n\n(function(hello) {\n\n\thello.init({\n\n\t\tyahoo: {\n\n\t\t\t// Ensure that you define an oauth_proxy\n\t\t\toauth: {\n\t\t\t\tversion: '1.0a',\n\t\t\t\tauth: 'https://api.login.yahoo.com/oauth/v2/request_auth',\n\t\t\t\trequest: 'https://api.login.yahoo.com/oauth/v2/get_request_token',\n\t\t\t\ttoken: 'https://api.login.yahoo.com/oauth/v2/get_token'\n\t\t\t},\n\n\t\t\t// Login handler\n\t\t\tlogin: function(p) {\n\t\t\t\t// Change the default popup window to be at least 560\n\t\t\t\t// Yahoo does dynamically change it on the fly for the signin screen (only, what if your already signed in)\n\t\t\t\tp.options.popup.width = 560;\n\n\t\t\t\t// Yahoo throws an parameter error if for whatever reason the state.scope contains a comma, so lets remove scope\n\t\t\t\ttry {delete p.qs.state.scope;}\n\t\t\t\tcatch (e) {}\n\t\t\t},\n\n\t\t\tbase: 'https://social.yahooapis.com/v1/',\n\n\t\t\tget: {\n\t\t\t\tme: yql('select * from social.profile(0) where guid=me'),\n\t\t\t\t'me/friends': yql('select * from social.contacts(0) where guid=me'),\n\t\t\t\t'me/following': yql('select * from social.contacts(0) where guid=me')\n\t\t\t},\n\t\t\twrap: {\n\t\t\t\tme: formatUser,\n\n\t\t\t\t// Can't get IDs\n\t\t\t\t// It might be better to loop through the social.relationship table with has unique IDs of users.\n\t\t\t\t'me/friends': formatFriends,\n\t\t\t\t'me/following': formatFriends,\n\t\t\t\t'default': paging\n\t\t\t}\n\t\t}\n\t});\n\n\t/*\n\t\t// Auto-refresh fix: bug in Yahoo can't get this to work with node-oauth-shim\n\t\tlogin : function(o){\n\t\t\t// Is the user already logged in\n\t\t\tvar auth = hello('yahoo').getAuthResponse();\n\n\t\t\t// Is this a refresh token?\n\t\t\tif(o.options.display==='none'&&auth&&auth.access_token&&auth.refresh_token){\n\t\t\t\t// Add the old token and the refresh token, including path to the query\n\t\t\t\t// See http://developer.yahoo.com/oauth/guide/oauth-refreshaccesstoken.html\n\t\t\t\to.qs.access_token = auth.access_token;\n\t\t\t\to.qs.refresh_token = auth.refresh_token;\n\t\t\t\to.qs.token_url = 'https://api.login.yahoo.com/oauth/v2/get_token';\n\t\t\t}\n\t\t},\n\t*/\n\n\tfunction formatError(o) {\n\t\tif (o && 'meta' in o && 'error_type' in o.meta) {\n\t\t\to.error = {\n\t\t\t\tcode: o.meta.error_type,\n\t\t\t\tmessage: o.meta.error_message\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction formatUser(o) {\n\n\t\tformatError(o);\n\t\tif (o.query && o.query.results && o.query.results.profile) {\n\t\t\to = o.query.results.profile;\n\t\t\to.id = o.guid;\n\t\t\to.last_name = o.familyName;\n\t\t\to.first_name = o.givenName || o.nickname;\n\t\t\tvar a = [];\n\t\t\tif (o.first_name) {\n\t\t\t\ta.push(o.first_name);\n\t\t\t}\n\n\t\t\tif (o.last_name) {\n\t\t\t\ta.push(o.last_name);\n\t\t\t}\n\n\t\t\to.name = a.join(' ');\n\t\t\to.email = (o.emails && o.emails[0]) ? o.emails[0].handle : null;\n\t\t\to.thumbnail = o.image ? o.image.imageUrl : null;\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriends(o, headers, request) {\n\t\tformatError(o);\n\t\tpaging(o, headers, request);\n\t\tvar contact;\n\t\tvar field;\n\t\tif (o.query && o.query.results && o.query.results.contact) {\n\t\t\to.data = o.query.results.contact;\n\t\t\tdelete o.query;\n\n\t\t\tif (!Array.isArray(o.data)) {\n\t\t\t\to.data = [o.data];\n\t\t\t}\n\n\t\t\to.data.forEach(formatFriend);\n\t\t}\n\n\t\treturn o;\n\t}\n\n\tfunction formatFriend(contact) {\n\t\tcontact.id = null;\n\n\t\t// #362: Reports of responses returning a single item, rather than an Array of items.\n\t\t// Format the contact.fields to be an array.\n\t\tif (contact.fields && !(contact.fields instanceof Array)) {\n\t\t\tcontact.fields = [contact.fields];\n\t\t}\n\n\t\t(contact.fields || []).forEach(function(field) {\n\t\t\tif (field.type === 'email') {\n\t\t\t\tcontact.email = field.value;\n\t\t\t}\n\n\t\t\tif (field.type === 'name') {\n\t\t\t\tcontact.first_name = field.value.givenName;\n\t\t\t\tcontact.last_name = field.value.familyName;\n\t\t\t\tcontact.name = field.value.givenName + ' ' + field.value.familyName;\n\t\t\t}\n\n\t\t\tif (field.type === 'yahooid') {\n\t\t\t\tcontact.id = field.value;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction paging(res, headers, request) {\n\n\t\t// See: http://developer.yahoo.com/yql/guide/paging.html#local_limits\n\t\tif (res.query && res.query.count && request.options) {\n\t\t\tres.paging = {\n\t\t\t\tnext: '?start=' + (res.query.count + (+request.options.start || 1))\n\t\t\t};\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tfunction yql(q) {\n\t\treturn 'https://query.yahooapis.com/v1/yql?q=' + (q + ' limit @{limit|100} offset @{start|0}').replace(/\\s/g, '%20') + '&format=json';\n\t}\n\n})(hello);\n\n// Register as anonymous AMD module\nif (typeof define === 'function' && define.amd) {\n\tdefine(function() {\n\t\treturn hello;\n\t});\n}\n\n// CommonJS module for browserify\nif (typeof module === 'object' && module.exports) {\n\tmodule.exports = hello;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}